///
/// Copyright (c) 2022 Arm Limited
/// Copyright (c) 2022 Hanno Becker
/// Copyright (c) 2023 Amin Abdulrahman, Matthias Kannwischer
/// SPDX-License-Identifier: MIT
///
/// Permission is hereby granted, free of charge, to any person obtaining a copy
/// of this software and associated documentation files (the "Software"), to deal
/// in the Software without restriction, including without limitation the rights
/// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
/// copies of the Software, and to permit persons to whom the Software is
/// furnished to do so, subject to the following conditions:
///
/// The above copyright notice and this permission notice shall be included in all
/// copies or substantial portions of the Software.
///
/// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
/// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
/// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
/// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
/// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
/// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
/// SOFTWARE.
///

// Needed to provide ASM_LOAD directive
#include <hal_env.h>

// NOTE
// We use a lot of trivial macros to simplify the parsing burden for Slothy
// The macros are not unfolded by Slothy and thus interpreted as instructions,
// which are easier to parse due to e.g. the lack of size specifiers and simpler
// syntax for pre and post increment for loads and stores.
//
// Eventually, NeLight should include a proper parser for AArch64,
// but for initial investigations, the below is enough.

xtmp0 .req x10
xtmp1 .req x11
.macro vins vec_out, gpr_in, lane                // slothy:no-unfold
        ins \vec_out\().d[\lane], \gpr_in
.endm

.macro vext gpr_out, vec_in, lane                // slothy:no-unfold
        umov \gpr_out\(), \vec_in\().d[\lane]
.endm

.macro ldr_vo vec, base, offset
        ldr xtmp0, [\base, #\offset]
        ldr xtmp1, [\base, #(\offset+8)]
        vins \vec, xtmp0, 0
        vins \vec, xtmp1, 1
.endm

.macro ldr_vi vec, base, inc
        ldr xtmp0, [\base], #\inc
        ldr xtmp1, [\base, #(-\inc+8)]
        vins \vec, xtmp0, 0
        vins \vec, xtmp1, 1
.endm

.macro str_vo vec, base, offset                     // slothy:no-unfold
        str qform_\vec, [\base, #\offset]
.endm
.macro str_vi vec, base, inc                        // slothy:no-unfold
        str qform_\vec, [\base], #\inc
.endm

.macro vqrdmulh d,a,b
        sqrdmulh \d\().8h, \a\().8h, \b\().8h
.endm
.macro vmlsq d,a,b,i
        mls \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vqrdmulhq d,a,b,i
        sqrdmulh \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vqdmulhq d,a,b,i
        sqdmulh \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vmulq d,a,b,i
        mul \d\().8h, \a\().8h, \b\().h[\i]
.endm

.macro mulmodq dst, src, const, idx0, idx1
        vmulq       \dst,  \src, \const, \idx0
        vqrdmulhq   \src,  \src, \const, \idx1
        vmlsq        \dst,  \src, consts, 0
.endm

.macro mulmod dst, src, const, const_twisted
        mul        \dst\().8h,  \src\().8h, \const\().8h
        vqrdmulh   \src,  \src, \const_twisted
        vmlsq      \dst,  \src, consts, 0
.endm

.macro ct_butterfly a, b, root, idx0, idx1
        mulmodq  tmp, \b, \root, \idx0, \idx1
        sub     \b\().8h,    \a\().8h, tmp.8h
        add     \a\().8h,    \a\().8h, tmp.8h
.endm

.macro mulmod_v dst, src, const, const_twisted
        mul         \dst\().8h,  \src\().8h, \const\().8h
        vqrdmulh    \src,  \src, \const_twisted
        vmlsq       \dst,  \src, consts, 0
.endm

.macro ct_butterfly_v a, b, root, root_twisted
        mulmod  tmp, \b, \root, \root_twisted
        sub    \b\().8h,    \a\().8h, tmp.8h
        add    \a\().8h,    \a\().8h, tmp.8h
.endm

.macro barrett_reduce a
        vqdmulhq t0, \a, consts, 1
        srshr    t0.8H, t0.8H, #11
        vmlsq    \a, t0, consts, 0
.endm

.macro load_roots_123
        ldr_vi root0, r_ptr0, 32
        ldr_vo root1, r_ptr0, -16
.endm

.macro load_next_roots_45
        ldr_vi root0, r_ptr0, 16
.endm

.macro load_next_roots_67
        ldr_vi root0,    r_ptr1, (6*16)
        ldr_vo root0_tw, r_ptr1, (-6*16 + 1*16)
        ldr_vo root1,    r_ptr1, (-6*16 + 2*16)
        ldr_vo root1_tw, r_ptr1, (-6*16 + 3*16)
        ldr_vo root2,    r_ptr1, (-6*16 + 4*16)
        ldr_vo root2_tw, r_ptr1, (-6*16 + 5*16)
.endm

.macro transpose4 data
        trn1 t0.4s, \data\()0\().4s, \data\()1\().4s
        trn2 t1.4s, \data\()0\().4s, \data\()1\().4s
        trn1 t2.4s, \data\()2\().4s, \data\()3\().4s
        trn2 t3.4s, \data\()2\().4s, \data\()3\().4s

        trn2 \data\()2\().2d, t0.2d, t2.2d
        trn2 \data\()3\().2d, t1.2d, t3.2d
        trn1 \data\()0\().2d, t0.2d, t2.2d
        trn1 \data\()1\().2d, t1.2d, t3.2d
.endm

.macro transpose_single data_out, data_in
        trn1 \data_out\()0\().4s, \data_in\()0\().4s, \data_in\()1\().4s
        trn2 \data_out\()1\().4s, \data_in\()0\().4s, \data_in\()1\().4s
        trn1 \data_out\()2\().4s, \data_in\()2\().4s, \data_in\()3\().4s
        trn2 \data_out\()3\().4s, \data_in\()2\().4s, \data_in\()3\().4s
.endm

.macro save_gprs // slothy:no-unfold
        sub sp, sp, #(16*6)
        stp x19, x20, [sp, #16*0]
        stp x19, x20, [sp, #16*0]
        stp x21, x22, [sp, #16*1]
        stp x23, x24, [sp, #16*2]
        stp x25, x26, [sp, #16*3]
        stp x27, x28, [sp, #16*4]
        str x29, [sp, #16*5]
.endm

.macro restore_gprs // slothy:no-unfold
        ldp x19, x20, [sp, #16*0]
        ldp x21, x22, [sp, #16*1]
        ldp x23, x24, [sp, #16*2]
        ldp x25, x26, [sp, #16*3]
        ldp x27, x28, [sp, #16*4]
        ldr x29, [sp, #16*5]
        add sp, sp, #(16*6)
.endm

.macro save_vregs // slothy:no-unfold
        sub sp, sp, #(16*4)
        stp  d8,  d9, [sp, #16*0]
        stp d10, d11, [sp, #16*1]
        stp d12, d13, [sp, #16*2]
        stp d14, d15, [sp, #16*3]
.endm

.macro restore_vregs // slothy:no-unfold
        ldp  d8,  d9, [sp, #16*0]
        ldp d10, d11, [sp, #16*1]
        ldp d12, d13, [sp, #16*2]
        ldp d14, d15, [sp, #16*3]
        add sp, sp, #(16*4)
.endm

#define STACK_SIZE 16
#define STACK0 0

.macro restore a, loc     // slothy:no-unfold
        ldr \a, [sp, #\loc\()]
.endm
.macro save loc, a        // slothy:no-unfold
        str \a, [sp, #\loc\()]
.endm
.macro push_stack // slothy:no-unfold
        save_gprs
        save_vregs
        sub sp, sp, #STACK_SIZE
.endm

.macro pop_stack // slothy:no-unfold
        add sp, sp, #STACK_SIZE
        restore_vregs
        restore_gprs
.endm

.data
.p2align 4
roots:
#include "ntt_kyber_123_45_67_twiddles.s"
.text

        .global ntt_kyber_123_4567_scalar_load_opt_x1
        .global _ntt_kyber_123_4567_scalar_load_opt_x1

.p2align 4
const_addr:       .short 3329
                  .short 20159
                  .short 0
                  .short 0
                  .short 0
                  .short 0
                  .short 0
                  .short 0
ntt_kyber_123_4567_scalar_load_opt_x1:
_ntt_kyber_123_4567_scalar_load_opt_x1:
        push_stack

        in      .req x0
        inp     .req x1
        count   .req x2
        r_ptr0  .req x3
        r_ptr1  .req x4
        xtmp    .req x5

        qform_v0  .req q0
        qform_v1  .req q1
        qform_v2  .req q2
        qform_v3  .req q3
        qform_v4  .req q4
        qform_v5  .req q5
        qform_v6  .req q6
        qform_v7  .req q7
        qform_v8  .req q8
        qform_v9  .req q9
        qform_v10 .req q10
        qform_v11 .req q11
        qform_v12 .req q12
        qform_v13 .req q13
        qform_v14 .req q14
        qform_v15 .req q15
        qform_v16 .req q16
        qform_v17 .req q17
        qform_v18 .req q18
        qform_v19 .req q19
        qform_v20 .req q20
        qform_v21 .req q21
        qform_v22 .req q22
        qform_v23 .req q23
        qform_v24 .req q24
        qform_v25 .req q25
        qform_v26 .req q26
        qform_v27 .req q27
        qform_v28 .req q28
        qform_v29 .req q29
        qform_v30 .req q30
        qform_v31 .req q31

        data0  .req v8
        data1  .req v9
        data2  .req v10
        data3  .req v11
        data4  .req v12
        data5  .req v13
        data6  .req v14
        data7  .req v15

        x_00 .req x10
        x_01 .req x11
        x_10 .req x12
        x_11 .req x13
        x_20 .req x14
        x_21 .req x15
        x_30 .req x16
        x_31 .req x17

        xt_00 .req x_00
        xt_01 .req x_20
        xt_10 .req x_10
        xt_11 .req x_30
        xt_20 .req x_01
        xt_21 .req x_21
        xt_30 .req x_11
        xt_31 .req x_31

        qform_data0  .req q8
        qform_data1  .req q9
        qform_data2  .req q10
        qform_data3  .req q11
        qform_data4  .req q12
        qform_data5  .req q13
        qform_data6  .req q14
        qform_data7  .req q15

        root0    .req v0
        root1    .req v1
        root2    .req v2
        root0_tw .req v4
        root1_tw .req v5
        root2_tw .req v6

        consts         .req v7
        qform_consts   .req q7

        qform_root0    .req q0
        qform_root1    .req q1
        qform_root2    .req q2
        qform_root0_tw .req q4
        qform_root1_tw .req q5
        qform_root2_tw .req q6

        tmp .req v24
        t0  .req v25
        t1  .req v26
        t2  .req v27
        t3  .req v28

        ASM_LOAD(r_ptr0, roots)
        ASM_LOAD(r_ptr1, roots_l56)

        ASM_LOAD(xtmp, const_addr)
        ld1 {consts.8h}, [xtmp]

        save STACK0, in
        mov count, #4

        load_roots_123

        .p2align 2
        ldr x12, [x0, #264]                      // ..*.............................................
        ldr x21, [x0, #256]                      // .....*..........................................
        ldr x25, [x0, #192]                      // .............*..................................
        ldr x16, [x0, #64]                       // ..................*.............................
        ldr x18, [x0, #0]                        // ......................*.........................
        ldr x7, [x0, #448]                       // *...............................................
        ldr x11, [x0, #320]                      // ...*............................................
        ldr x23, [x0, #384]                      // ....*...........................................
        ldr x15, [x0, #328]                      // .........*......................................
        ldr x20, [x0, #200]                      // ..........*.....................................
        ldr x17, [x0, #8]                        // ...................*............................
        ldr x10, [x0, #72]                       // ..........................*.....................
        vins v22, x21, 0                         // ................*...............................
        vins v9, x25, 0                          // .....................*..........................
        vins v31, x18, 0                         // ......................................*.........
        vins v17, x16, 0                         // ........................................*.......
        vins v27, x7, 0                          // ......*.........................................
        ldr x27, [x0, #456]                      // .......*........................................
        vins v20, x11, 0                         // ........*.......................................
        vins v3, x23, 0                          // ............*...................................
        ldr x16, [x0, #128]                      // ...........*....................................
        ldr x19, [x0, #392]                      // ...............*................................
        ldr x18, [x0, #136]                      // .*..............................................
        // gap                                   // ................................................
        vins v22, x12, 1                         // ........................*.......................
        vins v9, x20, 1                          // ..............................*.................
        vins v31, x17, 1                         // .........................................*......
        vins v17, x10, 1                         // ............................................*...
        vins v27, x27, 1                         // ..............*.................................
        // gap                                   // ................................................
        vins v20, x15, 1                         // .................*..............................
        vins v3, x19, 1                          // ...........................*....................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        sqrdmulh v4.8H, v27.8H, v0.H[1]          // .......................*........................
        // gap                                   // ................................................
        mul v14.8H, v27.8H, v0.H[0]              // ....................*...........................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        mul v15.8H, v20.8H, v0.H[0]              // .........................*......................
        // gap                                   // ................................................
        sqrdmulh v12.8H, v20.8H, v0.H[1]         // .............................*..................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        sqrdmulh v13.8H, v3.8H, v0.H[1]          // ...............................*................
        // gap                                   // ................................................
        mls v14.8H, v4.8H, v7.H[0]               // ............................*...................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        mls v15.8H, v12.8H, v7.H[0]              // ................................*...............
        // gap                                   // ................................................
        mul v10.8H, v3.8H, v0.H[0]               // ..................................*.............
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        add v4.8H, v9.8H, v14.8H                 // .................................*..............
        sub v3.8H, v9.8H, v14.8H                 // ...................................*............
        vins v9, x16, 0                          // ..........................................*.....
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        sqrdmulh v6.8H, v4.8H, v0.H[3]           // ....................................*...........
        add v27.8H, v17.8H, v15.8H               // .............................................*..
        mul v2.8H, v4.8H, v0.H[2]                // .....................................*..........
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        mls v2.8H, v6.8H, v7.H[0]                // ...........................................*....
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        // gap                                   // ................................................
        sqrdmulh v30.8H, v3.8H, v0.H[5]          // ..............................................*.
        // gap                                   // ................................................
        mul v19.8H, v22.8H, v0.H[0]              // .......................................*........
        add v20.8H, v27.8H, v2.8H                // ...............................................*
        // gap                                   // ................................................
        // gap                                   // ................................................
        
        // original source code
        // ldr x28, [x0, #448]                   // .....*.......................................... || *...............
        // ldr x18, [x0, #136]                   // ......................*......................... || ...*............
        // ldr x8, [x0, #264]                    // *............................................... || *...............
        // ldr x17, [x0, #320]                   // ......*......................................... || .*..............
        // ldr x19, [x0, #384]                   // .......*........................................ || .*..............
        // ldr x29, [x0, #256]                   // .*.............................................. || *...............
        // vins v8, x28, 0                       // ................*............................... || ..*.............
        // ldr x23, [x0, #456]                   // .................*.............................. || ..*.............
        // vins v13, x17, 0                      // ..................*............................. || ...*............
        // ldr x12, [x0, #328]                   // ........*....................................... || .*..............
        // ldr x24, [x0, #200]                   // .........*...................................... || .*..............
        // ldr x7, [x0, #128]                    // ....................*........................... || ...*............
        // vins v26, x19, 0                      // ...................*............................ || ...*............
        // ldr x27, [x0, #192]                   // ..*............................................. || *...............
        // vins v8, x23, 1                       // ...........................*.................... || ....*...........
        // ldr x22, [x0, #392]                   // .....................*.......................... || ...*............
        // vins v22, x29, 0                      // ............*................................... || ..*.............
        // vins v13, x12, 1                      // ............................*................... || .....*..........
        // ldr x15, [x0, #64]                    // ...*............................................ || *...............
        // ldr x9, [x0, #8]                      // ..........*..................................... || .*..............
        // mul v29.8H, v8.8H, v0.H[0]            // ...............................*................ || ......*.........
        // vins v9, x27, 0                       // .............*.................................. || ..*.............
        // ldr x25, [x0, #0]                     // ....*........................................... || *...............
        // sqrdmulh v25.8H, v8.8H, v0.H[1]       // ..............................*................. || ......*.........
        // vins v22, x8, 1                       // .......................*........................ || ....*...........
        // mul v15.8H, v13.8H, v0.H[0]           // ................................*............... || .......*........
        // ldr x27, [x0, #72]                    // ...........*.................................... || .*..............
        // vins v26, x22, 1                      // .............................*.................. || .....*..........
        // mls v29.8H, v25.8H, v7.H[0]           // ...................................*............ || ........*.......
        // sqrdmulh v25.8H, v13.8H, v0.H[1]      // .................................*.............. || .......*........
        // vins v9, x24, 1                       // ........................*....................... || ....*...........
        // sqrdmulh v13.8H, v26.8H, v0.H[1]      // ..................................*............. || ........*.......
        // mls v15.8H, v25.8H, v7.H[0]           // ....................................*........... || .........*......
        // add v5.8H, v9.8H, v29.8H              // ......................................*......... || ..........*.....
        // mul v10.8H, v26.8H, v0.H[0]           // .....................................*.......... || .........*......
        // sub v3.8H, v9.8H, v29.8H              // .......................................*........ || ..........*.....
        // sqrdmulh v25.8H, v5.8H, v0.H[3]       // .........................................*...... || ...........*....
        // mul v2.8H, v5.8H, v0.H[2]             // ...........................................*.... || ...........*....
        // vins v31, x25, 0                      // ..............*................................. || ..*.............
        // mul v19.8H, v22.8H, v0.H[0]           // ..............................................*. || ...............*
        // vins v17, x15, 0                      // ...............*................................ || ..*.............
        // vins v31, x9, 1                       // .........................*...................... || ....*...........
        // vins v9, x7, 0                        // ........................................*....... || ..........*.....
        // mls v2.8H, v25.8H, v7.H[0]            // ............................................*... || .............*..
        // vins v17, x27, 1                      // ..........................*..................... || ....*...........
        // add v27.8H, v17.8H, v15.8H            // ..........................................*..... || ...........*....
        // sqrdmulh v30.8H, v3.8H, v0.H[5]       // .............................................*.. || ...............*
        // add v20.8H, v27.8H, v2.8H             // ...............................................* || ...............*
        
        sub count, count, #1
.p2align 2
layer123_start:
        sqrdmulh v18.8H, v20.8H, v0.H[7]         // .........................................................................*..........................
        sub v28.8H, v27.8H, v2.8H                // ............................................................*.......................................
        mls v10.8H, v13.8H, v7.H[0]              // ............................................*.......................................................
        ldr x28, [x0, #464]                      // ............................e.......................................................................
        vins v9, x18, 1                          // ...........*........................................................................................
        ldr x18, [x0, #152]                      // .........e..........................................................................................
        sqrdmulh v12.8H, v22.8H, v0.H[1]         // .................................*..................................................................
        ldr x8, [x0, #280]                       // .................e..................................................................................
        mul v24.8H, v20.8H, v0.H[6]              // ........................................................................*...........................
        ldr x17, [x0, #336]                      // ....................e...............................................................................
        ldr x19, [x0, #400]                      // ........................e...........................................................................
        ldr x29, [x0, #272]                      // ................e...................................................................................
        mul v23.8H, v28.8H, v1.H[0]              // .............................................................................*......................
        add v29.8H, v9.8H, v10.8H                // ..............................................*.....................................................
        sqrdmulh v20.8H, v28.8H, v1.H[1]         // ..............................................................................*.....................
        sub v11.8H, v9.8H, v10.8H                // .............................................*......................................................
        vins v8, x28, 0                          // ..............................e.....................................................................
        ldr x23, [x0, #472]                      // .............................e......................................................................
        mul v6.8H, v11.8H, v0.H[4]               // ..............................................................*.....................................
        vins v13, x17, 0                         // ......................e.............................................................................
        sqrdmulh v4.8H, v11.8H, v0.H[5]          // ...............................................................*....................................
        ldr x12, [x0, #344]                      // .....................e..............................................................................
        ldr x24, [x0, #216]                      // .............e......................................................................................
        ldr x7, [x0, #144]                       // ........e...........................................................................................
        mls v24.8H, v18.8H, v7.H[0]              // ..........................................................................*.........................
        vins v26, x19, 0                         // ..........................e.........................................................................
        mul v27.8H, v29.8H, v0.H[2]              // ....................................................*...............................................
        ldr x27, [x0, #208]                      // ............e.......................................................................................
        vins v8, x23, 1                          // ...............................e....................................................................
        ldr x22, [x0, #408]                      // .........................e..........................................................................
        sqrdmulh v14.8H, v29.8H, v0.H[3]         // .....................................................*..............................................
        vins v22, x29, 0                         // ..................e.................................................................................
        mls v6.8H, v4.8H, v7.H[0]                // ................................................................*...................................
        vins v13, x12, 1                         // .......................e............................................................................
        ldr x15, [x0, #80]                       // ....e...............................................................................................
        ldr x9, [x0, #24]                        // .e..................................................................................................
        mul v29.8H, v8.8H, v0.H[0]               // ...............................................e....................................................
        vins v9, x27, 0                          // ..............e.....................................................................................
        mls v19.8H, v12.8H, v7.H[0]              // ..................................*.................................................................
        sub v11.8H, v17.8H, v15.8H               // ........................................*...........................................................
        ldr x25, [x0, #16]                       // e...................................................................................................
        // gap                                   // ....................................................................................................
        sqrdmulh v25.8H, v8.8H, v0.H[1]          // ................................................e...................................................
        vins v22, x8, 1                          // ...................e................................................................................
        mul v15.8H, v13.8H, v0.H[0]              // .....................................e..............................................................
        ldr x27, [x0, #88]                       // .....e..............................................................................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        mls v27.8H, v14.8H, v7.H[0]              // ......................................................*.............................................
        vins v26, x22, 1                         // ...........................e........................................................................
        mul v18.8H, v3.8H, v0.H[4]               // ...................................................................*................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        mls v29.8H, v25.8H, v7.H[0]              // .................................................e..................................................
        add v4.8H, v31.8H, v19.8H                // ....................................*...............................................................
        sqrdmulh v25.8H, v13.8H, v0.H[1]         // ......................................e.............................................................
        vins v9, x24, 1                          // ...............e....................................................................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        mls v18.8H, v30.8H, v7.H[0]              // .....................................................................*..............................
        // gap                                   // ....................................................................................................
        sqrdmulh v13.8H, v26.8H, v0.H[1]         // ...........................................e........................................................
        add v21.8H, v4.8H, v27.8H                // ........................................................*...........................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        mls v15.8H, v25.8H, v7.H[0]              // .......................................e............................................................
        add v5.8H, v9.8H, v29.8H                 // ...................................................e................................................
        mul v10.8H, v26.8H, v0.H[0]              // ..........................................e.........................................................
        sub v3.8H, v9.8H, v29.8H                 // ..................................................e.................................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        sqrdmulh v25.8H, v5.8H, v0.H[3]          // ..........................................................e.........................................
        sub v8.8H, v11.8H, v18.8H                // ......................................................................*.............................
        mul v2.8H, v5.8H, v0.H[2]                // .........................................................e..........................................
        add v28.8H, v11.8H, v18.8H               // .......................................................................*............................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        mul v9.8H, v8.8H, v1.H[4]                // .......................................................................................*............
        // gap                                   // ....................................................................................................
        sqrdmulh v26.8H, v8.8H, v1.H[5]          // ........................................................................................*...........
        sub v5.8H, v31.8H, v19.8H                // ...................................*................................................................
        vins v31, x25, 0                         // ..e.................................................................................................
        // gap                                   // ....................................................................................................
        sqrdmulh v29.8H, v28.8H, v1.H[3]         // ...................................................................................*................
        sub v12.8H, v5.8H, v6.8H                 // .................................................................*..................................
        mul v19.8H, v22.8H, v0.H[0]              // ................................e...................................................................
        sub v30.8H, v21.8H, v24.8H               // ...........................................................................*........................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        mul v14.8H, v28.8H, v1.H[2]              // ..................................................................................*.................
        str_vo v30, x0, 64                       // .............................................................................................*......
        mls v9.8H, v26.8H, v7.H[0]               // .........................................................................................*..........
        vins v17, x15, 0                         // ......e.............................................................................................
        vins v31, x9, 1                          // ...e................................................................................................
        // gap                                   // ....................................................................................................
        sub v11.8H, v4.8H, v27.8H                // .......................................................*............................................
        add v26.8H, v5.8H, v6.8H                 // ..................................................................*.................................
        mls v23.8H, v20.8H, v7.H[0]              // ...............................................................................*....................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        add v16.8H, v12.8H, v9.8H                // ...........................................................................................*........
        // gap                                   // ....................................................................................................
        mls v14.8H, v29.8H, v7.H[0]              // ....................................................................................*...............
        sub v8.8H, v12.8H, v9.8H                 // ..........................................................................................*.........
        vins v9, x7, 0                           // ..........e.........................................................................................
        // gap                                   // ....................................................................................................
        str_vo v16, x0, 384                      // ..................................................................................................*.
        add v27.8H, v11.8H, v23.8H               // .................................................................................*..................
        mls v2.8H, v25.8H, v7.H[0]               // ...........................................................e........................................
        sub v16.8H, v11.8H, v23.8H               // ................................................................................*...................
        vins v17, x27, 1                         // .......e............................................................................................
        // gap                                   // ....................................................................................................
        str_vo v8, x0, 448                       // ...................................................................................................*
        str_vo v16, x0, 192                      // ...............................................................................................*....
        add v12.8H, v26.8H, v14.8H               // ......................................................................................*.............
        sub v5.8H, v26.8H, v14.8H                // .....................................................................................*..............
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        str_vo v27, x0, 128                      // ..............................................................................................*.....
        str_vo v12, x0, 256                      // ................................................................................................*...
        add v21.8H, v21.8H, v24.8H               // ............................................................................*.......................
        add v27.8H, v17.8H, v15.8H               // .........................................e..........................................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        str_vo v5, x0, 320                       // .................................................................................................*..
        str_vi v21, x0, 16                       // ............................................................................................*.......
        sqrdmulh v30.8H, v3.8H, v0.H[5]          // ....................................................................e...............................
        add v20.8H, v27.8H, v2.8H                // .............................................................e......................................
        // gap                                   // ....................................................................................................
        // gap                                   // ....................................................................................................
        
        // original source code
        // ldr x10, [x0, #0]                     // .....................................e............................................................................................................................................................. || ......e.....................................
        // ldr x11, [x0, #8]                     // ................................e.................................................................................................................................................................. || .....e......................................
        // vins v8, x10, 0                       // ...............................................................e................................................................................................................................... || .............e..............................
        // vins v8, x11, 1                       // ........................................................................e.......................................................................................................................... || ...............e............................
        // ldr x10, [x0, #64]                    // ...............................e................................................................................................................................................................... || .....e......................................
        // ldr x11, [x0, #72]                    // .........................................e......................................................................................................................................................... || .......e....................................
        // vins v9, x10, 0                       // .......................................................................e........................................................................................................................... || ...............e............................
        // vins v9, x11, 1                       // ....................................................................................e.............................................................................................................. || ..................e.........................
        // ldr x10, [x0, #128]                   // ....................e.............................................................................................................................................................................. || ...e........................................
        // ldr x11, [x0, #136]                   // ..e................................................................................................................................................................................................ || e...........................................
        // vins v10, x10, 0                      // ...............................................................................e................................................................................................................... || .................e..........................
        // vins v10, x11, 1                      // .....................................................................................................*............................................................................................. || ......................*.....................
        // ldr x10, [x0, #192]                   // ........................e.......................................................................................................................................................................... || ....e.......................................
        // ldr x11, [x0, #200]                   // ...................e............................................................................................................................................................................... || ...e........................................
        // vins v11, x10, 0                      // ..................................e................................................................................................................................................................ || ......e.....................................
        // vins v11, x11, 1                      // ................................................e.................................................................................................................................................. || .........e..................................
        // ldr x10, [x0, #256]                   // ........e.......................................................................................................................................................................................... || .e..........................................
        // ldr x11, [x0, #264]                   // ....e.............................................................................................................................................................................................. || .e..........................................
        // vins v12, x10, 0                      // ............................e...................................................................................................................................................................... || .....e......................................
        // vins v12, x11, 1                      // .......................................e........................................................................................................................................................... || .......e....................................
        // ldr x10, [x0, #320]                   // ......e............................................................................................................................................................................................ || .e..........................................
        // ldr x11, [x0, #328]                   // ..................e................................................................................................................................................................................ || ...e........................................
        // vins v13, x10, 0                      // ................e.................................................................................................................................................................................. || ...e........................................
        // vins v13, x11, 1                      // ..............................e.................................................................................................................................................................... || .....e......................................
        // ldr x10, [x0, #384]                   // .......e........................................................................................................................................................................................... || .e..........................................
        // ldr x11, [x0, #392]                   // ..........................e........................................................................................................................................................................ || ....e.......................................
        // vins v14, x10, 0                      // ......................e............................................................................................................................................................................ || ....e.......................................
        // vins v14, x11, 1                      // ...........................................e....................................................................................................................................................... || ........e...................................
        // ldr x10, [x0, #448]                   // e.................................................................................................................................................................................................. || e...........................................
        // ldr x11, [x0, #456]                   // ..............e.................................................................................................................................................................................... || ..e.........................................
        // vins v15, x10, 0                      // .............e..................................................................................................................................................................................... || ..e.........................................
        // vins v15, x11, 1                      // .........................e......................................................................................................................................................................... || ....e.......................................
        // mul v24.8H, v12.8H, v0.H[0]           // ..................................................................e................................................................................................................................ || ..............e.............................
        // sqrdmulh v12.8H, v12.8H, v0.H[1]      // .......................................................................................................*........................................................................................... || .......................*....................
        // mls v24.8H, v12.8H, v7.H[0]           // .......................................................................................................................................*........................................................... || ............................*...............
        // sub v12.8H, v8.8H, v24.8H             // ..................................................................................................................................................................*................................ || ...................................*........
        // add v8.8H, v8.8H, v24.8H              // ..................................................................................................................................................*................................................ || ...............................*............
        // mul v24.8H, v13.8H, v0.H[0]           // ........................................e.......................................................................................................................................................... || .......e....................................
        // sqrdmulh v13.8H, v13.8H, v0.H[1]      // ...............................................e................................................................................................................................................... || .........e..................................
        // mls v24.8H, v13.8H, v7.H[0]           // ....................................................e.............................................................................................................................................. || ...........e................................
        // sub v13.8H, v9.8H, v24.8H             // ........................................................................................................................................*.......................................................... || ............................*...............
        // add v9.8H, v9.8H, v24.8H              // ............................................................................................e...................................................................................................... || ....................e.......................
        // mul v24.8H, v14.8H, v0.H[0]           // ......................................................e............................................................................................................................................ || ...........e................................
        // sqrdmulh v14.8H, v14.8H, v0.H[1]      // ..................................................e................................................................................................................................................ || ..........e.................................
        // mls v24.8H, v14.8H, v7.H[0]           // ...................................................................................................*............................................................................................... || ......................*.....................
        // sub v14.8H, v10.8H, v24.8H            // ................................................................................................................*.................................................................................. || ........................*...................
        // add v10.8H, v10.8H, v24.8H            // ..............................................................................................................*.................................................................................... || ........................*...................
        // mul v24.8H, v15.8H, v0.H[0]           // .................................e................................................................................................................................................................. || ......e.....................................
        // sqrdmulh v15.8H, v15.8H, v0.H[1]      // ......................................e............................................................................................................................................................ || .......e....................................
        // mls v24.8H, v15.8H, v7.H[0]           // .............................................e..................................................................................................................................................... || .........e..................................
        // sub v15.8H, v11.8H, v24.8H            // .......................................................e........................................................................................................................................... || ...........e................................
        // add v11.8H, v11.8H, v24.8H            // .....................................................e............................................................................................................................................. || ...........e................................
        // mul v24.8H, v10.8H, v0.H[2]           // ...........................................................................................................................*....................................................................... || ..........................*.................
        // sqrdmulh v10.8H, v10.8H, v0.H[3]      // ...............................................................................................................................*................................................................... || ...........................*................
        // mls v24.8H, v10.8H, v7.H[0]           // ..............................................................................................................................................*.................................................... || ..............................*.............
        // sub v10.8H, v8.8H, v24.8H             // .............................................................................................................................................................................*..................... || ......................................*.....
        // add v8.8H, v8.8H, v24.8H              // .......................................................................................................................................................*........................................... || ................................*...........
        // mul v24.8H, v11.8H, v0.H[2]           // ..........................................................e........................................................................................................................................ || ............e...............................
        // sqrdmulh v11.8H, v11.8H, v0.H[3]      // ........................................................e.......................................................................................................................................... || ............e...............................
        // mls v24.8H, v11.8H, v7.H[0]           // ..................................................................................e................................................................................................................ || ..................e.........................
        // sub v11.8H, v9.8H, v24.8H             // ..................................................................................................*................................................................................................ || ......................*.....................
        // add v9.8H, v9.8H, v24.8H              // ................................................................................................e.................................................................................................. || .....................e......................
        // mul v24.8H, v14.8H, v0.H[4]           // ...................................................................................................................*............................................................................... || .........................*..................
        // sqrdmulh v14.8H, v14.8H, v0.H[5]      // .....................................................................................................................*............................................................................. || .........................*..................
        // mls v24.8H, v14.8H, v7.H[0]           // .................................................................................................................................*................................................................. || ...........................*................
        // sub v14.8H, v12.8H, v24.8H            // .....................................................................................................................................................................*............................. || ....................................*.......
        // add v12.8H, v12.8H, v24.8H            // ..............................................................................................................................................................................*.................... || ......................................*.....
        // mul v24.8H, v15.8H, v0.H[4]           // ................................................................................................................................................*.................................................. || ..............................*.............
        // sqrdmulh v15.8H, v15.8H, v0.H[5]      // ...............................................................................................e................................................................................................... || .....................e......................
        // mls v24.8H, v15.8H, v7.H[0]           // .....................................................................................................................................................*............................................. || ................................*...........
        // sub v15.8H, v13.8H, v24.8H            // .............................................................................................................................................................*..................................... || ..................................*.........
        // add v13.8H, v13.8H, v24.8H            // ...............................................................................................................................................................*................................... || ..................................*.........
        // mul v24.8H, v9.8H, v0.H[6]            // .........................................................................................................*......................................................................................... || .......................*....................
        // sqrdmulh v9.8H, v9.8H, v0.H[7]        // .................................................................................................*................................................................................................. || ......................*.....................
        // mls v24.8H, v9.8H, v7.H[0]            // .........................................................................................................................*......................................................................... || ..........................*.................
        // sub v9.8H, v8.8H, v24.8H              // .......................................................................................................................................................................*........................... || ....................................*.......
        // add v8.8H, v8.8H, v24.8H              // ...............................................................................................................................................................................................*... || ..........................................*.
        // mul v24.8H, v11.8H, v1.H[0]           // .............................................................................................................*..................................................................................... || ........................*...................
        // sqrdmulh v11.8H, v11.8H, v1.H[1]      // ...............................................................................................................*................................................................................... || ........................*...................
        // mls v24.8H, v11.8H, v7.H[0]           // ...............................................................................................................................................................................*................... || ......................................*.....
        // sub v11.8H, v10.8H, v24.8H            // .......................................................................................................................................................................................*........... || ........................................*...
        // add v10.8H, v10.8H, v24.8H            // .....................................................................................................................................................................................*............. || ........................................*...
        // mul v24.8H, v13.8H, v1.H[2]           // ........................................................................................................................................................................*.......................... || .....................................*......
        // sqrdmulh v13.8H, v13.8H, v1.H[3]      // ....................................................................................................................................................................*.............................. || ....................................*.......
        // mls v24.8H, v13.8H, v7.H[0]           // .................................................................................................................................................................................*................. || .......................................*....
        // sub v13.8H, v12.8H, v24.8H            // ............................................................................................................................................................................................*...... || .........................................*..
        // add v12.8H, v12.8H, v24.8H            // ...........................................................................................................................................................................................*....... || .........................................*..
        // mul v24.8H, v15.8H, v1.H[4]           // ................................................................................................................................................................*.................................. || ...................................*........
        // sqrdmulh v15.8H, v15.8H, v1.H[5]      // .................................................................................................................................................................*................................. || ...................................*........
        // mls v24.8H, v15.8H, v7.H[0]           // ..........................................................................................................................................................................*........................ || .....................................*......
        // sub v15.8H, v14.8H, v24.8H            // ..................................................................................................................................................................................*................ || .......................................*....
        // add v14.8H, v14.8H, v24.8H            // ................................................................................................................................................................................*.................. || .......................................*....
        // str_vi v8, x0, 16                     // ..................................................................................................................................................................................................* || ...........................................*
        // str_vo v9, x0, 48                     // .........................................................................................................................................................................*......................... || .....................................*......
        // str_vo v10, x0, 112                   // .............................................................................................................................................................................................*..... || ..........................................*.
        // str_vo v11, x0, 176                   // ..........................................................................................................................................................................................*........ || .........................................*..
        // str_vo v12, x0, 240                   // ..............................................................................................................................................................................................*.... || ..........................................*.
        // str_vo v13, x0, 304                   // .................................................................................................................................................................................................*. || ...........................................*
        // str_vo v14, x0, 368                   // ....................................................................................................................................................................................*.............. || ........................................*...
        // str_vo v15, x0, 432                   // .........................................................................................................................................................................................*......... || .........................................*..
        
        subs count, count, #1
        cbnz count, layer123_start
        sqrdmulh v28.8H, v22.8H, v0.H[1]         // ....*...............................................
        sub v8.8H, v17.8H, v15.8H                // .................*..................................
        mul v6.8H, v3.8H, v0.H[4]                // ...................*................................
        sub v24.8H, v27.8H, v2.8H                // .*..................................................
        vins v9, x18, 1                          // ...*................................................
        // gap                                   // ....................................................
        mls v10.8H, v13.8H, v7.H[0]              // ..*.................................................
        // gap                                   // ....................................................
        mul v12.8H, v24.8H, v1.H[0]              // ......*.............................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        mls v6.8H, v30.8H, v7.H[0]               // .....................*..............................
        // gap                                   // ....................................................
        mls v19.8H, v28.8H, v7.H[0]              // ................*...................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        sqrdmulh v29.8H, v20.8H, v0.H[7]         // *...................................................
        add v26.8H, v9.8H, v10.8H                // .......*............................................
        mul v18.8H, v20.8H, v0.H[6]              // .....*..............................................
        sub v27.8H, v9.8H, v10.8H                // .........*..........................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        mul v17.8H, v27.8H, v0.H[4]              // ..........*.........................................
        sub v16.8H, v8.8H, v6.8H                 // .......................*............................
        sqrdmulh v27.8H, v27.8H, v0.H[5]         // ...........*........................................
        add v28.8H, v31.8H, v19.8H               // ....................*...............................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        mul v25.8H, v16.8H, v1.H[4]              // .........................*..........................
        sub v15.8H, v31.8H, v19.8H               // ...........................*........................
        sqrdmulh v4.8H, v16.8H, v1.H[5]          // ..........................*.........................
        add v11.8H, v8.8H, v6.8H                 // ........................*...........................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        mls v17.8H, v27.8H, v7.H[0]              // ...............*....................................
        // gap                                   // ....................................................
        sqrdmulh v8.8H, v11.8H, v1.H[3]          // ............................*.......................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        mls v25.8H, v4.8H, v7.H[0]               // .................................*..................
        // gap                                   // ....................................................
        mul v10.8H, v26.8H, v0.H[2]              // .............*......................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        sqrdmulh v9.8H, v26.8H, v0.H[3]          // ..............*.....................................
        sub v4.8H, v15.8H, v17.8H                // .............................*......................
        mul v16.8H, v11.8H, v1.H[2]              // ...............................*....................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        add v13.8H, v15.8H, v17.8H               // ...................................*................
        sub v20.8H, v4.8H, v25.8H                // .......................................*............
        sqrdmulh v5.8H, v24.8H, v1.H[1]          // ........*...........................................
        add v3.8H, v4.8H, v25.8H                 // .....................................*..............
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        mls v16.8H, v8.8H, v7.H[0]               // ......................................*.............
        str_vo v3, x0, 384                       // ........................................*...........
        mls v10.8H, v9.8H, v7.H[0]               // ..................*.................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        mls v18.8H, v29.8H, v7.H[0]              // ............*.......................................
        str_vo v20, x0, 448                      // ...........................................*........
        mls v12.8H, v5.8H, v7.H[0]               // ....................................*...............
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        add v14.8H, v13.8H, v16.8H               // .............................................*......
        sub v15.8H, v13.8H, v16.8H               // ..............................................*.....
        add v26.8H, v28.8H, v10.8H               // ......................*.............................
        sub v30.8H, v28.8H, v10.8H               // ..................................*.................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        str_vo v14, x0, 256                      // ................................................*...
        str_vo v15, x0, 320                      // ..................................................*.
        add v8.8H, v30.8H, v12.8H                // .........................................*..........
        sub v29.8H, v26.8H, v18.8H               // ..............................*.....................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        str_vo v8, x0, 128                       // ...............................................*....
        str_vo v29, x0, 64                       // ................................*...................
        add v26.8H, v26.8H, v18.8H               // .................................................*..
        sub v24.8H, v30.8H, v12.8H               // ..........................................*.........
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        str_vi v26, x0, 16                       // ...................................................*
        str_vo v24, x0, 176                      // ............................................*.......
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        // gap                                   // ....................................................
        
        // original source code
        // sqrdmulh v18.8H, v20.8H, v0.H[7]      // .........*.......................................... || ...*............
        // sub v28.8H, v27.8H, v2.8H             // ...*................................................ || *...............
        // mls v10.8H, v13.8H, v7.H[0]           // .....*.............................................. || .*..............
        // vins v9, x18, 1                       // ....*............................................... || *...............
        // sqrdmulh v12.8H, v22.8H, v0.H[1]      // *................................................... || *...............
        // mul v24.8H, v20.8H, v0.H[6]           // ...........*........................................ || ...*............
        // mul v23.8H, v28.8H, v1.H[0]           // ......*............................................. || .*..............
        // add v29.8H, v9.8H, v10.8H             // ..........*......................................... || ...*............
        // sqrdmulh v20.8H, v28.8H, v1.H[1]      // ..............................*..................... || .........*......
        // sub v11.8H, v9.8H, v10.8H             // ............*....................................... || ...*............
        // mul v6.8H, v11.8H, v0.H[4]            // .............*...................................... || ....*...........
        // sqrdmulh v4.8H, v11.8H, v0.H[5]       // ...............*.................................... || ....*...........
        // mls v24.8H, v18.8H, v7.H[0]           // ...................................*................ || ...........*....
        // mul v27.8H, v29.8H, v0.H[2]           // ........................*........................... || .......*........
        // sqrdmulh v14.8H, v29.8H, v0.H[3]      // .........................*.......................... || ........*.......
        // mls v6.8H, v4.8H, v7.H[0]             // .....................*.............................. || ......*.........
        // mls v19.8H, v12.8H, v7.H[0]           // ........*........................................... || ..*.............
        // sub v11.8H, v17.8H, v15.8H            // .*.................................................. || *...............
        // mls v27.8H, v14.8H, v7.H[0]           // ..................................*................. || ..........*.....
        // mul v18.8H, v3.8H, v0.H[4]            // ..*................................................. || *...............
        // add v4.8H, v31.8H, v19.8H             // ................*................................... || ....*...........
        // mls v18.8H, v30.8H, v7.H[0]           // .......*............................................ || ..*.............
        // add v21.8H, v4.8H, v27.8H             // ........................................*........... || ............*...
        // sub v8.8H, v11.8H, v18.8H             // ..............*..................................... || ....*...........
        // add v28.8H, v11.8H, v18.8H            // ....................*............................... || .....*..........
        // mul v9.8H, v8.8H, v1.H[4]             // .................*.................................. || .....*..........
        // sqrdmulh v26.8H, v8.8H, v1.H[5]       // ...................*................................ || .....*..........
        // sub v5.8H, v31.8H, v19.8H             // ..................*................................. || .....*..........
        // sqrdmulh v29.8H, v28.8H, v1.H[3]      // ......................*............................. || ......*.........
        // sub v12.8H, v5.8H, v6.8H              // ..........................*......................... || ........*.......
        // sub v30.8H, v21.8H, v24.8H            // .............................................*...... || .............*..
        // mul v14.8H, v28.8H, v1.H[2]           // ...........................*........................ || ........*.......
        // str_vo v30, x0, 64                    // ...............................................*.... || ..............*.
        // mls v9.8H, v26.8H, v7.H[0]            // .......................*............................ || .......*........
        // sub v11.8H, v4.8H, v27.8H             // .........................................*.......... || ............*...
        // add v26.8H, v5.8H, v6.8H              // ............................*....................... || .........*......
        // mls v23.8H, v20.8H, v7.H[0]           // .....................................*.............. || ...........*....
        // add v16.8H, v12.8H, v9.8H             // ...............................*.................... || .........*......
        // mls v14.8H, v29.8H, v7.H[0]           // ................................*................... || ..........*.....
        // sub v8.8H, v12.8H, v9.8H              // .............................*...................... || .........*......
        // str_vo v16, x0, 384                   // .................................*.................. || ..........*.....
        // add v27.8H, v11.8H, v23.8H            // ............................................*....... || .............*..
        // sub v16.8H, v11.8H, v23.8H            // .................................................*.. || ..............*.
        // str_vo v8, x0, 448                    // ....................................*............... || ...........*....
        // str_vo v16, x0, 192                   // ...................................................* || ...............*
        // add v12.8H, v26.8H, v14.8H            // ......................................*............. || ............*...
        // sub v5.8H, v26.8H, v14.8H             // .......................................*............ || ............*...
        // str_vo v27, x0, 128                   // ..............................................*..... || ..............*.
        // str_vo v12, x0, 256                   // ..........................................*......... || .............*..
        // add v21.8H, v21.8H, v24.8H            // ................................................*... || ..............*.
        // str_vo v5, x0, 320                    // ...........................................*........ || .............*..
        // str_vi v21, x0, 16                    // ..................................................*. || ...............*
        

        restore inp, STACK0
        mov count, #8

        .p2align 2
        ldr x10, [x4, #16]                      // ..............................*......................
        ldr x25, [x1, #40]                      // .....*...............................................
        ldr x16, [x1, #16]                      // ..............*......................................
        ldr x28, [x1, #48]                      // ..*..................................................
        ldr x22, [x3] , #16                     // .*...................................................
        ldr x18, [x4, #80]                      // ..............................................*......
        ldr x7, [x3, #-8]                       // ......*..............................................
        ldr x15, [x1, #32]                      // *....................................................
        ldr x26, [x4, #56]                      // ............*........................................
        ldr x14, [x4] , #96                     // ...............*.....................................
        ldr x17, [x4, #-88]                     // ...........................*.........................
        // gap                                  // .....................................................
        vins v18, x16, 0                        // ......................*..............................
        vins v16, x28, 0                        // .......*.............................................
        vins v5, x22, 0                         // ....*................................................
        ldr x16, [x1, #56]                      // ........*............................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        vins v29, x14, 0                        // .....................*...............................
        vins v2, x15, 0                         // ...*.................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        vins v16, x16, 1                        // ...........*.........................................
        ldr x16, [x1, #24]                      // ...................*.................................
        vins v5, x7, 1                          // .........*...........................................
        ldr x7, [x4, #-32]                      // ..................................*..................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        vins v2, x25, 1                         // ..........*..........................................
        ldr x14, [x4, #-56]                     // .......................*.............................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        sqrdmulh v4.8H, v16.8H, v5.H[1]         // ............................*........................
        vins v18, x16, 1                        // .............................*.......................
        mul v28.8H, v16.8H, v5.H[0]             // ..................*..................................
        ldr x16, [x1, #0]                       // ....................*................................
        ldr x25, [x4, #-48]                     // ...................................................*.
        // gap                                  // .....................................................
        vins v29, x17, 1                        // .................................*...................
        // gap                                  // .....................................................
        mul v23.8H, v2.8H, v5.H[0]              // .............*.......................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        mls v28.8H, v4.8H, v7.H[0]              // ....................................*................
        vins v16, x16, 0                        // ........................*............................
        sqrdmulh v4.8H, v2.8H, v5.H[1]          // .................*...................................
        ldr x16, [x1, #8]                       // ..........................*..........................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        sub v10.8H, v18.8H, v28.8H              // .....................................*...............
        add v0.8H, v18.8H, v28.8H               // ......................................*..............
        mls v23.8H, v4.8H, v7.H[0]              // ...................................*.................
        vins v16, x16, 1                        // ................................*....................
        ldr x16, [x4, #-64]                     // ................*....................................
        // gap                                  // .....................................................
        sqrdmulh v1.8H, v0.8H, v5.H[3]          // .......................................*.............
        // gap                                  // .....................................................
        mul v17.8H, v10.8H, v5.H[4]             // .........................................*...........
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        sqrdmulh v4.8H, v10.8H, v5.H[5]         // ..........................................*..........
        // gap                                  // .....................................................
        mul v20.8H, v0.8H, v5.H[2]              // ........................................*............
        // gap                                  // .....................................................
        // gap                                  // .....................................................
        vins v27, x18, 0                        // ..................................................*..
        // gap                                  // .....................................................
        sub v26.8H, v16.8H, v23.8H              // ...........................................*.........
        // gap                                  // .....................................................
        add v8.8H, v16.8H, v23.8H               // .............................................*.......
        // gap                                  // .....................................................
        vins v25, x16, 0                        // .........................*...........................
        mls v20.8H, v1.8H, v7.H[0]              // ...............................................*.....
        vins v1, x10, 0                         // .................................................*...
        mls v17.8H, v4.8H, v7.H[0]              // ................................................*....
        ldr x10, [x4, #-72]                     // ...............................*.....................
        ldr x16, [x4, #-8]                      // ....................................................*
        vins v19, x7, 0                         // ............................................*........
        
        // original source code
        // ldr x28, [x1, #32]                    // .......*............................................. || .*.............
        // ldr x20, [x3] , #16                   // ....*................................................ || *..............
        // ldr x23, [x1, #48]                    // ...*................................................. || *..............
        // vins v9, x28, 0                       // ................*.................................... || ...*...........
        // vins v12, x20, 0                      // .............*....................................... || ..*............
        // ldr x28, [x1, #40]                    // .*................................................... || *..............
        // ldr x10, [x3, #-8]                    // ......*.............................................. || .*.............
        // vins v21, x23, 0                      // ............*........................................ || ..*............
        // ldr x8, [x1, #56]                     // ..............*...................................... || ..*............
        // vins v12, x10, 1                      // ...................*................................. || ....*..........
        // vins v9, x28, 1                       // .....................*............................... || .....*.........
        // vins v21, x8, 1                       // .................*................................... || ....*..........
        // ldr x26, [x4, #56]                    // ........*............................................ || .*.............
        // mul v10.8H, v9.8H, v12.H[0]           // .............................*....................... || .......*.......
        // ldr x12, [x1, #16]                    // ..*.................................................. || *..............
        // ldr x19, [x4] , #96                   // .........*........................................... || .*.............
        // ldr x16, [x4, #-64]                   // ......................................*.............. || ..........*....
        // sqrdmulh v1.8H, v9.8H, v12.H[1]       // ................................*.................... || ........*......
        // mul v14.8H, v21.8H, v12.H[0]          // .........................*........................... || ......*........
        // ldr x25, [x1, #24]                    // ..................*.................................. || ....*..........
        // ldr x28, [x1, #0]                     // ..........................*.......................... || ......*........
        // vins v29, x19, 0                      // ...............*..................................... || ...*...........
        // vins v5, x12, 0                       // ...........*......................................... || ..*............
        // ldr x14, [x4, #-56]                   // ......................*.............................. || .....*.........
        // vins v18, x28, 0                      // ...............................*..................... || ........*......
        // vins v25, x16, 0                      // ..............................................*...... || .............*.
        // ldr x23, [x1, #8]                     // .................................*................... || ........*......
        // ldr x16, [x4, #-88]                   // ..........*.......................................... || .*.............
        // sqrdmulh v6.8H, v21.8H, v12.H[1]      // .......................*............................. || ......*........
        // vins v5, x25, 1                       // ........................*............................ || ......*........
        // ldr x25, [x4, #-80]                   // *.................................................... || *..............
        // ldr x10, [x4, #-72]                   // ..................................................*.. || ..............*
        // vins v18, x23, 1                      // .....................................*............... || ..........*....
        // vins v29, x16, 1                      // ............................*........................ || .......*.......
        // ldr x16, [x4, #-32]                   // ....................*................................ || ....*..........
        // mls v10.8H, v1.8H, v7.H[0]            // ....................................*................ || ..........*....
        // mls v14.8H, v6.8H, v7.H[0]            // ..............................*...................... || ........*......
        // sub v0.8H, v5.8H, v14.8H              // ..................................*.................. || ..........*....
        // add v4.8H, v5.8H, v14.8H              // ...................................*................. || ..........*....
        // sqrdmulh v1.8H, v4.8H, v12.H[3]       // .......................................*............. || ...........*...
        // mul v20.8H, v4.8H, v12.H[2]           // ..........................................*.......... || ............*..
        // mul v17.8H, v0.8H, v12.H[4]           // ........................................*............ || ...........*...
        // sqrdmulh v15.8H, v0.8H, v12.H[5]      // .........................................*........... || ............*..
        // sub v26.8H, v18.8H, v10.8H            // ............................................*........ || .............*.
        // vins v19, x16, 0                      // ....................................................* || ..............*
        // add v8.8H, v18.8H, v10.8H             // .............................................*....... || .............*.
        // ldr x16, [x4, #-16]                   // .....*............................................... || *..............
        // mls v20.8H, v1.8H, v7.H[0]            // ...............................................*..... || ..............*
        // mls v17.8H, v15.8H, v7.H[0]           // .................................................*... || ..............*
        // vins v1, x25, 0                       // ................................................*.... || ..............*
        // vins v27, x16, 0                      // ...........................................*......... || ............*..
        // ldr x25, [x4, #-48]                   // ...........................*......................... || ......*........
        // ldr x16, [x4, #-8]                    // ...................................................*. || ..............*
        
        sub count, count, #1
.p2align 2
layer4567_start:
        sub v12.8H, v8.8H, v20.8H                            // .................................*.......................................................................
        add v4.8H, v8.8H, v20.8H                             // ..................................*......................................................................
        add v8.8H, v26.8H, v17.8H                            // .......................................*.................................................................
        sub v14.8H, v26.8H, v17.8H                           // ......................................*..................................................................
        ldr x28, [x1, #96]                                   // ........e................................................................................................
        ldr x20, [x3] , #16                                  // ................e........................................................................................
        trn2 v30.4S, v4.4S, v12.4S                           // .........................................*...............................................................
        trn1 v31.4S, v4.4S, v12.4S                           // ........................................*................................................................
        trn2 v4.4S, v8.4S, v14.4S                            // ...........................................*.............................................................
        trn1 v17.4S, v8.4S, v14.4S                           // ..........................................*..............................................................
        ldr x23, [x1, #112]                                  // ............e............................................................................................
        vins v1, x10, 1                                      // .......................................................*.................................................
        vins v9, x28, 0                                      // ..........e..............................................................................................
        vins v12, x20, 0                                     // ..................e......................................................................................
        trn2 v15.2D, v30.2D, v4.2D                           // .............................................*...........................................................
        ldr x28, [x1, #104]                                  // .........e...............................................................................................
        trn2 v8.2D, v31.2D, v17.2D                           // ............................................*............................................................
        ldr x10, [x3, #-8]                                   // .................e.......................................................................................
        mul v16.8H, v15.8H, v29.8H                           // .............................................................................*...........................
        trn1 v5.2D, v30.2D, v4.2D                            // ...............................................*.........................................................
        sqrdmulh v4.8H, v15.8H, v1.8H                        // ..............................................................................*..........................
        vins v21, x23, 0                                     // ..............e..........................................................................................
        ldr x8, [x1, #120]                                   // .............e...........................................................................................
        vins v18, x25, 0                                     // ..............................................................*..........................................
        sqrdmulh v3.8H, v8.8H, v1.8H                         // .........................................................................*...............................
        vins v12, x10, 1                                     // ...................e.....................................................................................
        mul v0.8H, v8.8H, v29.8H                             // ........................................................................*................................
        vins v27, x16, 1                                     // .......................................................................*.................................
        ldr x16, [x4, #-24]                                  // .................................................................*.......................................
        vins v9, x28, 1                                      // ...........e.............................................................................................
        trn1 v15.2D, v31.2D, v17.2D                          // ..............................................*..........................................................
        vins v21, x8, 1                                      // ...............e.........................................................................................
        mls v16.8H, v4.8H, v7.H[0]                           // ...............................................................................*.........................
        vins v18, x26, 1                                     // ...............................................................*.........................................
        vins v25, x14, 1                                     // ...........................................................*.............................................
        ldr x26, [x4, #56]                                   // .............................................................e...........................................
        mls v0.8H, v3.8H, v7.H[0]                            // ..........................................................................*..............................
        vins v19, x16, 1                                     // ...................................................................*.....................................
        mul v10.8H, v9.8H, v12.H[0]                          // ....................e....................................................................................
        ldr x12, [x1, #80]                                   // ....e....................................................................................................
        ldr x19, [x4] , #96                                  // ................................................e........................................................
        ldr x16, [x4, #-64]                                  // ........................................................e................................................
        sqrdmulh v1.8H, v9.8H, v12.H[1]                      // .....................e...................................................................................
        sub v9.8H, v5.8H, v16.8H                             // ................................................................................*........................
        mul v14.8H, v21.8H, v12.H[0]                         // .........................e...............................................................................
        add v8.8H, v5.8H, v16.8H                             // .................................................................................*.......................
        ldr x25, [x1, #88]                                   // .....e...................................................................................................
        ldr x28, [x1, #64]                                   // e........................................................................................................
        sqrdmulh v20.8H, v9.8H, v27.8H                       // ........................................................................................*................
        vins v29, x19, 0                                     // ..................................................e......................................................
        mul v16.8H, v9.8H, v19.8H                            // .......................................................................................*.................
        sub v4.8H, v15.8H, v0.8H                             // ...........................................................................*.............................
        vins v5, x12, 0                                      // ......e..................................................................................................
        ldr x14, [x4, #-56]                                  // .........................................................e...............................................
        sqrdmulh v27.8H, v8.8H, v18.8H                       // ...................................................................................*.....................
        vins v18, x28, 0                                     // ..e......................................................................................................
        mul v19.8H, v8.8H, v25.8H                            // ..................................................................................*......................
        vins v25, x16, 0                                     // ..........................................................e..............................................
        ldr x23, [x1, #72]                                   // .e.......................................................................................................
        ldr x16, [x4, #-88]                                  // .................................................e.......................................................
        sqrdmulh v6.8H, v21.8H, v12.H[1]                     // ..........................e..............................................................................
        vins v5, x25, 1                                      // .......e.................................................................................................
        mls v16.8H, v20.8H, v7.H[0]                          // .........................................................................................*...............
        ldr x25, [x4, #-80]                                  // ....................................................e....................................................
        ldr x10, [x4, #-72]                                  // .....................................................e...................................................
        // gap                                               // .........................................................................................................
        vins v18, x23, 1                                     // ...e.....................................................................................................
        vins v29, x16, 1                                     // ...................................................e.....................................................
        mls v19.8H, v27.8H, v7.H[0]                          // ....................................................................................*....................
        add v27.8H, v15.8H, v0.8H                            // ............................................................................*............................
        ldr x16, [x4, #-32]                                  // ................................................................e........................................
        // gap                                               // .........................................................................................................
        mls v10.8H, v1.8H, v7.H[0]                           // ......................e..................................................................................
        add v23.8H, v4.8H, v16.8H                            // ...........................................................................................*.............
        mls v14.8H, v6.8H, v7.H[0]                           // ...........................e.............................................................................
        sub v24.8H, v4.8H, v16.8H                            // ..........................................................................................*..............
        // gap                                               // .........................................................................................................
        // gap                                               // .........................................................................................................
        sqdmulh v20.8H, v24.8H, v7.H[1]                      // .....................................................................................................*...
        add v21.8H, v27.8H, v19.8H                           // ......................................................................................*..................
        sqdmulh v16.8H, v23.8H, v7.H[1]                      // ..................................................................................................*......
        sub v22.8H, v27.8H, v19.8H                           // .....................................................................................*...................
        // gap                                               // .........................................................................................................
        // gap                                               // .........................................................................................................
        sqdmulh v27.8H, v22.8H, v7.H[1]                      // ...............................................................................................*.........
        sub v0.8H, v5.8H, v14.8H                             // ............................e............................................................................
        sqdmulh v19.8H, v21.8H, v7.H[1]                      // ............................................................................................*............
        add v4.8H, v5.8H, v14.8H                             // .............................e...........................................................................
        // gap                                               // .........................................................................................................
        // gap                                               // .........................................................................................................
        sqrdmulh v1.8H, v4.8H, v12.H[3]                      // ...............................e.........................................................................
        srshr v3.8H, v20.8H, #11                             // ......................................................................................................*..
        mul v20.8H, v4.8H, v12.H[2]                          // ..............................e..........................................................................
        srshr v16.8H, v16.8H, #11                            // ...................................................................................................*.....
        // gap                                               // .........................................................................................................
        // gap                                               // .........................................................................................................
        mul v17.8H, v0.8H, v12.H[4]                          // ...................................e.....................................................................
        srshr v19.8H, v19.8H, #11                            // .............................................................................................*...........
        sqrdmulh v15.8H, v0.8H, v12.H[5]                     // ....................................e....................................................................
        srshr v27.8H, v27.8H, #11                            // ................................................................................................*........
        // gap                                               // .........................................................................................................
        // gap                                               // .........................................................................................................
        mls v23.8H, v16.8H, v7.H[0]                          // ....................................................................................................*....
        // gap                                               // .........................................................................................................
        mls v24.8H, v3.8H, v7.H[0]                           // .......................................................................................................*.
        sub v26.8H, v18.8H, v10.8H                           // .......................e.................................................................................
        // gap                                               // .........................................................................................................
        // gap                                               // .........................................................................................................
        mls v21.8H, v19.8H, v7.H[0]                          // ..............................................................................................*..........
        vins v19, x16, 0                                     // ..................................................................e......................................
        mls v22.8H, v27.8H, v7.H[0]                          // .................................................................................................*.......
        add v8.8H, v18.8H, v10.8H                            // ........................e................................................................................
        ldr x16, [x4, #-16]                                  // ....................................................................e....................................
        // gap                                               // .........................................................................................................
        mls v20.8H, v1.8H, v7.H[0]                           // ................................e........................................................................
        // gap                                               // .........................................................................................................
        mls v17.8H, v15.8H, v7.H[0]                          // .....................................e...................................................................
        // gap                                               // .........................................................................................................
        // gap                                               // .........................................................................................................
        // gap                                               // .........................................................................................................
        vins v1, x25, 0                                      // ......................................................e..................................................
        st4 {v21.4S,v22.4S,v23.4S,v24.4S}, [x1], #64         // ........................................................................................................*
        vins v27, x16, 0                                     // ......................................................................e..................................
        ldr x25, [x4, #-48]                                  // ............................................................e............................................
        ldr x16, [x4, #-8]                                   // .....................................................................e...................................
        // gap                                               // .........................................................................................................
        
        // original source code
        // ldr x10, [x1, #0]                               // ...........................................e............................................................................................................................................................... || .......e..................................
        // ldr x11, [x1, #8]                               // ......................................................e.................................................................................................................................................... || .........e................................
        // vins v8, x10, 0                                 // ...................................................e....................................................................................................................................................... || .........e................................
        // vins v8, x11, 1                                 // .............................................................e............................................................................................................................................. || ...........e..............................
        // ldr x10, [x1, #16]                              // ...................................e....................................................................................................................................................................... || ......e...................................
        // ldr x11, [x1, #24]                              // ..........................................e................................................................................................................................................................ || .......e..................................
        // vins v9, x10, 0                                 // ................................................e.......................................................................................................................................................... || ........e.................................
        // vins v9, x11, 1                                 // .........................................................e................................................................................................................................................. || ..........e...............................
        // ldr x10, [x1, #32]                              // e.......................................................................................................................................................................................................... || e.........................................
        // ldr x11, [x1, #40]                              // ...........e............................................................................................................................................................................................... || ..e.......................................
        // vins v10, x10, 0                                // ........e.................................................................................................................................................................................................. || ..e.......................................
        // vins v10, x11, 1                                // .........................e................................................................................................................................................................................. || ....e.....................................
        // ldr x10, [x1, #48]                              // ......e.................................................................................................................................................................................................... || .e........................................
        // ldr x11, [x1, #56]                              // ..................e........................................................................................................................................................................................ || ...e......................................
        // vins v11, x10, 0                                // .................e......................................................................................................................................................................................... || ...e......................................
        // vins v11, x11, 1                                // ...........................e............................................................................................................................................................................... || .....e....................................
        // ldr x10, [x3] , #16                             // .e......................................................................................................................................................................................................... || e.........................................
        // ldr x11, [x3, #-8]                              // .............e............................................................................................................................................................................................. || ..e.......................................
        // vins v0, x10, 0                                 // .........e................................................................................................................................................................................................. || ..e.......................................
        // vins v0, x11, 1                                 // .....................e..................................................................................................................................................................................... || ....e.....................................
        // mul v24.8H, v10.8H, v0.H[0]                     // ..................................e........................................................................................................................................................................ || ......e...................................
        // sqrdmulh v10.8H, v10.8H, v0.H[1]                // ......................................e.................................................................................................................................................................... || .......e..................................
        // mls v24.8H, v10.8H, v7.H[0]                     // ..................................................................e........................................................................................................................................ || ............e.............................
        // sub v10.8H, v8.8H, v24.8H                       // ........................................................................................e.................................................................................................................. || .................e........................
        // add v8.8H, v8.8H, v24.8H                        // ............................................................................................e.............................................................................................................. || ..................e.......................
        // mul v24.8H, v11.8H, v0.H[0]                     // ........................................e.................................................................................................................................................................. || .......e..................................
        // sqrdmulh v11.8H, v11.8H, v0.H[1]                // ........................................................e.................................................................................................................................................. || ..........e...............................
        // mls v24.8H, v11.8H, v7.H[0]                     // ....................................................................e...................................................................................................................................... || ............e.............................
        // sub v11.8H, v9.8H, v24.8H                       // ...........................................................................e............................................................................................................................... || ..............e...........................
        // add v9.8H, v9.8H, v24.8H                        // .............................................................................e............................................................................................................................. || ..............e...........................
        // mul v24.8H, v9.8H, v0.H[2]                      // ................................................................................e.......................................................................................................................... || ...............e..........................
        // sqrdmulh v9.8H, v9.8H, v0.H[3]                  // ..............................................................................e............................................................................................................................ || ...............e..........................
        // mls v24.8H, v9.8H, v7.H[0]                      // ..............................................................................................e............................................................................................................ || ...................e......................
        // sub v9.8H, v8.8H, v24.8H                        // .....................................................................................................*..................................................................................................... || .....................*....................
        // add v8.8H, v8.8H, v24.8H                        // ......................................................................................................*.................................................................................................... || .....................*....................
        // mul v24.8H, v11.8H, v0.H[4]                     // ..................................................................................e........................................................................................................................ || ................e.........................
        // sqrdmulh v11.8H, v11.8H, v0.H[5]                // ....................................................................................e...................................................................................................................... || ................e.........................
        // mls v24.8H, v11.8H, v7.H[0]                     // ...............................................................................................e........................................................................................................... || ...................e......................
        // sub v11.8H, v10.8H, v24.8H                      // ........................................................................................................*.................................................................................................. || .....................*....................
        // add v10.8H, v10.8H, v24.8H                      // .......................................................................................................*................................................................................................... || .....................*....................
        // trn1 v25.4S, v8.4S, v9.4S                       // ............................................................................................................*.............................................................................................. || ......................*...................
        // trn2 v26.4S, v8.4S, v9.4S                       // ...........................................................................................................*............................................................................................... || ......................*...................
        // trn1 v27.4S, v10.4S, v11.4S                     // ..............................................................................................................*............................................................................................ || ......................*...................
        // trn2 v28.4S, v10.4S, v11.4S                     // .............................................................................................................*............................................................................................. || ......................*...................
        // trn2 v10.2D, v25.2D, v27.2D                     // .....................................................................................................................*..................................................................................... || .......................*..................
        // trn2 v11.2D, v26.2D, v28.2D                     // ...................................................................................................................*....................................................................................... || .......................*..................
        // trn1 v8.2D, v25.2D, v27.2D                      // ...................................................................................................................................*....................................................................... || ..........................*...............
        // trn1 v9.2D, v26.2D, v28.2D                      // ........................................................................................................................*.................................................................................. || ........................*.................
        // ldr x10, [x4] , #96                             // ....................................e...................................................................................................................................................................... || ......e...................................
        // ldr x11, [x4, #-88]                             // .......................................................e................................................................................................................................................... || .........e................................
        // vins v0, x10, 0                                 // .............................................e............................................................................................................................................................. || ........e.................................
        // vins v0, x11, 1                                 // ..............................................................e............................................................................................................................................ || ...........e..............................
        // ldr x10, [x4, #-80]                             // ...........................................................e............................................................................................................................................... || ..........e...............................
        // ldr x11, [x4, #-72]                             // ............................................................e.............................................................................................................................................. || ..........e...............................
        // vins v4, x10, 0                                 // ................................................................................................e.......................................................................................................... || ....................e.....................
        // vins v4, x11, 1                                 // ................................................................................................................*.......................................................................................... || ......................*...................
        // ldr x10, [x4, #-64]                             // .....................................e..................................................................................................................................................................... || ......e...................................
        // ldr x11, [x4, #-56]                             // .................................................e......................................................................................................................................................... || ........e.................................
        // vins v1, x10, 0                                 // .....................................................e..................................................................................................................................................... || .........e................................
        // vins v1, x11, 1                                 // .......................................................................................................................................*................................................................... || ..........................*...............
        // ldr x10, [x4, #-48]                             // ...................................................................................................e....................................................................................................... || ....................e.....................
        // ldr x11, [x4, #-40]                             // ...............................e........................................................................................................................................................................... || .....e....................................
        // vins v5, x10, 0                                 // ............................................................................................................................*.............................................................................. || ........................*.................
        // vins v5, x11, 1                                 // ......................................................................................................................................*.................................................................... || ..........................*...............
        // ldr x10, [x4, #-32]                             // .................................................................e......................................................................................................................................... || ...........e..............................
        // ldr x11, [x4, #-24]                             // .................................................................................................................................*......................................................................... || .........................*................
        // vins v2, x10, 0                                 // ..........................................................................................e................................................................................................................ || ..................e.......................
        // vins v2, x11, 1                                 // ..........................................................................................................................................*................................................................ || ...........................*..............
        // ldr x10, [x4, #-16]                             // .............................................................................................e............................................................................................................. || ..................e.......................
        // ldr x11, [x4, #-8]                              // ....................................................................................................e...................................................................................................... || ....................e.....................
        // vins v6, x10, 0                                 // ..................................................................................................e........................................................................................................ || ....................e.....................
        // vins v6, x11, 1                                 // ................................................................................................................................*.......................................................................... || .........................*................
        // mul v24.8H, v10.8H, v0.8H                       // ...............................................................................................................................*........................................................................... || .........................*................
        // sqrdmulh v10.8H, v10.8H, v4.8H                  // .............................................................................................................................*............................................................................. || .........................*................
        // mls v24.8H, v10.8H, v7.H[0]                     // .........................................................................................................................................*................................................................. || ...........................*..............
        // sub v10.8H, v8.8H, v24.8H                       // ........................................................................................................................................................*.................................................. || .............................*............
        // add v8.8H, v8.8H, v24.8H                        // .........................................................................................................................................................................*................................. || ................................*.........
        // mul v24.8H, v11.8H, v0.8H                       // .......................................................................................................................*................................................................................... || ........................*.................
        // sqrdmulh v11.8H, v11.8H, v4.8H                  // .........................................................................................................................*................................................................................. || ........................*.................
        // mls v24.8H, v11.8H, v7.H[0]                     // .....................................................................................................................................*..................................................................... || ..........................*...............
        // sub v11.8H, v9.8H, v24.8H                       // ................................................................................................................................................*.......................................................... || ............................*.............
        // add v9.8H, v9.8H, v24.8H                        // ..................................................................................................................................................*........................................................ || ............................*.............
        // mul v24.8H, v9.8H, v1.8H                        // .............................................................................................................................................................*............................................. || ..............................*...........
        // sqrdmulh v9.8H, v9.8H, v5.8H                    // ...........................................................................................................................................................*............................................... || ..............................*...........
        // mls v24.8H, v9.8H, v7.H[0]                      // ........................................................................................................................................................................*.................................. || ................................*.........
        // sub v9.8H, v8.8H, v24.8H                        // ..................................................................................................................................................................................*........................ || ..................................*.......
        // add v8.8H, v8.8H, v24.8H                        // ................................................................................................................................................................................*.......................... || ..................................*.......
        // mul v24.8H, v11.8H, v2.8H                       // .......................................................................................................................................................*................................................... || .............................*............
        // sqrdmulh v11.8H, v11.8H, v6.8H                  // .....................................................................................................................................................*..................................................... || .............................*............
        // mls v24.8H, v11.8H, v7.H[0]                     // ...................................................................................................................................................................*....................................... || ...............................*..........
        // sub v11.8H, v10.8H, v24.8H                      // ..............................................................................................................................................................................*............................ || .................................*........
        // add v10.8H, v10.8H, v24.8H                      // ............................................................................................................................................................................*.............................. || .................................*........
        // sqdmulh v25.8H, v8.8H, v7.H[1]                  // .....................................................................................................................................................................................*..................... || ...................................*......
        // srshr v25.8H, v25.8H, #11                       // ............................................................................................................................................................................................*.............. || .....................................*....
        // mls v8.8H, v25.8H, v7.H[0]                      // ..................................................................................................................................................................................................*........ || .......................................*..
        // sqdmulh v25.8H, v9.8H, v7.H[1]                  // ...................................................................................................................................................................................*....................... || ...................................*......
        // srshr v25.8H, v25.8H, #11                       // ..............................................................................................................................................................................................*............ || .....................................*....
        // mls v9.8H, v25.8H, v7.H[0]                      // ....................................................................................................................................................................................................*...... || .......................................*..
        // sqdmulh v25.8H, v10.8H, v7.H[1]                 // .................................................................................................................................................................................*......................... || ..................................*.......
        // srshr v25.8H, v25.8H, #11                       // ..........................................................................................................................................................................................*................ || ....................................*.....
        // mls v10.8H, v25.8H, v7.H[0]                     // ...............................................................................................................................................................................................*........... || ......................................*...
        // sqdmulh v25.8H, v11.8H, v7.H[1]                 // ...............................................................................................................................................................................*........................... || ..................................*.......
        // srshr v25.8H, v25.8H, #11                       // ........................................................................................................................................................................................*.................. || ....................................*.....
        // mls v11.8H, v25.8H, v7.H[0]                     // ................................................................................................................................................................................................*.......... || ......................................*...
        // st4 {v8.4S,v9.4S,v10.4S,v11.4S}, [x1], #64      // ..........................................................................................................................................................................................................* || .........................................*
        
        subs count, count, #1
        cbnz count, layer4567_start
        add v16.8H, v26.8H, v17.8H                           // ..*.................................................
        add v0.8H, v8.8H, v20.8H                             // .*..................................................
        sub v18.8H, v8.8H, v20.8H                            // *...................................................
        sub v4.8H, v26.8H, v17.8H                            // ...*................................................
        vins v27, x16, 1                                     // .................*..................................
        ldr x16, [x4, #-24]                                  // ..................*.................................
        trn1 v9.4S, v0.4S, v18.4S                            // .....*..............................................
        vins v25, x14, 1                                     // ......................*.............................
        trn2 v28.4S, v0.4S, v18.4S                           // ....*...............................................
        vins v1, x10, 1                                      // ........*...........................................
        trn2 v21.4S, v16.4S, v4.4S                           // ......*.............................................
        // gap                                               // ....................................................
        vins v19, x16, 1                                     // ........................*...........................
        trn1 v31.4S, v16.4S, v4.4S                           // .......*............................................
        trn2 v16.2D, v28.2D, v21.2D                          // .........*..........................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        sqrdmulh v4.8H, v16.8H, v1.8H                        // .............*......................................
        // gap                                               // ....................................................
        mul v2.8H, v16.8H, v29.8H                            // ...........*........................................
        trn2 v16.2D, v9.2D, v31.2D                           // ..........*.........................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mul v5.8H, v16.8H, v29.8H                            // ................*...................................
        vins v18, x25, 0                                     // ..............*.....................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mls v2.8H, v4.8H, v7.H[0]                            // ....................*...............................
        // gap                                               // ....................................................
        sqrdmulh v4.8H, v16.8H, v1.8H                        // ...............*....................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        vins v18, x26, 1                                     // .....................*..............................
        trn1 v16.2D, v28.2D, v21.2D                          // ............*.......................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mls v5.8H, v4.8H, v7.H[0]                            // .......................*............................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        add v4.8H, v16.8H, v2.8H                             // ..........................*.........................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mul v0.8H, v4.8H, v25.8H                             // ...............................*....................
        sub v16.8H, v16.8H, v2.8H                            // .........................*..........................
        sqrdmulh v4.8H, v4.8H, v18.8H                        // ..............................*.....................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mul v28.8H, v16.8H, v19.8H                           // ............................*.......................
        // gap                                               // ....................................................
        sqrdmulh v16.8H, v16.8H, v27.8H                      // ...........................*........................
        trn1 v27.2D, v9.2D, v31.2D                           // ...................*................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mls v0.8H, v4.8H, v7.H[0]                            // .................................*..................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        sub v18.8H, v27.8H, v5.8H                            // .............................*......................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mls v28.8H, v16.8H, v7.H[0]                          // ................................*...................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        add v16.8H, v27.8H, v5.8H                            // ..................................*.................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        add v21.8H, v16.8H, v0.8H                            // ......................................*.............
        // gap                                               // ....................................................
        sub v22.8H, v16.8H, v0.8H                            // ........................................*...........
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        sqdmulh v27.8H, v22.8H, v7.H[1]                      // .........................................*..........
        add v23.8H, v18.8H, v28.8H                           // ...................................*................
        sqdmulh v4.8H, v21.8H, v7.H[1]                       // ..........................................*.........
        sub v24.8H, v18.8H, v28.8H                           // ....................................*...............
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        sqdmulh v0.8H, v24.8H, v7.H[1]                       // .....................................*..............
        // gap                                               // ....................................................
        sqdmulh v19.8H, v23.8H, v7.H[1]                      // .......................................*............
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        srshr v16.8H, v4.8H, #11                             // .............................................*......
        srshr v4.8H, v27.8H, #11                             // ..............................................*.....
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        srshr v27.8H, v19.8H, #11                            // ............................................*.......
        srshr v19.8H, v0.8H, #11                             // ...........................................*........
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mls v21.8H, v16.8H, v7.H[0]                          // .................................................*..
        // gap                                               // ....................................................
        mls v22.8H, v4.8H, v7.H[0]                           // ..................................................*.
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        mls v23.8H, v27.8H, v7.H[0]                          // ...............................................*....
        // gap                                               // ....................................................
        mls v24.8H, v19.8H, v7.H[0]                          // ................................................*...
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        st4 {v21.4S,v22.4S,v23.4S,v24.4S}, [x1], #64         // ...................................................*
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        // gap                                               // ....................................................
        
        // original source code
        // sub v12.8H, v8.8H, v20.8H                         // ..*................................................. || *....................
        // add v4.8H, v8.8H, v20.8H                          // .*.................................................. || *....................
        // add v8.8H, v26.8H, v17.8H                         // *................................................... || *....................
        // sub v14.8H, v26.8H, v17.8H                        // ...*................................................ || *....................
        // trn2 v30.4S, v4.4S, v12.4S                        // ........*........................................... || .*...................
        // trn1 v31.4S, v4.4S, v12.4S                        // ......*............................................. || .*...................
        // trn2 v4.4S, v8.4S, v14.4S                         // ..........*......................................... || .*...................
        // trn1 v17.4S, v8.4S, v14.4S                        // ............*....................................... || ..*..................
        // vins v1, x10, 1                                   // .........*.......................................... || .*...................
        // trn2 v15.2D, v30.2D, v4.2D                        // .............*...................................... || ..*..................
        // trn2 v8.2D, v31.2D, v17.2D                        // ................*................................... || ...*.................
        // mul v16.8H, v15.8H, v29.8H                        // ...............*.................................... || ...*.................
        // trn1 v5.2D, v30.2D, v4.2D                         // ......................*............................. || ......*..............
        // sqrdmulh v4.8H, v15.8H, v1.8H                     // ..............*..................................... || ...*.................
        // vins v18, x25, 0                                  // ..................*................................. || ....*................
        // sqrdmulh v3.8H, v8.8H, v1.8H                      // ....................*............................... || .....*...............
        // mul v0.8H, v8.8H, v29.8H                          // .................*.................................. || ....*................
        // vins v27, x16, 1                                  // ....*............................................... || *....................
        // ldr x16, [x4, #-24]                               // .....*.............................................. || *....................
        // trn1 v15.2D, v31.2D, v17.2D                       // ..............................*..................... || .........*...........
        // mls v16.8H, v4.8H, v7.H[0]                        // ...................*................................ || .....*...............
        // vins v18, x26, 1                                  // .....................*.............................. || ......*..............
        // vins v25, x14, 1                                  // .......*............................................ || .*...................
        // mls v0.8H, v3.8H, v7.H[0]                         // .......................*............................ || .......*.............
        // vins v19, x16, 1                                  // ...........*........................................ || ..*..................
        // sub v9.8H, v5.8H, v16.8H                          // ..........................*......................... || ........*............
        // add v8.8H, v5.8H, v16.8H                          // ........................*........................... || .......*.............
        // sqrdmulh v20.8H, v9.8H, v27.8H                    // .............................*...................... || .........*...........
        // mul v16.8H, v9.8H, v19.8H                         // ............................*....................... || .........*...........
        // sub v4.8H, v15.8H, v0.8H                          // ................................*................... || ..........*..........
        // sqrdmulh v27.8H, v8.8H, v18.8H                    // ...........................*........................ || ........*............
        // mul v19.8H, v8.8H, v25.8H                         // .........................*.......................... || ........*............
        // mls v16.8H, v20.8H, v7.H[0]                       // .................................*.................. || ...........*.........
        // mls v19.8H, v27.8H, v7.H[0]                       // ...............................*.................... || ..........*..........
        // add v27.8H, v15.8H, v0.8H                         // ..................................*................. || ...........*.........
        // add v23.8H, v4.8H, v16.8H                         // ......................................*............. || .............*.......
        // sub v24.8H, v4.8H, v16.8H                         // ........................................*........... || .............*.......
        // sqdmulh v20.8H, v24.8H, v7.H[1]                   // .........................................*.......... || ..............*......
        // add v21.8H, v27.8H, v19.8H                        // ...................................*................ || ............*........
        // sqdmulh v16.8H, v23.8H, v7.H[1]                   // ..........................................*......... || ..............*......
        // sub v22.8H, v27.8H, v19.8H                        // ....................................*............... || ............*........
        // sqdmulh v27.8H, v22.8H, v7.H[1]                   // .....................................*.............. || .............*.......
        // sqdmulh v19.8H, v21.8H, v7.H[1]                   // .......................................*............ || .............*.......
        // srshr v3.8H, v20.8H, #11                          // ..............................................*..... || ................*....
        // srshr v16.8H, v16.8H, #11                         // .............................................*...... || ................*....
        // srshr v19.8H, v19.8H, #11                         // ...........................................*........ || ...............*.....
        // srshr v27.8H, v27.8H, #11                         // ............................................*....... || ...............*.....
        // mls v23.8H, v16.8H, v7.H[0]                       // .................................................*.. || ..................*..
        // mls v24.8H, v3.8H, v7.H[0]                        // ..................................................*. || ..................*..
        // mls v21.8H, v19.8H, v7.H[0]                       // ...............................................*.... || .................*...
        // mls v22.8H, v27.8H, v7.H[0]                       // ................................................*... || .................*...
        // st4 {v21.4S,v22.4S,v23.4S,v24.4S}, [x1], #64      // ...................................................* || ....................*
        

       pop_stack
       ret