///
/// Copyright (c) 2022 Arm Limited
/// Copyright (c) 2022 Hanno Becker
/// Copyright (c) 2023 Amin Abdulrahman, Matthias Kannwischer
/// SPDX-License-Identifier: MIT
///
/// Permission is hereby granted, free of charge, to any person obtaining a copy
/// of this software and associated documentation files (the "Software"), to deal
/// in the Software without restriction, including without limitation the rights
/// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
/// copies of the Software, and to permit persons to whom the Software is
/// furnished to do so, subject to the following conditions:
///
/// The above copyright notice and this permission notice shall be included in all
/// copies or substantial portions of the Software.
///
/// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
/// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
/// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
/// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
/// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
/// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
/// SOFTWARE.
///

// Needed to provide ASM_LOAD directive
#include <hal_env.h>

// NOTE
// We use a lot of trivial macros to simplify the parsing burden for Slothy
// The macros are not unfolded by Slothy and thus interpreted as instructions,
// which are easier to parse due to e.g. the lack of size specifiers and simpler
// syntax for pre and post increment for loads and stores.
//
// Eventually, NeLight should include a proper parser for AArch64,
// but for initial investigations, the below is enough.

.macro trn1_s d,a,b
        trn1 \d\().4s, \a\().4s, \b\().4s
.endm
.macro trn2_s d,a,b
        trn2 \d\().4s, \a\().4s, \b\().4s
.endm

.macro ldr_vo vec, base, offset                    // slothy:no-unfold
        ldr qform_\vec, [\base, \offset]
.endm
.macro ldr_vi vec, base, inc                        // slothy:no-unfold
        ldr qform_\vec, [\base], \inc
.endm
.macro str_vo vec, base, offset                     // slothy:no-unfold
        str qform_\vec, [\base, \offset]
.endm
.macro str_vi vec, base, inc                        // slothy:no-unfold
        str qform_\vec, [\base], \inc
.endm
.macro vqrdmulh d,a,b
        sqrdmulh \d\().8h, \a\().8h, \b\().8h
.endm
.macro vmla d,a,b
        mla \d\().8h, \a\().8h, \b\().8h
.endm
.macro vqrdmulhq d,a,b,i
        sqrdmulh \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vqdmulhq d,a,b,i
        sqdmulh \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vmulq d,a,b,i
        mul \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vmlaq d,a,b,i
        mla \d\().8h, \a\().8h, \b\().h[\i]
.endm

.macro mulmodq dst, src, const, idx0, idx1
        vmulq       \dst,  \src, \const, \idx0
        vqrdmulhq   \src,  \src, \const, \idx1
        vmlaq        \dst,  \src, consts, 0
.endm

.macro mulmod dst, src, const, const_twisted
        mul        \dst\().8h,  \src\().8h, \const\().8h
        vqrdmulh   \src,  \src, \const_twisted
        vmlaq      \dst,  \src, consts, 0
.endm

.macro ct_butterfly a, b, root, idx0, idx1
        mulmodq  tmp, \b, \root, \idx0, \idx1
        sub     \b\().8h,    \a\().8h, tmp.8h
        add     \a\().8h,    \a\().8h, tmp.8h
.endm

.macro mulmod_v dst, src, const, const_twisted
        vmul        \dst,  \src, \const
        vqrdmulh    \src,  \src, \const_twisted
        vmla        \dst,  \src, consts
.endm

.macro ct_butterfly_v a, b, root, root_twisted
        mulmod  tmp, \b, \root, \root_twisted
        sub    \b\().8h,    \a\().8h, tmp.8h
        add    \a\().8h,    \a\().8h, tmp.8h
.endm

.macro barrett_reduce a
        vqdmulhq t0, \a, consts, 1
        srshr    t0.8H, t0.8H, #11
        vmlaq    \a, t0, consts, 0
.endm

.macro load_roots_123
        ldr_vi root0, r_ptr0, 32
        ldr_vo root1, r_ptr0, -16
.endm

.macro load_next_roots_45 root0, r_ptr0
        ldr_vi \root0, \r_ptr0, 16
.endm

.macro load_next_roots_67 root0, root0_tw, root1, root1_tw, root2, root2_tw, r_ptr1
        ldr_vi \root0,    \r_ptr1, (6*16)
        ldr_vo \root0_tw, \r_ptr1, (-6*16 + 1*16)
        ldr_vo \root1,    \r_ptr1, (-6*16 + 2*16)
        ldr_vo \root1_tw, \r_ptr1, (-6*16 + 3*16)
        ldr_vo \root2,    \r_ptr1, (-6*16 + 4*16)
        ldr_vo \root2_tw, \r_ptr1, (-6*16 + 5*16)
.endm

.macro transpose4 data
        trn1 t0.4s, \data\()0\().4s, \data\()1\().4s
        trn2 t1.4s, \data\()0\().4s, \data\()1\().4s
        trn1 t2.4s, \data\()2\().4s, \data\()3\().4s
        trn2 t3.4s, \data\()2\().4s, \data\()3\().4s

        trn2 \data\()2\().2d, t0.2d, t2.2d
        trn2 \data\()3\().2d, t1.2d, t3.2d
        trn1 \data\()0\().2d, t0.2d, t2.2d
        trn1 \data\()1\().2d, t1.2d, t3.2d
.endm

.macro save_gprs // slothy:no-unfold
        sub sp, sp, #(16*6)
        stp x19, x20, [sp, #16*0]
        stp x19, x20, [sp, #16*0]
        stp x21, x22, [sp, #16*1]
        stp x23, x24, [sp, #16*2]
        stp x25, x26, [sp, #16*3]
        stp x27, x28, [sp, #16*4]
        str x29, [sp, #16*5]
.endm

.macro restore_gprs // slothy:no-unfold
        ldp x19, x20, [sp, #16*0]
        ldp x21, x22, [sp, #16*1]
        ldp x23, x24, [sp, #16*2]
        ldp x25, x26, [sp, #16*3]
        ldp x27, x28, [sp, #16*4]
        ldr x29, [sp, #16*5]
        add sp, sp, #(16*6)
.endm

.macro save_vregs // slothy:no-unfold
        sub sp, sp, #(16*4)
        stp  d8,  d9, [sp, #16*0]
        stp d10, d11, [sp, #16*1]
        stp d12, d13, [sp, #16*2]
        stp d14, d15, [sp, #16*3]
.endm

.macro restore_vregs // slothy:no-unfold
        ldp  d8,  d9, [sp, #16*0]
        ldp d10, d11, [sp, #16*1]
        ldp d12, d13, [sp, #16*2]
        ldp d14, d15, [sp, #16*3]
        add sp, sp, #(16*4)
.endm

#define STACK_SIZE 16
#define STACK0 0

.macro restore a, loc     // slothy:no-unfold
        ldr \a, [sp, #\loc\()]
.endm
.macro save loc, a        // slothy:no-unfold
        str \a, [sp, #\loc\()]
.endm
.macro push_stack // slothy:no-unfold
        save_gprs
        save_vregs
        sub sp, sp, #STACK_SIZE
.endm

.macro pop_stack // slothy:no-unfold
        add sp, sp, #STACK_SIZE
        restore_vregs
        restore_gprs
.endm

.data
.p2align 4
roots:
#include "ntt_kyber_1234_567_twiddles.s"
.text

        .global ntt_kyber_1234_567_opt_x1
        .global _ntt_kyber_1234_567_opt_x1

.p2align 4
const_addr:     .short -3329
                .short 20159
                .short 0
                .short 0
                .short 0
                .short 0
                .short 0
                .short 0

ntt_kyber_1234_567_opt_x1:
_ntt_kyber_1234_567_opt_x1:
        push_stack

        in      .req x0
        inp     .req x1
        count   .req x2
        r_ptr0  .req x3
        r_ptr1  .req x4
        xtmp    .req x5

        src0      .req x6
        src1      .req x7
        src2      .req x8
        src3      .req x9
        src4      .req x10
        src5      .req x11
        src6      .req x12
        src7      .req x13
        src8      .req x14
        src9      .req x15
        src10     .req x16
        src11     .req x17
        src12     .req x18
        src13     .req x19
        src14     .req x20
        src15     .req x21

        qform_v0  .req q0
        qform_v1  .req q1
        qform_v2  .req q2
        qform_v3  .req q3
        qform_v4  .req q4
        qform_v5  .req q5
        qform_v6  .req q6
        qform_v7  .req q7
        qform_v8  .req q8
        qform_v9  .req q9
        qform_v10 .req q10
        qform_v11 .req q11
        qform_v12 .req q12
        qform_v13 .req q13
        qform_v14 .req q14
        qform_v15 .req q15
        qform_v16 .req q16
        qform_v17 .req q17
        qform_v18 .req q18
        qform_v19 .req q19
        qform_v20 .req q20
        qform_v21 .req q21
        qform_v22 .req q22
        qform_v23 .req q23
        qform_v24 .req q24
        qform_v25 .req q25
        qform_v26 .req q26
        qform_v27 .req q27
        qform_v28 .req q28
        qform_v29 .req q29
        qform_v30 .req q30
        qform_v31 .req q31

        data0  .req v9
        data1  .req v10
        data2  .req v11
        data3  .req v12
        data4  .req v13
        data5  .req v14
        data6  .req v15
        data7  .req v16
        data8  .req v17
        data9  .req v18
        data10 .req v19
        data11 .req v20
        data12 .req v21
        data13 .req v22
        data14 .req v23
        data15 .req v24

        qform_data0  .req q9
        qform_data1  .req q10
        qform_data2  .req q11
        qform_data3  .req q12
        qform_data4  .req q13
        qform_data5  .req q14
        qform_data6  .req q15
        qform_data7  .req q16
        qform_data8  .req q17
        qform_data9  .req q18
        qform_data10 .req q19
        qform_data11 .req q20
        qform_data12 .req q21
        qform_data13 .req q22
        qform_data14 .req q23
        qform_data15 .req q24

        root0    .req v0
        root1    .req v1
        root2    .req v2
        root3    .req v3
        root0_tw .req v4
        root1_tw .req v5
        root2_tw .req v6
        root3_tw .req v7

        qform_root0    .req q0
        qform_root1    .req q1
        qform_root2    .req q2
        qform_root3    .req q3
        qform_root0_tw .req q4
        qform_root1_tw .req q5
        qform_root2_tw .req q6
        qform_root3_tw .req q7

        tmp .req v25
        t0  .req v26
        t1  .req v27
        t2  .req v28
        t3  .req v29

        consts .req v8

        ASM_LOAD(r_ptr0, roots)

        ASM_LOAD(xtmp, const_addr)
        ld1 {consts.8h}, [xtmp]

        save STACK0, in

        add  src0, x0,  #32*0
        add  src8, x0,  #32*8

        ld1 { root0.8H,  root1.8H,  root2.8H,  root3.8H}, [r_ptr0], #64

        mov count, #2

        .p2align 2
        ldr_vo v12, x14, 0
        ldr_vo v18, x14, 32
        ldr_vo v21, x14, 96
        mul v31.8H, v12.8H, v0.H[0]
        sqrdmulh v23.8H, v12.8H, v0.H[1]
        ldr_vo v19, x14, 128
        sqrdmulh v12.8H, v18.8H, v0.H[1]
        mul v5.8H, v18.8H, v0.H[0]
        ldr_vo v24, x14, 192
        mla v31.8H, v23.8H, v8.H[0]
        sqrdmulh v10.8H, v24.8H, v0.H[1]
        mul v27.8H, v24.8H, v0.H[0]
        ldr_vo v14, x6, 192
        mul v17.8H, v19.8H, v0.H[0]
        sqrdmulh v22.8H, v19.8H, v0.H[1]
        ldr_vo v15, x14, 160
        mla v27.8H, v10.8H, v8.H[0]
        sqrdmulh v19.8H, v21.8H, v0.H[1]
        ldr_vo v9, x6, 128
        mla v5.8H, v12.8H, v8.H[0]
        add v28.8H, v14.8H, v27.8H
        sqrdmulh v30.8H, v15.8H, v0.H[1]
        sub v6.8H, v14.8H, v27.8H
        ldr_vo v11, x14, 64
        mul v29.8H, v15.8H, v0.H[0]
        mul v27.8H, v28.8H, v0.H[2]
        ldr_vo v25, x6, 160
        mla v29.8H, v30.8H, v8.H[0]
        sqrdmulh v23.8H, v6.8H, v0.H[5]
        sqrdmulh v12.8H, v11.8H, v0.H[1]
        sub v7.8H, v25.8H, v29.8H
        sqrdmulh v15.8H, v28.8H, v0.H[3]
        ldr_vo v4, x14, 224
        mul v24.8H, v6.8H, v0.H[4]
        add v16.8H, v25.8H, v29.8H
        mul v29.8H, v7.8H, v0.H[4]
        ldr_vo v14, x6, 0
        mla v27.8H, v15.8H, v8.H[0]
        sqrdmulh v6.8H, v4.8H, v0.H[1]
        mul v26.8H, v11.8H, v0.H[0]
        ldr_vo v25, x6, 64
        mul v10.8H, v4.8H, v0.H[0]
        mla v26.8H, v12.8H, v8.H[0]
        ldr_vo v13, x6, 224
        add v12.8H, v14.8H, v31.8H
        sub v14.8H, v14.8H, v31.8H
        mul v11.8H, v21.8H, v0.H[0]
        mla v10.8H, v6.8H, v8.H[0]
        sub v4.8H, v25.8H, v26.8H
        sub v20.8H, v13.8H, v10.8H
        sqrdmulh v6.8H, v7.8H, v0.H[5]
        mla v17.8H, v22.8H, v8.H[0]
        mla v24.8H, v23.8H, v8.H[0]
        add v23.8H, v25.8H, v26.8H
        sqrdmulh v21.8H, v20.8H, v0.H[5]
        add v25.8H, v13.8H, v10.8H
        ldr_vo v22, x6, 32
        mla v29.8H, v6.8H, v8.H[0]
        sub v30.8H, v9.8H, v17.8H
        sub v10.8H, v23.8H, v27.8H
        sqrdmulh v31.8H, v16.8H, v0.H[3]
        mla v11.8H, v19.8H, v8.H[0]
        sqrdmulh v15.8H, v30.8H, v0.H[5]
        add v19.8H, v4.8H, v24.8H
        sqrdmulh v18.8H, v25.8H, v0.H[3]
        add v28.8H, v9.8H, v17.8H
        mul v17.8H, v16.8H, v0.H[2]
        sqrdmulh v13.8H, v10.8H, v1.H[1]
        sub v16.8H, v22.8H, v5.8H
        mul v26.8H, v10.8H, v1.H[0]
        add v5.8H, v22.8H, v5.8H
        mul v22.8H, v25.8H, v0.H[2]
        sub v25.8H, v4.8H, v24.8H
        sqrdmulh v24.8H, v28.8H, v0.H[3]
        mul v9.8H, v28.8H, v0.H[2]
        add v7.8H, v23.8H, v27.8H
        mul v6.8H, v30.8H, v0.H[4]
        mul v27.8H, v20.8H, v0.H[4]
        sqrdmulh v20.8H, v7.8H, v0.H[7]
        sub v23.8H, v16.8H, v29.8H
        ldr_vo v10, x6, 96
        mla v27.8H, v21.8H, v8.H[0]
        add v16.8H, v16.8H, v29.8H
        mul v7.8H, v7.8H, v0.H[6]
        mla v7.8H, v20.8H, v8.H[0]
        mla v22.8H, v18.8H, v8.H[0]
        mla v26.8H, v13.8H, v8.H[0]
        mla v9.8H, v24.8H, v8.H[0]
        sub v29.8H, v10.8H, v11.8H
        add v24.8H, v10.8H, v11.8H
        add v30.8H, v24.8H, v22.8H
        mla v6.8H, v15.8H, v8.H[0]
        mul v13.8H, v19.8H, v1.H[2]
        sub v10.8H, v29.8H, v27.8H
        sqrdmulh v4.8H, v10.8H, v1.H[5]
        sub v20.8H, v24.8H, v22.8H
        sub count, count, #1
.p2align 2
layer1234_start:
        sqrdmulh v28.8H, v20.8H, v1.H[1]
        sub v24.8H, v14.8H, v6.8H
        sqrdmulh v15.8H, v19.8H, v1.H[3]
        add v11.8H, v29.8H, v27.8H               // gap(s) to follow
        ldr_vo v27, x14, 240
        mul v20.8H, v20.8H, v1.H[0]
        add v21.8H, v14.8H, v6.8H
        mul v19.8H, v10.8H, v1.H[4]
        sub v6.8H, v12.8H, v9.8H                 // gap(s) to follow
        ldr_vo v22, x14, 208
        sqrdmulh v18.8H, v25.8H, v1.H[5]
        add v29.8H, v12.8H, v9.8H
        mul v12.8H, v25.8H, v1.H[4]              // gap(s) to follow
        ldr_vo v14, x14, 80
        add v25.8H, v29.8H, v7.8H
        sub v10.8H, v29.8H, v7.8H
        sqrdmulh v29.8H, v11.8H, v1.H[3]
        mla v17.8H, v31.8H, v8.H[0]              // gap(s) to follow
        mul v9.8H, v11.8H, v1.H[2]
        mla v9.8H, v29.8H, v8.H[0]
        add v7.8H, v5.8H, v17.8H
        sqrdmulh v11.8H, v30.8H, v0.H[7]         // gap(s) to follow
        mla v12.8H, v18.8H, v8.H[0]              // gap(s) to follow
        mul v29.8H, v30.8H, v0.H[6]              // gap(s) to follow
        mla v29.8H, v11.8H, v8.H[0]              // gap(s) to follow
        sub v11.8H, v16.8H, v9.8H                // gap(s) to follow
        mla v20.8H, v28.8H, v8.H[0]
        sub v30.8H, v24.8H, v12.8H
        add v18.8H, v16.8H, v9.8H
        sqrdmulh v28.8H, v18.8H, v2.H[7]
        sub v5.8H, v5.8H, v17.8H
        mul v18.8H, v18.8H, v2.H[6]
        sub v9.8H, v7.8H, v29.8H                 // gap(s) to follow
        ldr_vo v31, x14, 16
        mul v16.8H, v9.8H, v2.H[0]
        add v7.8H, v7.8H, v29.8H
        sqrdmulh v29.8H, v9.8H, v2.H[1]
        sub v9.8H, v5.8H, v20.8H                 // gap(s) to follow
        add v20.8H, v5.8H, v20.8H
        mla v19.8H, v4.8H, v8.H[0]
        mla v18.8H, v28.8H, v8.H[0]              // gap(s) to follow
        sqrdmulh v4.8H, v22.8H, v0.H[1]          // gap(s) to follow
        mla v13.8H, v15.8H, v8.H[0]
        sub v15.8H, v6.8H, v26.8H                // gap(s) to follow
        mla v16.8H, v29.8H, v8.H[0]
        add v26.8H, v6.8H, v26.8H
        mul v28.8H, v22.8H, v0.H[0]
        add v22.8H, v24.8H, v12.8H               // gap(s) to follow
        sqrdmulh v12.8H, v11.8H, v3.H[1]
        add v6.8H, v23.8H, v19.8H
        sqrdmulh v24.8H, v9.8H, v2.H[5]
        add v17.8H, v10.8H, v16.8H               // gap(s) to follow
        mul v5.8H, v11.8H, v3.H[0]
        sub v29.8H, v23.8H, v19.8H
        mul v23.8H, v9.8H, v2.H[4]               // gap(s) to follow
        str_vo v17, x6, 64
        sub v9.8H, v10.8H, v16.8H
        mla v23.8H, v24.8H, v8.H[0]
        sqrdmulh v17.8H, v6.8H, v3.H[3]
        str_vo v9, x6, 96
        mul v6.8H, v6.8H, v3.H[2]
        add v16.8H, v21.8H, v13.8H               // gap(s) to follow
        mul v11.8H, v7.8H, v1.H[6]
        sub v24.8H, v16.8H, v18.8H
        sqrdmulh v9.8H, v7.8H, v1.H[7]           // gap(s) to follow
        mul v7.8H, v14.8H, v0.H[0]
        str_vo v24, x14, 32
        mla v5.8H, v12.8H, v8.H[0]
        sub v10.8H, v21.8H, v13.8H
        mul v24.8H, v31.8H, v0.H[0]
        add v21.8H, v16.8H, v18.8H               // gap(s) to follow
        ldr_vo v19, x14, 176
        sqrdmulh v12.8H, v31.8H, v0.H[1]
        str_vi v21, x14, 16
        add v13.8H, v15.8H, v23.8H
        sub v23.8H, v15.8H, v23.8H
        mla v11.8H, v9.8H, v8.H[0]
        mul v18.8H, v19.8H, v0.H[0]
        str_vo v23, x6, 224
        sqrdmulh v31.8H, v19.8H, v0.H[1]
        sub v21.8H, v10.8H, v5.8H                // gap(s) to follow
        ldr_vo v9, x6, 208
        mla v28.8H, v4.8H, v8.H[0]
        mla v24.8H, v12.8H, v8.H[0]              // gap(s) to follow
        add v5.8H, v10.8H, v5.8H                 // gap(s) to follow
        ldr_vo v15, x14, 128
        sqrdmulh v23.8H, v27.8H, v0.H[1]
        add v12.8H, v25.8H, v11.8H
        sqrdmulh v10.8H, v20.8H, v2.H[3]
        sub v16.8H, v9.8H, v28.8H                // gap(s) to follow
        ldr_vo v19, x14, 96
        mul v27.8H, v27.8H, v0.H[0]
        str_vo v13, x6, 192
        sqrdmulh v13.8H, v29.8H, v3.H[5]
        sub v11.8H, v25.8H, v11.8H               // gap(s) to follow
        ldr_vo v4, x6, 176
        str_vo v5, x14, 48
        str_vi v12, x6, 16
        mul v20.8H, v20.8H, v2.H[2]
        mla v27.8H, v23.8H, v8.H[0]              // gap(s) to follow
        ldr_vo v5, x6, 224
        mla v20.8H, v10.8H, v8.H[0]
        str_vo v21, x14, 80
        mul v25.8H, v29.8H, v3.H[4]
        add v23.8H, v9.8H, v28.8H                // gap(s) to follow
        ldr_vo v28, x14, 32
        str_vo v11, x6, 16
        mla v25.8H, v13.8H, v8.H[0]
        sqrdmulh v13.8H, v14.8H, v0.H[1]         // gap(s) to follow
        sub v29.8H, v26.8H, v20.8H
        add v11.8H, v26.8H, v20.8H
        sqrdmulh v14.8H, v23.8H, v0.H[3]
        mla v18.8H, v31.8H, v8.H[0]              // gap(s) to follow
        mul v31.8H, v15.8H, v0.H[0]
        str_vo v11, x6, 112
        mul v11.8H, v23.8H, v0.H[2]
        add v9.8H, v5.8H, v27.8H                 // gap(s) to follow
        add v23.8H, v30.8H, v25.8H
        sub v12.8H, v4.8H, v18.8H
        mul v20.8H, v28.8H, v0.H[0]
        mla v11.8H, v14.8H, v8.H[0]              // gap(s) to follow
        sqrdmulh v10.8H, v9.8H, v0.H[3]
        sub v14.8H, v5.8H, v27.8H
        sqrdmulh v26.8H, v12.8H, v0.H[5]         // gap(s) to follow
        sqrdmulh v21.8H, v15.8H, v0.H[1]
        str_vo v29, x6, 144
        sqrdmulh v29.8H, v14.8H, v0.H[5]         // gap(s) to follow
        mul v27.8H, v14.8H, v0.H[4]
        str_vo v23, x14, 176
        sqrdmulh v5.8H, v19.8H, v0.H[1]          // gap(s) to follow
        ldr_vo v23, x6, 128
        mla v31.8H, v21.8H, v8.H[0]
        mla v6.8H, v17.8H, v8.H[0]               // gap(s) to follow
        mul v14.8H, v9.8H, v0.H[2]
        sub v21.8H, v30.8H, v25.8H
        mul v25.8H, v16.8H, v0.H[4]              // gap(s) to follow
        sqrdmulh v16.8H, v16.8H, v0.H[5]
        sub v9.8H, v23.8H, v31.8H
        mla v14.8H, v10.8H, v8.H[0]
        add v10.8H, v22.8H, v6.8H                // gap(s) to follow
        mul v17.8H, v19.8H, v0.H[0]
        str_vo v10, x14, 112
        sqrdmulh v30.8H, v9.8H, v0.H[5]          // gap(s) to follow
        ldr_vo v19, x6, 96
        add v15.8H, v4.8H, v18.8H
        str_vo v21, x14, 208
        mla v27.8H, v29.8H, v8.H[0]
        mla v17.8H, v5.8H, v8.H[0]               // gap(s) to follow
        ldr_vo v21, x6, 64
        mla v7.8H, v13.8H, v8.H[0]
        add v31.8H, v23.8H, v31.8H               // gap(s) to follow
        mla v25.8H, v16.8H, v8.H[0]
        sqrdmulh v10.8H, v28.8H, v0.H[1]
        sub v5.8H, v22.8H, v6.8H
        mul v6.8H, v9.8H, v0.H[4]
        add v28.8H, v19.8H, v17.8H               // gap(s) to follow
        ldr_vo v13, x6, 32
        add v16.8H, v21.8H, v7.8H
        mla v6.8H, v30.8H, v8.H[0]
        sqrdmulh v30.8H, v31.8H, v0.H[3]
        sub v29.8H, v19.8H, v17.8H               // gap(s) to follow
        ldr_vo v22, x6, 0
        mla v20.8H, v10.8H, v8.H[0]
        sub v18.8H, v21.8H, v7.8H
        sub v10.8H, v29.8H, v27.8H               // gap(s) to follow
        mul v9.8H, v12.8H, v0.H[4]
        add v19.8H, v16.8H, v11.8H
        sqrdmulh v4.8H, v10.8H, v1.H[5]
        sub v11.8H, v16.8H, v11.8H               // gap(s) to follow
        sub v21.8H, v13.8H, v20.8H
        str_vo v5, x14, 144
        sqrdmulh v12.8H, v11.8H, v1.H[1]
        add v5.8H, v13.8H, v20.8H
        mla v9.8H, v26.8H, v8.H[0]               // gap(s) to follow
        mul v26.8H, v11.8H, v1.H[0]              // gap(s) to follow
        mul v7.8H, v19.8H, v0.H[6]
        sub v20.8H, v28.8H, v14.8H               // gap(s) to follow
        sqrdmulh v11.8H, v19.8H, v0.H[7]
        mla v26.8H, v12.8H, v8.H[0]
        add v16.8H, v21.8H, v9.8H
        sub v23.8H, v21.8H, v9.8H                // gap(s) to follow
        mul v9.8H, v31.8H, v0.H[2]               // gap(s) to follow
        mul v17.8H, v15.8H, v0.H[2]
        add v19.8H, v18.8H, v25.8H               // gap(s) to follow
        sqrdmulh v31.8H, v15.8H, v0.H[3]
        mla v9.8H, v30.8H, v8.H[0]
        add v12.8H, v22.8H, v24.8H
        add v30.8H, v28.8H, v14.8H               // gap(s) to follow
        mul v13.8H, v19.8H, v1.H[2]              // gap(s) to follow
        sub v14.8H, v22.8H, v24.8H
        sub v25.8H, v18.8H, v25.8H               // gap(s) to follow
        mla v7.8H, v11.8H, v8.H[0]               // gap(s) to follow
        subs count, count, #1
        cbnz count, layer1234_start
        sqrdmulh v15.8H, v30.8H, v0.H[7]
        sub v28.8H, v12.8H, v9.8H
        mul v30.8H, v30.8H, v0.H[6]
        add v29.8H, v29.8H, v27.8H
        mul v24.8H, v29.8H, v1.H[2]
        add v27.8H, v28.8H, v26.8H
        sqrdmulh v29.8H, v29.8H, v1.H[3]
        add v22.8H, v12.8H, v9.8H
        sub v9.8H, v22.8H, v7.8H
        add v12.8H, v22.8H, v7.8H
        mul v18.8H, v25.8H, v1.H[4]
        mla v30.8H, v15.8H, v8.H[0]
        mla v24.8H, v29.8H, v8.H[0]
        sqrdmulh v22.8H, v20.8H, v1.H[1]
        add v7.8H, v14.8H, v6.8H
        mul v20.8H, v20.8H, v1.H[0]
        sub v21.8H, v14.8H, v6.8H
        mla v17.8H, v31.8H, v8.H[0]
        sqrdmulh v11.8H, v19.8H, v1.H[3]
        add v29.8H, v16.8H, v24.8H
        mla v20.8H, v22.8H, v8.H[0]
        sub v24.8H, v16.8H, v24.8H
        sqrdmulh v22.8H, v25.8H, v1.H[5]
        sub v31.8H, v5.8H, v17.8H
        sqrdmulh v14.8H, v29.8H, v2.H[7]
        add v15.8H, v5.8H, v17.8H
        sub v25.8H, v15.8H, v30.8H
        add v17.8H, v31.8H, v20.8H
        mul v6.8H, v29.8H, v2.H[6]
        mla v13.8H, v11.8H, v8.H[0]
        sub v16.8H, v31.8H, v20.8H
        add v5.8H, v15.8H, v30.8H
        sqrdmulh v11.8H, v17.8H, v2.H[3]
        mla v6.8H, v14.8H, v8.H[0]
        mul v17.8H, v17.8H, v2.H[2]
        add v30.8H, v7.8H, v13.8H
        sqrdmulh v19.8H, v5.8H, v1.H[7]
        sub v15.8H, v7.8H, v13.8H
        add v20.8H, v30.8H, v6.8H
        sub v6.8H, v30.8H, v6.8H
        mul v7.8H, v5.8H, v1.H[6]
        mla v17.8H, v11.8H, v8.H[0]
        str_vi v20, x14, 16
        str_vo v6, x14, 16
        sqrdmulh v31.8H, v25.8H, v2.H[1]
        sub v29.8H, v28.8H, v26.8H
        mla v7.8H, v19.8H, v8.H[0]
        add v13.8H, v27.8H, v17.8H
        mla v18.8H, v22.8H, v8.H[0]
        mul v25.8H, v25.8H, v2.H[0]
        add v20.8H, v12.8H, v7.8H
        str_vo v13, x6, 128
        mul v10.8H, v10.8H, v1.H[4]
        sub v14.8H, v12.8H, v7.8H
        mla v25.8H, v31.8H, v8.H[0]
        str_vi v20, x6, 16
        str_vo v14, x6, 16
        sqrdmulh v20.8H, v16.8H, v2.H[5]
        mla v10.8H, v4.8H, v8.H[0]
        mul v11.8H, v16.8H, v2.H[4]
        sub v5.8H, v9.8H, v25.8H
        sqrdmulh v6.8H, v24.8H, v3.H[1]
        add v28.8H, v9.8H, v25.8H
        sub v22.8H, v23.8H, v10.8H
        str_vo v28, x6, 48
        mul v7.8H, v24.8H, v3.H[0]
        add v4.8H, v23.8H, v10.8H
        mla v11.8H, v20.8H, v8.H[0]
        sqrdmulh v26.8H, v4.8H, v3.H[3]
        str_vo v5, x6, 80
        sqrdmulh v12.8H, v22.8H, v3.H[5]
        sub v30.8H, v27.8H, v17.8H
        sub v31.8H, v29.8H, v11.8H
        str_vo v30, x6, 144
        mul v28.8H, v4.8H, v3.H[2]
        add v23.8H, v29.8H, v11.8H
        mla v7.8H, v6.8H, v8.H[0]
        str_vo v31, x6, 208
        sub v19.8H, v21.8H, v18.8H
        mul v13.8H, v22.8H, v3.H[4]
        mla v28.8H, v26.8H, v8.H[0]
        add v5.8H, v21.8H, v18.8H
        str_vo v23, x6, 176
        add v23.8H, v15.8H, v7.8H
        sub v21.8H, v15.8H, v7.8H
        mla v13.8H, v12.8H, v8.H[0]
        str_vo v23, x14, 48
        str_vo v21, x14, 80
        add v21.8H, v5.8H, v28.8H
        sub v24.8H, v5.8H, v28.8H
        str_vo v21, x14, 112
        str_vo v24, x14, 144
        add v25.8H, v19.8H, v13.8H
        sub v9.8H, v19.8H, v13.8H
        str_vo v25, x14, 176
        str_vo v9, x14, 208

        restore inp, STACK0
        mov count, #4

        ASM_LOAD(r_ptr1, roots_l456)

        add src0, inp, #256*0
        add src1, inp, #256*1

        .p2align 2
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        ldr_vo v9, x4, 160          // *..
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        ldr_vo v22, x4, 144         // .*.
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        // gap                      // ...
        ldr_vo v25, x4, 192         // ..*
        
        // original source code
        // ldr_vo v9, x4, 160       // *.. || *..
        // ldr_vo v22, x4, 144      // .*. || .*.
        // ldr_vo v25, x4, 192      // ..* || ..*
        
        sub count, count, #1
.p2align 2
layer567_start:
        ld4 {v27.4S,v28.4S,v29.4S,v30.4S}, [x7]              // .*....................................................................................................................
        ld4 {v1.4S,v2.4S,v3.4S,v4.4S}, [x6]                  // *.....................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v31, x4, 96                                   // ................*.....................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vi v17, x4, 224                                  // ..........*...........................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v13, x4, -208                                 // ...........*..........................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v23, x4, -160                                 // ..............*.......................................................................................................
        trn2 v10.4S, v4.4S, v30.4S                           // .........*............................................................................................................
        trn2 v12.4S, v3.4S, v29.4S                           // .......*..............................................................................................................
        trn1 v11.4S, v3.4S, v29.4S                           // ......*...............................................................................................................
        trn1 v6.4S, v2.4S, v28.4S                            // ....*.................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v16, x4, -144                                 // ...............*......................................................................................................
        sqrdmulh v24.8H, v10.8H, v13.8H                      // ........................................*.............................................................................
        trn2 v21.4S, v1.4S, v27.4S                           // ...*..................................................................................................................
        mul v15.8H, v12.8H, v17.8H                           // ..................................*...................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v0, x4, -16                                   // .......................*..............................................................................................
        mul v19.8H, v10.8H, v17.8H                           // .......................................*..............................................................................
        trn2 v14.4S, v2.4S, v28.4S                           // .....*................................................................................................................
        sqrdmulh v28.8H, v12.8H, v13.8H                      // ...................................*..................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v26, x4, -176                                 // .............*........................................................................................................
        mla v19.8H, v24.8H, v8.H[0]                          // .........................................*............................................................................
        trn1 v18.4S, v4.4S, v30.4S                           // ........*.............................................................................................................
        sqrdmulh v5.8H, v21.8H, v13.8H                       // .........................*............................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v24, x4, -192                                 // ............*.........................................................................................................
        sqrdmulh v12.8H, v14.8H, v13.8H                      // ..............................*.......................................................................................
        // gap                                               // ......................................................................................................................
        mul v21.8H, v21.8H, v17.8H                           // ........................*.............................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        mla v15.8H, v28.8H, v8.H[0]                          // ....................................*.................................................................................
        mla v21.8H, v5.8H, v8.H[0]                           // ..........................*...........................................................................................
        // gap                                               // ......................................................................................................................
        add v28.8H, v18.8H, v19.8H                           // ...........................................*..........................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        mul v5.8H, v14.8H, v17.8H                            // .............................*........................................................................................
        sub v18.8H, v18.8H, v19.8H                           // ..........................................*...........................................................................
        sqrdmulh v14.8H, v28.8H, v26.8H                      // ..................................................*...................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        mla v5.8H, v12.8H, v8.H[0]                           // ...............................*......................................................................................
        sub v10.8H, v11.8H, v15.8H                           // .....................................*................................................................................
        mul v28.8H, v28.8H, v24.8H                           // .................................................*....................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        mla v28.8H, v14.8H, v8.H[0]                          // ...................................................*..................................................................
        add v14.8H, v11.8H, v15.8H                           // ......................................*...............................................................................
        mul v7.8H, v10.8H, v23.8H                            // ......................................................*...............................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        sqrdmulh v13.8H, v18.8H, v16.8H                      // ............................................................*.........................................................
        add v20.8H, v6.8H, v5.8H                             // .................................*....................................................................................
        sqrdmulh v4.8H, v14.8H, v26.8H                       // .............................................*........................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v15, x4, -112                                 // .................*....................................................................................................
        mul v2.8H, v18.8H, v23.8H                            // ...........................................................*..........................................................
        add v19.8H, v20.8H, v28.8H                           // .....................................................*................................................................
        sqrdmulh v12.8H, v10.8H, v16.8H                      // .......................................................*..............................................................
        sub v18.8H, v20.8H, v28.8H                           // ....................................................*.................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v20, x4, -96                                  // ..................*...................................................................................................
        mul v28.8H, v19.8H, v31.8H                           // ................................................................*.....................................................
        mla v2.8H, v13.8H, v8.H[0]                           // .............................................................*........................................................
        trn1 v13.4S, v1.4S, v27.4S                           // ..*...................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v11, x4, -48                                  // .....................*................................................................................................
        mla v7.8H, v12.8H, v8.H[0]                           // ........................................................*.............................................................
        // gap                                               // ......................................................................................................................
        mul v30.8H, v14.8H, v24.8H                           // ............................................*.........................................................................
        sub v26.8H, v6.8H, v5.8H                             // ................................*.....................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        sqrdmulh v15.8H, v19.8H, v15.8H                      // .................................................................*....................................................
        sub v17.8H, v26.8H, v2.8H                            // ..............................................................*.......................................................
        sqrdmulh v16.8H, v18.8H, v22.8H                      // ......................................................................*...............................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        mla v30.8H, v4.8H, v8.H[0]                           // ..............................................*.......................................................................
        // gap                                               // ......................................................................................................................
        mul v20.8H, v18.8H, v20.8H                           // .....................................................................*................................................
        add v23.8H, v26.8H, v2.8H                            // ...............................................................*......................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        sub v3.8H, v13.8H, v21.8H                            // ...........................*..........................................................................................
        add v14.8H, v13.8H, v21.8H                           // ............................*.........................................................................................
        sqrdmulh v6.8H, v17.8H, v0.8H                        // ................................................................................*.....................................
        mla v28.8H, v15.8H, v8.H[0]                          // ..................................................................*...................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        sub v13.8H, v14.8H, v30.8H                           // ...............................................*......................................................................
        mla v20.8H, v16.8H, v8.H[0]                          // .......................................................................*..............................................
        mul v1.8H, v17.8H, v25.8H                            // ...............................................................................*......................................
        add v31.8H, v14.8H, v30.8H                           // ................................................*.....................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        add v16.8H, v31.8H, v28.8H                           // ....................................................................*.................................................
        add v30.8H, v3.8H, v7.8H                             // ..........................................................*...........................................................
        sqrdmulh v25.8H, v23.8H, v11.8H                      // ...........................................................................*..........................................
        mla v1.8H, v6.8H, v8.H[0]                            // .................................................................................*....................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        add v24.8H, v13.8H, v20.8H                           // .........................................................................*............................................
        sub v22.8H, v3.8H, v7.8H                             // .........................................................*............................................................
        mul v10.8H, v23.8H, v9.8H                            // ..........................................................................*...........................................
        sub v5.8H, v13.8H, v20.8H                            // ........................................................................*.............................................
        // gap                                               // ......................................................................................................................
        ldr_vo v9, x4, 160                                   // ....................e.................................................................................................
        mla v10.8H, v25.8H, v8.H[0]                          // ............................................................................*.........................................
        // gap                                               // ......................................................................................................................
        sub v27.8H, v22.8H, v1.8H                            // ..................................................................................*...................................
        sub v4.8H, v31.8H, v28.8H                            // ...................................................................*..................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        trn2 v20.4S, v5.4S, v27.4S                           // ...........................................................................................*..........................
        add v29.8H, v22.8H, v1.8H                            // ...................................................................................*..................................
        trn1 v28.4S, v5.4S, v27.4S                           // ..........................................................................................*...........................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        add v2.8H, v30.8H, v10.8H                            // ..............................................................................*.......................................
        trn2 v19.4S, v24.4S, v29.4S                          // .........................................................................................*............................
        sqdmulh v13.8H, v28.8H, v8.H[1]                      // .....................................................................................................*................
        sub v15.8H, v30.8H, v10.8H                           // .............................................................................*........................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        trn1 v25.4S, v16.4S, v2.4S                           // ....................................................................................*.................................
        trn2 v17.4S, v16.4S, v2.4S                           // .....................................................................................*................................
        sqdmulh v21.8H, v19.8H, v8.H[1]                      // ..............................................................................................................*.......
        trn2 v18.4S, v4.4S, v15.4S                           // .......................................................................................*..............................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        sqdmulh v0.8H, v25.8H, v8.H[1]                       // ............................................................................................*.........................
        trn1 v27.4S, v24.4S, v29.4S                          // ........................................................................................*.............................
        sqdmulh v30.8H, v17.8H, v8.H[1]                      // ........................................................................................................*.............
        trn1 v26.4S, v4.4S, v15.4S                           // ......................................................................................*...............................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        sqdmulh v22.8H, v26.8H, v8.H[1]                      // ...............................................................................................*......................
        srshr v24.8H, v13.8H, #11                            // ......................................................................................................*...............
        sqdmulh v29.8H, v27.8H, v8.H[1]                      // ..................................................................................................*...................
        srshr v13.8H, v21.8H, #11                            // ...............................................................................................................*......
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        sqdmulh v10.8H, v18.8H, v8.H[1]                      // ...........................................................................................................*..........
        srshr v15.8H, v0.8H, #11                             // .............................................................................................*........................
        sqdmulh v12.8H, v20.8H, v8.H[1]                      // .................................................................................................................*....
        srshr v0.8H, v30.8H, #11                             // .........................................................................................................*............
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        mla v28.8H, v24.8H, v8.H[0]                          // .......................................................................................................*..............
        mla v19.8H, v13.8H, v8.H[0]                          // ................................................................................................................*.....
        srshr v30.8H, v22.8H, #11                            // ................................................................................................*.....................
        srshr v24.8H, v29.8H, #11                            // ...................................................................................................*..................
        // gap                                               // ......................................................................................................................
        ldr_vo v22, x4, 144                                  // ...................e..................................................................................................
        mla v25.8H, v15.8H, v8.H[0]                          // ..............................................................................................*.......................
        mla v17.8H, v0.8H, v8.H[0]                           // ..........................................................................................................*...........
        srshr v11.8H, v10.8H, #11                            // ............................................................................................................*.........
        srshr v7.8H, v12.8H, #11                             // ..................................................................................................................*...
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        mla v27.8H, v24.8H, v8.H[0]                          // ....................................................................................................*.................
        mla v26.8H, v30.8H, v8.H[0]                          // .................................................................................................*....................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        mla v20.8H, v7.8H, v8.H[0]                           // ...................................................................................................................*..
        mla v18.8H, v11.8H, v8.H[0]                          // .............................................................................................................*........
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        st4 {v25.4S,v26.4S,v27.4S,v28.4S}, [x6], #64         // ....................................................................................................................*.
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        ldr_vo v25, x4, 192                                  // ......................e...............................................................................................
        st4 {v17.4S,v18.4S,v19.4S,v20.4S}, [x7], #64         // .....................................................................................................................*
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        // gap                                               // ......................................................................................................................
        
        // original source code
        // ld4 {v17.4S,v18.4S,v19.4S,v20.4S}, [x6]           // ............................................*.................................................................................................................... || ..............*...................................
        // ld4 {v21.4S,v22.4S,v23.4S,v24.4S}, [x7]           // ...........................................*..................................................................................................................... || ..............*...................................
        // trn1 v9.4S, v17.4S, v21.4S                        // ...........................................................................................*..................................................................... || .............................*....................
        // trn2 v13.4S, v17.4S, v21.4S                       // .......................................................*......................................................................................................... || ...................*..............................
        // trn1 v10.4S, v18.4S, v22.4S                       // ....................................................*............................................................................................................ || ..................*...............................
        // trn2 v14.4S, v18.4S, v22.4S                       // ...........................................................*..................................................................................................... || ....................*.............................
        // trn1 v11.4S, v19.4S, v23.4S                       // ...................................................*............................................................................................................. || ..................*...............................
        // trn2 v15.4S, v19.4S, v23.4S                       // ..................................................*.............................................................................................................. || ..................*...............................
        // trn1 v12.4S, v20.4S, v24.4S                       // ...............................................................*................................................................................................. || .....................*............................
        // trn2 v16.4S, v20.4S, v24.4S                       // .................................................*............................................................................................................... || ..................*...............................
        // ldr_vi v0, x4, 224                                // ..............................................*.................................................................................................................. || ...............*..................................
        // ldr_vo v4, x4, -208                               // ...............................................*................................................................................................................. || ................*.................................
        // ldr_vo v1, x4, -192                               // .................................................................*............................................................................................... || .....................*............................
        // ldr_vo v5, x4, -176                               // .............................................................*................................................................................................... || ....................*.............................
        // ldr_vo v2, x4, -160                               // ................................................*................................................................................................................ || .................*................................
        // ldr_vo v6, x4, -144                               // .....................................................*........................................................................................................... || ..................*...............................
        // ldr_vo v3, x4, -128                               // .............................................*................................................................................................................... || ..............*...................................
        // ldr_vo v7, x4, -112                               // ...................................................................................*............................................................................. || ...........................*......................
        // ldr_vo v17, x4, -96                               // ........................................................................................*........................................................................ || ............................*.....................
        // ldr_vo v18, x4, -80                               // ...............................e................................................................................................................................. || ........e.........................................
        // ldr_vo v19, x4, -64                               // e................................................................................................................................................................ || e.................................................
        // ldr_vo v20, x4, -48                               // ............................................................................................*.................................................................... || .............................*....................
        // ldr_vo v21, x4, -32                               // .........................................e....................................................................................................................... || ............e.....................................
        // ldr_vo v22, x4, -16                               // .........................................................*....................................................................................................... || ...................*..............................
        // mul v25.8H, v13.8H, v0.8H                         // ...................................................................*............................................................................................. || ......................*...........................
        // sqrdmulh v13.8H, v13.8H, v4.8H                    // ................................................................*................................................................................................ || .....................*............................
        // mla v25.8H, v13.8H, v8.H[0]                       // .....................................................................*........................................................................................... || .......................*..........................
        // sub v13.8H, v9.8H, v25.8H                         // ......................................................................................................*.......................................................... || .................................*................
        // add v9.8H, v9.8H, v25.8H                          // .......................................................................................................*......................................................... || .................................*................
        // mul v25.8H, v14.8H, v0.8H                         // .......................................................................*......................................................................................... || ........................*.........................
        // sqrdmulh v14.8H, v14.8H, v4.8H                    // ..................................................................*.............................................................................................. || ......................*...........................
        // mla v25.8H, v14.8H, v8.H[0]                       // ..........................................................................*...................................................................................... || .........................*........................
        // sub v14.8H, v10.8H, v25.8H                        // ...............................................................................................*................................................................. || ..............................*...................
        // add v10.8H, v10.8H, v25.8H                        // .................................................................................*............................................................................... || ...........................*......................
        // mul v25.8H, v15.8H, v0.8H                         // ........................................................*........................................................................................................ || ...................*..............................
        // sqrdmulh v15.8H, v15.8H, v4.8H                    // ............................................................*.................................................................................................... || ....................*.............................
        // mla v25.8H, v15.8H, v8.H[0]                       // ....................................................................*............................................................................................ || .......................*..........................
        // sub v15.8H, v11.8H, v25.8H                        // ...........................................................................*..................................................................................... || .........................*........................
        // add v11.8H, v11.8H, v25.8H                        // ..............................................................................*.................................................................................. || ..........................*.......................
        // mul v25.8H, v16.8H, v0.8H                         // ..........................................................*...................................................................................................... || ....................*.............................
        // sqrdmulh v16.8H, v16.8H, v4.8H                    // ......................................................*.......................................................................................................... || ...................*..............................
        // mla v25.8H, v16.8H, v8.H[0]                       // ..............................................................*.................................................................................................. || .....................*............................
        // sub v16.8H, v12.8H, v25.8H                        // ........................................................................*........................................................................................ || ........................*.........................
        // add v12.8H, v12.8H, v25.8H                        // ......................................................................*.......................................................................................... || .......................*..........................
        // mul v25.8H, v11.8H, v1.8H                         // ..............................................................................................*.................................................................. || ..............................*...................
        // sqrdmulh v11.8H, v11.8H, v5.8H                    // ..................................................................................*.............................................................................. || ...........................*......................
        // mla v25.8H, v11.8H, v8.H[0]                       // ...................................................................................................*............................................................. || ................................*.................
        // sub v11.8H, v9.8H, v25.8H                         // ..........................................................................................................*...................................................... || ..................................*...............
        // add v9.8H, v9.8H, v25.8H                          // .............................................................................................................*................................................... || ..................................*...............
        // mul v25.8H, v12.8H, v1.8H                         // ............................................................................*.................................................................................... || .........................*........................
        // sqrdmulh v12.8H, v12.8H, v5.8H                    // .........................................................................*....................................................................................... || ........................*.........................
        // mla v25.8H, v12.8H, v8.H[0]                       // .............................................................................*................................................................................... || ..........................*.......................
        // sub v12.8H, v10.8H, v25.8H                        // .......................................................................................*......................................................................... || ............................*.....................
        // add v10.8H, v10.8H, v25.8H                        // .....................................................................................*........................................................................... || ............................*.....................
        // mul v25.8H, v15.8H, v2.8H                         // ...............................................................................*................................................................................. || ..........................*.......................
        // sqrdmulh v15.8H, v15.8H, v6.8H                    // ......................................................................................*.......................................................................... || ............................*.....................
        // mla v25.8H, v15.8H, v8.H[0]                       // .............................................................................................*................................................................... || ..............................*...................
        // sub v15.8H, v13.8H, v25.8H                        // ...................................................................................................................*............................................. || ....................................*.............
        // add v13.8H, v13.8H, v25.8H                        // ...............................................................................................................*................................................. || ...................................*..............
        // mul v25.8H, v16.8H, v2.8H                         // ....................................................................................*............................................................................ || ............................*.....................
        // sqrdmulh v16.8H, v16.8H, v6.8H                    // ................................................................................*................................................................................ || ...........................*......................
        // mla v25.8H, v16.8H, v8.H[0]                       // ..........................................................................................*...................................................................... || .............................*....................
        // sub v16.8H, v14.8H, v25.8H                        // .................................................................................................*............................................................... || ...............................*..................
        // add v14.8H, v14.8H, v25.8H                        // .....................................................................................................*........................................................... || ................................*.................
        // mul v25.8H, v10.8H, v3.8H                         // .........................................................................................*....................................................................... || .............................*....................
        // sqrdmulh v10.8H, v10.8H, v7.8H                    // ................................................................................................*................................................................ || ...............................*..................
        // mla v25.8H, v10.8H, v8.H[0]                       // .........................................................................................................*....................................................... || .................................*................
        // sub v10.8H, v9.8H, v25.8H                         // .........................................................................................................................*....................................... || .....................................*............
        // add v9.8H, v9.8H, v25.8H                          // ..............................................................................................................*.................................................. || ...................................*..............
        // mul v25.8H, v12.8H, v17.8H                        // ....................................................................................................*............................................................ || ................................*.................
        // sqrdmulh v12.8H, v12.8H, v18.8H                   // ..................................................................................................*.............................................................. || ...............................*..................
        // mla v25.8H, v12.8H, v8.H[0]                       // ...........................................................................................................*..................................................... || ..................................*...............
        // sub v12.8H, v11.8H, v25.8H                        // .....................................................................................................................*........................................... || ....................................*.............
        // add v11.8H, v11.8H, v25.8H                        // ..................................................................................................................*.............................................. || ....................................*.............
        // mul v25.8H, v14.8H, v19.8H                        // ....................................................................................................................*............................................ || ....................................*.............
        // sqrdmulh v14.8H, v14.8H, v20.8H                   // ................................................................................................................*................................................ || ...................................*..............
        // mla v25.8H, v14.8H, v8.H[0]                       // .......................................................................................................................*......................................... || .....................................*............
        // sub v14.8H, v13.8H, v25.8H                        // ................................................................................................................................*................................ || .......................................*..........
        // add v13.8H, v13.8H, v25.8H                        // .............................................................................................................................*................................... || .......................................*..........
        // mul v25.8H, v16.8H, v21.8H                        // ............................................................................................................*.................................................... || ..................................*...............
        // sqrdmulh v16.8H, v16.8H, v22.8H                   // ........................................................................................................*........................................................ || .................................*................
        // mla v25.8H, v16.8H, v8.H[0]                       // .................................................................................................................*............................................... || ...................................*..............
        // sub v16.8H, v15.8H, v25.8H                        // ........................................................................................................................*........................................ || .....................................*............
        // add v15.8H, v15.8H, v25.8H                        // ...........................................................................................................................*..................................... || ......................................*...........
        // trn1 v17.4S, v9.4S, v13.4S                        // .................................................................................................................................*............................... || ........................................*.........
        // trn2 v21.4S, v9.4S, v13.4S                        // ..................................................................................................................................*.............................. || ........................................*.........
        // trn1 v18.4S, v10.4S, v14.4S                       // ........................................................................................................................................*........................ || .........................................*........
        // trn2 v22.4S, v10.4S, v14.4S                       // ....................................................................................................................................*............................ || ........................................*.........
        // trn1 v19.4S, v11.4S, v15.4S                       // ......................................................................................................................................*.......................... || .........................................*........
        // trn2 v23.4S, v11.4S, v15.4S                       // ..............................................................................................................................*.................................. || .......................................*..........
        // trn1 v20.4S, v12.4S, v16.4S                       // ............................................................................................................................*.................................... || ......................................*...........
        // trn2 v24.4S, v12.4S, v16.4S                       // ..........................................................................................................................*...................................... || ......................................*...........
        // sqdmulh v26.8H, v17.8H, v8.H[1]                   // .....................................................................................................................................*........................... || .........................................*........
        // srshr v26.8H, v26.8H, #11                         // ..............................................................................................................................................*.................. || ...........................................*......
        // mla v17.8H, v26.8H, v8.H[0]                       // ......................................................................................................................................................*.......... || .............................................*....
        // sqdmulh v26.8H, v18.8H, v8.H[1]                   // .........................................................................................................................................*....................... || ..........................................*.......
        // srshr v26.8H, v26.8H, #11                         // ...................................................................................................................................................*............. || ............................................*.....
        // mla v18.8H, v26.8H, v8.H[0]                       // ...........................................................................................................................................................*..... || ..............................................*...
        // sqdmulh v26.8H, v19.8H, v8.H[1]                   // ...........................................................................................................................................*..................... || ..........................................*.......
        // srshr v26.8H, v26.8H, #11                         // ....................................................................................................................................................*............ || ............................................*.....
        // mla v19.8H, v26.8H, v8.H[0]                       // ..........................................................................................................................................................*...... || ..............................................*...
        // sqdmulh v26.8H, v20.8H, v8.H[1]                   // ...............................................................................................................................*................................. || .......................................*..........
        // srshr v26.8H, v26.8H, #11                         // ..........................................................................................................................................*...................... || ..........................................*.......
        // mla v20.8H, v26.8H, v8.H[0]                       // .................................................................................................................................................*............... || ............................................*.....
        // sqdmulh v26.8H, v21.8H, v8.H[1]                   // .......................................................................................................................................*......................... || .........................................*........
        // srshr v26.8H, v26.8H, #11                         // ................................................................................................................................................*................ || ...........................................*......
        // mla v21.8H, v26.8H, v8.H[0]                       // .......................................................................................................................................................*......... || .............................................*....
        // sqdmulh v26.8H, v22.8H, v8.H[1]                   // .............................................................................................................................................*................... || ...........................................*......
        // srshr v26.8H, v26.8H, #11                         // ........................................................................................................................................................*........ || .............................................*....
        // mla v22.8H, v26.8H, v8.H[0]                       // .............................................................................................................................................................*... || ...............................................*..
        // sqdmulh v26.8H, v23.8H, v8.H[1]                   // ...................................................................................................................................*............................. || ........................................*.........
        // srshr v26.8H, v26.8H, #11                         // ............................................................................................................................................*.................... || ..........................................*.......
        // mla v23.8H, v26.8H, v8.H[0]                       // ..................................................................................................................................................*.............. || ............................................*.....
        // sqdmulh v26.8H, v24.8H, v8.H[1]                   // ...............................................................................................................................................*................. || ...........................................*......
        // srshr v26.8H, v26.8H, #11                         // .........................................................................................................................................................*....... || .............................................*....
        // mla v24.8H, v26.8H, v8.H[0]                       // ............................................................................................................................................................*.... || ...............................................*..
        // st4 {v17.4S,v18.4S,v19.4S,v20.4S}, [x6], #64      // ..............................................................................................................................................................*.. || ................................................*.
        // st4 {v21.4S,v22.4S,v23.4S,v24.4S}, [x7], #64      // ................................................................................................................................................................* || .................................................*
        
        subs count, count, #1
        cbnz count, layer567_start
        ld4 {v27.4S,v28.4S,v29.4S,v30.4S}, [x6]              // .*.................................................................................................................
        ld4 {v0.4S,v1.4S,v2.4S,v3.4S}, [x7]                  // *..................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v4, x4, 128                                   // .............................................*.....................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v17, x4, 176                                  // .................................................*.................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v12, x4, 16                                   // ....*..............................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vi v6, x4, 224                                   // ...*...............................................................................................................
        trn2 v14.4S, v30.4S, v3.4S                           // ......*............................................................................................................
        trn2 v10.4S, v29.4S, v2.4S                           // .......*...........................................................................................................
        trn2 v18.4S, v27.4S, v0.4S                           // ............*......................................................................................................
        trn2 v11.4S, v28.4S, v1.4S                           // ................*..................................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v19, x4, -16                                  // ..............*....................................................................................................
        sqrdmulh v7.8H, v14.8H, v12.8H                       // ...........*.......................................................................................................
        trn1 v16.4S, v30.4S, v3.4S                           // ....................*..............................................................................................
        sqrdmulh v3.8H, v18.8H, v12.8H                       // .....................*.............................................................................................
        trn1 v21.4S, v28.4S, v1.4S                           // .........*.........................................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v26, x4, -144                                 // ..........*........................................................................................................
        mul v1.8H, v14.8H, v6.8H                             // ...............*...................................................................................................
        trn1 v20.4S, v29.4S, v2.4S                           // ........*..........................................................................................................
        mul v31.8H, v18.8H, v6.8H                            // ........................*..........................................................................................
        trn1 v14.4S, v27.4S, v0.4S                           // ................................................*..................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v13, x4, -160                                 // .....*.............................................................................................................
        mla v1.8H, v7.8H, v8.H[0]                            // ...................*...............................................................................................
        mla v31.8H, v3.8H, v8.H[0]                           // ..........................*........................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v5, x4, -176                                  // ..................*................................................................................................
        sqrdmulh v24.8H, v10.8H, v12.8H                      // .................*.................................................................................................
        // gap                                               // ...................................................................................................................
        mul v10.8H, v10.8H, v6.8H                            // .............*.....................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v15, x4, -192                                 // ......................*............................................................................................
        sqrdmulh v23.8H, v11.8H, v12.8H                      // .......................*...........................................................................................
        add v30.8H, v16.8H, v1.8H                            // ...........................*.......................................................................................
        mul v7.8H, v11.8H, v6.8H                             // ............................*......................................................................................
        sub v12.8H, v14.8H, v31.8H                           // ...........................................................*.......................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v6, x4, -112                                  // ........................................*..........................................................................
        add v2.8H, v14.8H, v31.8H                            // ............................................................*......................................................
        sub v3.8H, v16.8H, v1.8H                             // .............................*.....................................................................................
        sqrdmulh v18.8H, v30.8H, v5.8H                       // ..............................*....................................................................................
        mla v10.8H, v24.8H, v8.H[0]                          // .........................*.........................................................................................
        // gap                                               // ...................................................................................................................
        ldr_vo v28, x4, -128                                 // ..*................................................................................................................
        mla v7.8H, v23.8H, v8.H[0]                           // ...............................*...................................................................................
        // gap                                               // ...................................................................................................................
        mul v30.8H, v30.8H, v15.8H                           // .................................*.................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        sub v0.8H, v20.8H, v10.8H                            // ................................*..................................................................................
        add v27.8H, v20.8H, v10.8H                           // ...................................*...............................................................................
        sqrdmulh v31.8H, v3.8H, v26.8H                       // .....................................*.............................................................................
        mla v30.8H, v18.8H, v8.H[0]                          // ..................................*................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        sqrdmulh v5.8H, v27.8H, v5.8H                        // .......................................*...........................................................................
        sub v10.8H, v21.8H, v7.8H                            // ....................................................*..............................................................
        mul v24.8H, v3.8H, v13.8H                            // .........................................*.........................................................................
        add v18.8H, v21.8H, v7.8H                            // ......................................*............................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        sub v7.8H, v18.8H, v30.8H                            // ............................................*......................................................................
        add v23.8H, v18.8H, v30.8H                           // ..........................................*........................................................................
        mul v14.8H, v27.8H, v15.8H                           // ...................................................*...............................................................
        mla v24.8H, v31.8H, v8.H[0]                          // ...............................................*...................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        mul v27.8H, v23.8H, v28.8H                           // ..............................................*....................................................................
        // gap                                               // ...................................................................................................................
        sqrdmulh v6.8H, v23.8H, v6.8H                        // .....................................................*.............................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        mul v21.8H, v0.8H, v13.8H                            // ....................................*..............................................................................
        add v1.8H, v10.8H, v24.8H                            // ..........................................................*........................................................
        mla v14.8H, v5.8H, v8.H[0]                           // ........................................................*..........................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        mul v16.8H, v1.8H, v9.8H                             // .........................................................................*.........................................
        // gap                                               // ...................................................................................................................
        sqrdmulh v31.8H, v0.8H, v26.8H                       // ...........................................*.......................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        sqrdmulh v13.8H, v1.8H, v17.8H                       // .....................................................................*.............................................
        sub v11.8H, v2.8H, v14.8H                            // ...............................................................*...................................................
        mla v27.8H, v6.8H, v8.H[0]                           // ..............................................................*....................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        mul v1.8H, v7.8H, v4.8H                              // .........................................................*.........................................................
        add v0.8H, v2.8H, v14.8H                             // ..................................................................*................................................
        sub v2.8H, v10.8H, v24.8H                            // ......................................................*............................................................
        mla v21.8H, v31.8H, v8.H[0]                          // ..................................................*................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        add v9.8H, v0.8H, v27.8H                             // ...................................................................*...............................................
        mla v16.8H, v13.8H, v8.H[0]                          // ...........................................................................*.......................................
        sqrdmulh v15.8H, v7.8H, v22.8H                       // .......................................................*...........................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        add v5.8H, v12.8H, v21.8H                            // ....................................................................*..............................................
        // gap                                               // ...................................................................................................................
        sqrdmulh v3.8H, v2.8H, v19.8H                        // .............................................................*.....................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        sub v13.8H, v12.8H, v21.8H                           // ........................................................................*..........................................
        add v22.8H, v5.8H, v16.8H                            // .................................................................................*.................................
        mul v12.8H, v2.8H, v25.8H                            // .................................................................*.................................................
        mla v1.8H, v15.8H, v8.H[0]                           // ................................................................*..................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        sub v28.8H, v0.8H, v27.8H                            // .............................................................................*.....................................
        sub v4.8H, v5.8H, v16.8H                             // ....................................................................................*..............................
        mla v12.8H, v3.8H, v8.H[0]                           // ......................................................................*............................................
        trn2 v27.4S, v9.4S, v22.4S                           // ......................................................................................*............................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        add v24.8H, v11.8H, v1.8H                            // .......................................................................*...........................................
        trn1 v14.4S, v28.4S, v4.4S                           // ............................................................................................*......................
        sqdmulh v5.8H, v27.8H, v8.H[1]                       // ...........................................................................................*.......................
        trn2 v28.4S, v28.4S, v4.4S                           // ........................................................................................*..........................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        add v17.8H, v13.8H, v12.8H                           // ...............................................................................*...................................
        sub v10.8H, v13.8H, v12.8H                           // ............................................................................*......................................
        sqdmulh v3.8H, v14.8H, v8.H[1]                       // .............................................................................................*.....................
        trn1 v13.4S, v9.4S, v22.4S                           // .....................................................................................*.............................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        trn1 v15.4S, v24.4S, v17.4S                          // ..........................................................................................*........................
        trn2 v29.4S, v24.4S, v17.4S                          // ..................................................................................*................................
        sqdmulh v18.8H, v28.8H, v8.H[1]                      // .................................................................................................*.................
        srshr v7.8H, v5.8H, #11                              // ....................................................................................................*..............
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        sqdmulh v24.8H, v15.8H, v8.H[1]                      // ...............................................................................................*...................
        srshr v9.8H, v3.8H, #11                              // .......................................................................................................*...........
        sqdmulh v0.8H, v13.8H, v8.H[1]                       // .........................................................................................*.........................
        sub v2.8H, v11.8H, v1.8H                             // ..........................................................................*........................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        trn2 v30.4S, v2.4S, v10.4S                           // ..............................................................................*....................................
        trn1 v16.4S, v2.4S, v10.4S                           // ................................................................................*..................................
        sqdmulh v5.8H, v29.8H, v8.H[1]                       // .......................................................................................*...........................
        srshr v10.8H, v18.8H, #11                            // ...........................................................................................................*.......
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        sqdmulh v1.8H, v16.8H, v8.H[1]                       // ...................................................................................*...............................
        srshr v21.8H, v24.8H, #11                            // ........................................................................................................*..........
        sqdmulh v19.8H, v30.8H, v8.H[1]                      // ...................................................................................................*...............
        srshr v24.8H, v0.8H, #11                             // ..................................................................................................*................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        mla v27.8H, v7.8H, v8.H[0]                           // ..........................................................................................................*........
        mla v14.8H, v9.8H, v8.H[0]                           // ..............................................................................................................*....
        srshr v4.8H, v5.8H, #11                              // ................................................................................................*..................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        mla v28.8H, v10.8H, v8.H[0]                          // ................................................................................................................*..
        mla v13.8H, v24.8H, v8.H[0]                          // .........................................................................................................*.........
        srshr v17.8H, v1.8H, #11                             // ..............................................................................................*....................
        srshr v5.8H, v19.8H, #11                             // ............................................................................................................*......
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        mla v15.8H, v21.8H, v8.H[0]                          // .............................................................................................................*.....
        mla v29.8H, v4.8H, v8.H[0]                           // ......................................................................................................*............
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        mla v30.8H, v5.8H, v8.H[0]                           // ...............................................................................................................*...
        mla v16.8H, v17.8H, v8.H[0]                          // .....................................................................................................*.............
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        st4 {v27.4S,v28.4S,v29.4S,v30.4S}, [x7], #64         // ..................................................................................................................*
        st4 {v13.4S,v14.4S,v15.4S,v16.4S}, [x6], #64         // .................................................................................................................*.
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        // gap                                               // ...................................................................................................................
        
        // original source code
        // ld4 {v27.4S,v28.4S,v29.4S,v30.4S}, [x7]           // .*................................................................................................................. || *...................................
        // ld4 {v1.4S,v2.4S,v3.4S,v4.4S}, [x6]               // *.................................................................................................................. || *...................................
        // ldr_vo v31, x4, 96                                // ....................................*.............................................................................. || ..........*.........................
        // ldr_vi v17, x4, 224                               // .....*............................................................................................................. || ...*................................
        // ldr_vo v13, x4, -208                              // ....*.............................................................................................................. || ..*.................................
        // ldr_vo v23, x4, -160                              // ....................*.............................................................................................. || ......*.............................
        // trn2 v10.4S, v4.4S, v30.4S                        // ......*............................................................................................................ || ....*...............................
        // trn2 v12.4S, v3.4S, v29.4S                        // .......*........................................................................................................... || ....*...............................
        // trn1 v11.4S, v3.4S, v29.4S                        // .................*................................................................................................. || ......*.............................
        // trn1 v6.4S, v2.4S, v28.4S                         // ..............*.................................................................................................... || .....*..............................
        // ldr_vo v16, x4, -144                              // ...............*................................................................................................... || .....*..............................
        // sqrdmulh v24.8H, v10.8H, v13.8H                   // ...........*....................................................................................................... || .....*..............................
        // trn2 v21.4S, v1.4S, v27.4S                        // ........*.......................................................................................................... || ....*...............................
        // mul v15.8H, v12.8H, v17.8H                        // .........................*......................................................................................... || ........*...........................
        // ldr_vo v0, x4, -16                                // ..........*........................................................................................................ || ....*...............................
        // mul v19.8H, v10.8H, v17.8H                        // ................*.................................................................................................. || ......*.............................
        // trn2 v14.4S, v2.4S, v28.4S                        // .........*......................................................................................................... || ....*...............................
        // sqrdmulh v28.8H, v12.8H, v13.8H                   // ........................*.......................................................................................... || ........*...........................
        // ldr_vo v26, x4, -176                              // .......................*........................................................................................... || .......*............................
        // mla v19.8H, v24.8H, v8.H[0]                       // .....................*............................................................................................. || .......*............................
        // trn1 v18.4S, v4.4S, v30.4S                        // ............*...................................................................................................... || .....*..............................
        // sqrdmulh v5.8H, v21.8H, v13.8H                    // .............*..................................................................................................... || .....*..............................
        // ldr_vo v24, x4, -192                              // ..........................*........................................................................................ || ........*...........................
        // sqrdmulh v12.8H, v14.8H, v13.8H                   // ...........................*....................................................................................... || .........*..........................
        // mul v21.8H, v21.8H, v17.8H                        // ..................*................................................................................................ || ......*.............................
        // mla v15.8H, v28.8H, v8.H[0]                       // ...................................*............................................................................... || ..........*.........................
        // mla v21.8H, v5.8H, v8.H[0]                        // ......................*............................................................................................ || .......*............................
        // add v28.8H, v18.8H, v19.8H                        // ............................*...................................................................................... || .........*..........................
        // mul v5.8H, v14.8H, v17.8H                         // .............................*..................................................................................... || .........*..........................
        // sub v18.8H, v18.8H, v19.8H                        // .................................*................................................................................. || ..........*.........................
        // sqrdmulh v14.8H, v28.8H, v26.8H                   // ..................................*................................................................................ || ..........*.........................
        // mla v5.8H, v12.8H, v8.H[0]                        // .....................................*............................................................................. || ...........*........................
        // sub v10.8H, v11.8H, v15.8H                        // .......................................*........................................................................... || ............*.......................
        // mul v28.8H, v28.8H, v24.8H                        // ......................................*............................................................................ || ...........*........................
        // mla v28.8H, v14.8H, v8.H[0]                       // ..........................................*........................................................................ || ............*.......................
        // add v14.8H, v11.8H, v15.8H                        // ........................................*.......................................................................... || ............*.......................
        // mul v7.8H, v10.8H, v23.8H                         // .....................................................*............................................................. || ................*...................
        // sqrdmulh v13.8H, v18.8H, v16.8H                   // .........................................*......................................................................... || ............*.......................
        // add v20.8H, v6.8H, v5.8H                          // ..............................................*.................................................................... || .............*......................
        // sqrdmulh v4.8H, v14.8H, v26.8H                    // ...........................................*....................................................................... || .............*......................
        // ldr_vo v15, x4, -112                              // ...............................*................................................................................... || .........*..........................
        // mul v2.8H, v18.8H, v23.8H                         // .............................................*..................................................................... || .............*......................
        // add v19.8H, v20.8H, v28.8H                        // ................................................*.................................................................. || ..............*.....................
        // sqrdmulh v12.8H, v10.8H, v16.8H                   // .........................................................*......................................................... || .................*..................
        // sub v18.8H, v20.8H, v28.8H                        // ...............................................*................................................................... || ..............*.....................
        // ldr_vo v20, x4, -96                               // ..*................................................................................................................ || *...................................
        // mul v28.8H, v19.8H, v31.8H                        // ...................................................*............................................................... || ...............*....................
        // mla v2.8H, v13.8H, v8.H[0]                        // ..................................................*................................................................ || ..............*.....................
        // trn1 v13.4S, v1.4S, v27.4S                        // ...................*............................................................................................... || ......*.............................
        // ldr_vo v11, x4, -48                               // ...*............................................................................................................... || .*..................................
        // mla v7.8H, v12.8H, v8.H[0]                        // ................................................................*.................................................. || ...................*................
        // mul v30.8H, v14.8H, v24.8H                        // .................................................*................................................................. || ..............*.....................
        // sub v26.8H, v6.8H, v5.8H                          // ............................................*...................................................................... || .............*......................
        // sqrdmulh v15.8H, v19.8H, v15.8H                   // ....................................................*.............................................................. || ...............*....................
        // sub v17.8H, v26.8H, v2.8H                         // ...............................................................*................................................... || ...................*................
        // sqrdmulh v16.8H, v18.8H, v22.8H                   // ...................................................................*............................................... || ....................*...............
        // mla v30.8H, v4.8H, v8.H[0]                        // .......................................................*........................................................... || ................*...................
        // mul v20.8H, v18.8H, v20.8H                        // .............................................................*..................................................... || ...................*................
        // add v23.8H, v26.8H, v2.8H                         // ......................................................*............................................................ || ................*...................
        // sub v3.8H, v13.8H, v21.8H                         // ..............................*.................................................................................... || .........*..........................
        // add v14.8H, v13.8H, v21.8H                        // ................................*.................................................................................. || ..........*.........................
        // sqrdmulh v6.8H, v17.8H, v0.8H                     // .....................................................................*............................................. || .....................*..............
        // mla v28.8H, v15.8H, v8.H[0]                       // ............................................................*...................................................... || ..................*.................
        // sub v13.8H, v14.8H, v30.8H                        // ...........................................................*....................................................... || ..................*.................
        // mla v20.8H, v16.8H, v8.H[0]                       // .........................................................................*......................................... || ......................*.............
        // mul v1.8H, v17.8H, v25.8H                         // ........................................................................*.......................................... || ......................*.............
        // add v31.8H, v14.8H, v30.8H                        // ..............................................................*.................................................... || ...................*................
        // add v16.8H, v31.8H, v28.8H                        // .................................................................*................................................. || ....................*...............
        // add v30.8H, v3.8H, v7.8H                          // ....................................................................*.............................................. || .....................*..............
        // sqrdmulh v25.8H, v23.8H, v11.8H                   // ..........................................................*........................................................ || ..................*.................
        // mla v1.8H, v6.8H, v8.H[0]                         // ............................................................................*...................................... || .......................*............
        // add v24.8H, v13.8H, v20.8H                        // ..............................................................................*.................................... || ........................*...........
        // sub v22.8H, v3.8H, v7.8H                          // ......................................................................*............................................ || ......................*.............
        // mul v10.8H, v23.8H, v9.8H                         // ........................................................*.......................................................... || .................*..................
        // sub v5.8H, v13.8H, v20.8H                         // .............................................................................................*..................... || ...........................*........
        // mla v10.8H, v25.8H, v8.H[0]                       // ..................................................................*................................................ || ....................*...............
        // sub v27.8H, v22.8H, v1.8H                         // ...................................................................................*............................... || .........................*..........
        // sub v4.8H, v31.8H, v28.8H                         // ..........................................................................*........................................ || .......................*............
        // trn2 v20.4S, v5.4S, v27.4S                        // ..............................................................................................*.................... || ............................*.......
        // add v29.8H, v22.8H, v1.8H                         // ..................................................................................*................................ || .........................*..........
        // trn1 v28.4S, v5.4S, v27.4S                        // ...............................................................................................*................... || ............................*.......
        // add v2.8H, v30.8H, v10.8H                         // .......................................................................*........................................... || ......................*.............
        // trn2 v19.4S, v24.4S, v29.4S                       // .......................................................................................*........................... || ..........................*.........
        // sqdmulh v13.8H, v28.8H, v8.H[1]                   // ..................................................................................................*................ || .............................*......
        // sub v15.8H, v30.8H, v10.8H                        // ...........................................................................*....................................... || .......................*............
        // trn1 v25.4S, v16.4S, v2.4S                        // .....................................................................................*............................. || .........................*..........
        // trn2 v17.4S, v16.4S, v2.4S                        // .............................................................................*..................................... || .......................*............
        // sqdmulh v21.8H, v19.8H, v8.H[1]                   // ................................................................................................*.................. || ............................*.......
        // trn2 v18.4S, v4.4S, v15.4S                        // .................................................................................*................................. || ........................*...........
        // sqdmulh v0.8H, v25.8H, v8.H[1]                    // ............................................................................................*...................... || ...........................*........
        // trn1 v27.4S, v24.4S, v29.4S                       // ......................................................................................*............................ || ..........................*.........
        // sqdmulh v30.8H, v17.8H, v8.H[1]                   // ................................................................................*.................................. || ........................*...........
        // trn1 v26.4S, v4.4S, v15.4S                        // ...............................................................................*................................... || ........................*...........
        // sqdmulh v22.8H, v26.8H, v8.H[1]                   // ....................................................................................*.............................. || .........................*..........
        // srshr v24.8H, v13.8H, #11                         // ...........................................................................................................*....... || ...............................*....
        // sqdmulh v29.8H, v27.8H, v8.H[1]                   // ..........................................................................................*........................ || ...........................*........
        // srshr v13.8H, v21.8H, #11                         // ........................................................................................................*.......... || ..............................*.....
        // sqdmulh v10.8H, v18.8H, v8.H[1]                   // ........................................................................................*.......................... || ..........................*.........
        // srshr v15.8H, v0.8H, #11                          // .....................................................................................................*............. || .............................*......
        // sqdmulh v12.8H, v20.8H, v8.H[1]                   // ....................................................................................................*.............. || .............................*......
        // srshr v0.8H, v30.8H, #11                          // .........................................................................................*......................... || ..........................*.........
        // mla v28.8H, v24.8H, v8.H[0]                       // ................................................................................................................*.. || .................................*..
        // mla v19.8H, v13.8H, v8.H[0]                       // ..............................................................................................................*.... || ................................*...
        // srshr v30.8H, v22.8H, #11                         // ...........................................................................................*....................... || ...........................*........
        // srshr v24.8H, v29.8H, #11                         // ...................................................................................................*............... || .............................*......
        // mla v25.8H, v15.8H, v8.H[0]                       // ..........................................................................................................*........ || ...............................*....
        // mla v17.8H, v0.8H, v8.H[0]                        // ......................................................................................................*............ || ..............................*.....
        // srshr v11.8H, v10.8H, #11                         // .................................................................................................*................. || ............................*.......
        // srshr v7.8H, v12.8H, #11                          // ............................................................................................................*...... || ...............................*....
        // mla v27.8H, v24.8H, v8.H[0]                       // .............................................................................................................*..... || ................................*...
        // mla v26.8H, v30.8H, v8.H[0]                       // .......................................................................................................*........... || ..............................*.....
        // mla v20.8H, v7.8H, v8.H[0]                        // ...............................................................................................................*... || .................................*..
        // mla v18.8H, v11.8H, v8.H[0]                       // .........................................................................................................*......... || ...............................*....
        // st4 {v25.4S,v26.4S,v27.4S,v28.4S}, [x6], #64      // ..................................................................................................................* || ...................................*
        // st4 {v17.4S,v18.4S,v19.4S,v20.4S}, [x7], #64      // .................................................................................................................*. || ...................................*
        

       pop_stack
       ret