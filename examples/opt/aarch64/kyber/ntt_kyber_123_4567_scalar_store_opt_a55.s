///
/// Copyright (c) 2022 Arm Limited
/// Copyright (c) 2022 Hanno Becker
/// Copyright (c) 2023 Amin Abdulrahman, Matthias Kannwischer
/// SPDX-License-Identifier: MIT
///
/// Permission is hereby granted, free of charge, to any person obtaining a copy
/// of this software and associated documentation files (the "Software"), to deal
/// in the Software without restriction, including without limitation the rights
/// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
/// copies of the Software, and to permit persons to whom the Software is
/// furnished to do so, subject to the following conditions:
///
/// The above copyright notice and this permission notice shall be included in all
/// copies or substantial portions of the Software.
///
/// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
/// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
/// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
/// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
/// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
/// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
/// SOFTWARE.
///

// Needed to provide ASM_LOAD directive
#include <hal_env.h>

// NOTE
// We use a lot of trivial macros to simplify the parsing burden for Slothy
// The macros are not unfolded by Slothy and thus interpreted as instructions,
// which are easier to parse due to e.g. the lack of size specifiers and simpler
// syntax for pre and post increment for loads and stores.
//
// Eventually, NeLight should include a proper parser for AArch64,
// but for initial investigations, the below is enough.

.macro ldr_vo vec, base, offset                    // slothy:no-unfold
       ldr qform_\vec, [\base, #\offset]
.endm
.macro ldr_vi vec, base, inc                        // slothy:no-unfold
        ldr qform_\vec, [\base], #\inc
.endm

.macro str_vo vec, base, offset                     // slothy:no-unfold
        str qform_\vec, [\base, #\offset]
.endm
.macro str_vi vec, base, inc                        // slothy:no-unfold
        str qform_\vec, [\base], #\inc
.endm

.macro vqrdmulh d,a,b
        sqrdmulh \d\().8h, \a\().8h, \b\().8h
.endm
.macro vmlsq d,a,b,i
        mls \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vqrdmulhq d,a,b,i
        sqrdmulh \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vqdmulhq d,a,b,i
        sqdmulh \d\().8h, \a\().8h, \b\().h[\i]
.endm
.macro vmulq d,a,b,i
        mul \d\().8h, \a\().8h, \b\().h[\i]
.endm

.macro mulmodq dst, src, const, idx0, idx1
        vmulq       \dst,  \src, \const, \idx0
        vqrdmulhq   \src,  \src, \const, \idx1
        vmlsq        \dst,  \src, consts, 0
.endm

.macro mulmod dst, src, const, const_twisted
        mul        \dst\().8h,  \src\().8h, \const\().8h
        vqrdmulh   \src,  \src, \const_twisted
        vmlsq      \dst,  \src, consts, 0
.endm

.macro ct_butterfly a, b, root, idx0, idx1
        mulmodq  tmp, \b, \root, \idx0, \idx1
        sub     \b\().8h,    \a\().8h, tmp.8h
        add     \a\().8h,    \a\().8h, tmp.8h
.endm

.macro mulmod_v dst, src, const, const_twisted
        vmul        \dst,  \src, \const
        vqrdmulh    \src,  \src, \const_twisted
        vmlsq       \dst,  \src, consts, 0
.endm

.macro ct_butterfly_v a, b, root, root_twisted
        mulmod  tmp, \b, \root, \root_twisted
        sub    \b\().8h,    \a\().8h, tmp.8h
        add    \a\().8h,    \a\().8h, tmp.8h
.endm

.macro barrett_reduce a
        vqdmulhq tmp, \a, consts, 1
        srshr    tmp.8h, tmp.8h, #11
        vmlsq    \a, tmp, consts, 0
.endm

.macro load_roots_123
        ldr_vi root0, r_ptr0, 32
        ldr_vo root1, r_ptr0, -16
.endm

.macro load_next_roots_45
        ldr_vi root0, r_ptr0, 16
.endm

.macro load_next_roots_67
        ldr_vi root0,    r_ptr1, (6*16)
        ldr_vo root0_tw, r_ptr1, (-6*16 + 1*16)
        ldr_vo root1,    r_ptr1, (-6*16 + 2*16)
        ldr_vo root1_tw, r_ptr1, (-6*16 + 3*16)
        ldr_vo root2,    r_ptr1, (-6*16 + 4*16)
        ldr_vo root2_tw, r_ptr1, (-6*16 + 5*16)
.endm

.macro transpose4 data
        trn1 t0.4s, \data\()0\().4s, \data\()1\().4s
        trn2 t1.4s, \data\()0\().4s, \data\()1\().4s
        trn1 t2.4s, \data\()2\().4s, \data\()3\().4s
        trn2 t3.4s, \data\()2\().4s, \data\()3\().4s

        trn2 \data\()2\().2d, t0.2d, t2.2d
        trn2 \data\()3\().2d, t1.2d, t3.2d
        trn1 \data\()0\().2d, t0.2d, t2.2d
        trn1 \data\()1\().2d, t1.2d, t3.2d
.endm

.macro transpose_single data_out, data_in
        trn1 \data_out\()0\().4s, \data_in\()0\().4s, \data_in\()1\().4s
        trn2 \data_out\()1\().4s, \data_in\()0\().4s, \data_in\()1\().4s
        trn1 \data_out\()2\().4s, \data_in\()2\().4s, \data_in\()3\().4s
        trn2 \data_out\()3\().4s, \data_in\()2\().4s, \data_in\()3\().4s
.endm

.macro vext gpr_out, vec_in, lane // slothy:no-unfold
        umov \gpr_out\(), \vec_in\().d[\lane]
.endm

.macro vec_to_scalar_matrix out, in
        vext \out\()_00, \in\()0, 0
        vext \out\()_01, \in\()0, 1
        vext \out\()_10, \in\()1, 0
        vext \out\()_11, \in\()1, 1
        vext \out\()_20, \in\()2, 0
        vext \out\()_21, \in\()2, 1
        vext \out\()_30, \in\()3, 0
        vext \out\()_31, \in\()3, 1
.endm

.macro store_scalar_matrix_with_inc x, addr, inc
        str \x\()t_00, [\addr], #( \inc)
        str \x\()t_01, [\addr,  #(-\inc + 8*1)]
        str \x\()t_10, [\addr,  #(-\inc + 8*2)]
        str \x\()t_11, [\addr,  #(-\inc + 8*3)]
        str \x\()t_20, [\addr,  #(-\inc + 8*4)]
        str \x\()t_21, [\addr,  #(-\inc + 8*5)]
        str \x\()t_30, [\addr,  #(-\inc + 8*6)]
        str \x\()t_31, [\addr,  #(-\inc + 8*7)]
.endm


.macro save_gprs // slothy:no-unfold
        sub sp, sp, #(16*6)
        stp x19, x20, [sp, #16*0]
        stp x19, x20, [sp, #16*0]
        stp x21, x22, [sp, #16*1]
        stp x23, x24, [sp, #16*2]
        stp x25, x26, [sp, #16*3]
        stp x27, x28, [sp, #16*4]
        str x29, [sp, #16*5]
.endm

.macro restore_gprs // slothy:no-unfold
        ldp x19, x20, [sp, #16*0]
        ldp x21, x22, [sp, #16*1]
        ldp x23, x24, [sp, #16*2]
        ldp x25, x26, [sp, #16*3]
        ldp x27, x28, [sp, #16*4]
        ldr x29, [sp, #16*5]
        add sp, sp, #(16*6)
.endm

.macro save_vregs // slothy:no-unfold
        sub sp, sp, #(16*4)
        stp  d8,  d9, [sp, #16*0]
        stp d10, d11, [sp, #16*1]
        stp d12, d13, [sp, #16*2]
        stp d14, d15, [sp, #16*3]
.endm

.macro restore_vregs // slothy:no-unfold
        ldp  d8,  d9, [sp, #16*0]
        ldp d10, d11, [sp, #16*1]
        ldp d12, d13, [sp, #16*2]
        ldp d14, d15, [sp, #16*3]
        add sp, sp, #(16*4)
.endm

#define STACK_SIZE 16
#define STACK0 0

.macro restore a, loc     // slothy:no-unfold
        ldr \a, [sp, #\loc\()]
.endm
.macro save loc, a        // slothy:no-unfold
        str \a, [sp, #\loc\()]
.endm
.macro push_stack // slothy:no-unfold
        save_gprs
        save_vregs
        sub sp, sp, #STACK_SIZE
.endm

.macro pop_stack // slothy:no-unfold
        add sp, sp, #STACK_SIZE
        restore_vregs
        restore_gprs
.endm

.data
.p2align 4
roots:
#include "ntt_kyber_123_45_67_twiddles.s"
.text

        .global ntt_kyber_123_4567_scalar_store_opt_a55
        .global _ntt_kyber_123_4567_scalar_store_opt_a55

.p2align 4
const_addr:       .short 3329
                  .short 20159
                  .short 0
                  .short 0
                  .short 0
                  .short 0
                  .short 0
                  .short 0
ntt_kyber_123_4567_scalar_store_opt_a55:
_ntt_kyber_123_4567_scalar_store_opt_a55:
        push_stack

        in      .req x0
        inp     .req x1
        count   .req x2
        r_ptr0  .req x3
        r_ptr1  .req x4
        xtmp    .req x5

        qform_v0  .req q0
        qform_v1  .req q1
        qform_v2  .req q2
        qform_v3  .req q3
        qform_v4  .req q4
        qform_v5  .req q5
        qform_v6  .req q6
        qform_v7  .req q7
        qform_v8  .req q8
        qform_v9  .req q9
        qform_v10 .req q10
        qform_v11 .req q11
        qform_v12 .req q12
        qform_v13 .req q13
        qform_v14 .req q14
        qform_v15 .req q15
        qform_v16 .req q16
        qform_v17 .req q17
        qform_v18 .req q18
        qform_v19 .req q19
        qform_v20 .req q20
        qform_v21 .req q21
        qform_v22 .req q22
        qform_v23 .req q23
        qform_v24 .req q24
        qform_v25 .req q25
        qform_v26 .req q26
        qform_v27 .req q27
        qform_v28 .req q28
        qform_v29 .req q29
        qform_v30 .req q30
        qform_v31 .req q31

        data0  .req v8
        data1  .req v9
        data2  .req v10
        data3  .req v11
        data4  .req v12
        data5  .req v13
        data6  .req v14
        data7  .req v15

        x_00 .req x10
        x_01 .req x11
        x_10 .req x12
        x_11 .req x13
        x_20 .req x14
        x_21 .req x15
        x_30 .req x16
        x_31 .req x17

        xt_00 .req x_00
        xt_01 .req x_20
        xt_10 .req x_10
        xt_11 .req x_30
        xt_20 .req x_01
        xt_21 .req x_21
        xt_30 .req x_11
        xt_31 .req x_31

        qform_data0  .req q8
        qform_data1  .req q9
        qform_data2  .req q10
        qform_data3  .req q11
        qform_data4  .req q12
        qform_data5  .req q13
        qform_data6  .req q14
        qform_data7  .req q15

        root0    .req v0
        root1    .req v1
        root2    .req v2
        root0_tw .req v4
        root1_tw .req v5
        root2_tw .req v6

        consts         .req v7
        qform_consts   .req q7

        qform_root0    .req q0
        qform_root1    .req q1
        qform_root2    .req q2
        qform_root0_tw .req q4
        qform_root1_tw .req q5
        qform_root2_tw .req q6

        tmp .req v24
        t0  .req v25
        t1  .req v26
        t2  .req v27
        t3  .req v28

        ASM_LOAD(r_ptr0, roots)
        ASM_LOAD(r_ptr1, roots_l56)

        ASM_LOAD(xtmp, const_addr)
        ld1 {consts.8h}, [xtmp]

        save STACK0, in
        mov count, #4

        load_roots_123

        .p2align 2
        ldr_vo v4, x0, 0                         // *.........
        // gap                                   // ..........
        // gap                                   // ..........
        // gap                                   // ..........
        ldr_vo v12, x0, 64                       // .*........
        // gap                                   // ..........
        // gap                                   // ..........
        // gap                                   // ..........
        ldr_vo v30, x0, 128                      // ..*.......
        // gap                                   // ..........
        // gap                                   // ..........
        // gap                                   // ..........
        ldr_vo v18, x0, 192                      // ...*......
        // gap                                   // ..........
        // gap                                   // ..........
        // gap                                   // ..........
        ldr_vo v20, x0, 256                      // ....*.....
        // gap                                   // ..........
        // gap                                   // ..........
        // gap                                   // ..........
        ldr_vo v26, x0, 448                      // .......*..
        // gap                                   // ..........
        // gap                                   // ..........
        // gap                                   // ..........
        sqrdmulh v5.8H, v20.8H, v0.H[1]          // ......*...
        // gap                                   // ..........
        ldr_vo v6, x0, 320                       // .....*....
        // gap                                   // ..........
        // gap                                   // ..........
        // gap                                   // ..........
        sqrdmulh v24.8H, v26.8H, v0.H[1]         // .........*
        // gap                                   // ..........
        ldr_vo v25, x0, 384                      // ........*.
        // gap                                   // ..........
        
        // original source code
        // ldr_vo v4, x0, 0                      // *......... || *................
        // ldr_vo v12, x0, 64                    // .*........ || ..*..............
        // ldr_vo v30, x0, 128                   // ..*....... || ....*............
        // ldr_vo v18, x0, 192                   // ...*...... || ......*..........
        // ldr_vo v20, x0, 256                   // ....*..... || ........*........
        // ldr_vo v6, x0, 320                    // .......*.. || .............*...
        // sqrdmulh v5.8H, v20.8H, v0.H[1]       // ......*... || ............*....
        // ldr_vo v26, x0, 448                   // .....*.... || ..........*......
        // ldr_vo v25, x0, 384                   // .........* || ................*
        // sqrdmulh v24.8H, v26.8H, v0.H[1]      // ........*. || ...............*.
        
        sub count, count, #1
.p2align 2
layer123_start:
        mul v20.8H, v20.8H, v0.H[0]              // ........*...................................................................
        // gap                                   // ............................................................................
        mul v13.8H, v6.8H, v0.H[0]               // .............*..............................................................
        // gap                                   // ............................................................................
        sqrdmulh v9.8H, v6.8H, v0.H[1]           // ..............*.............................................................
        // gap                                   // ............................................................................
        mul v10.8H, v25.8H, v0.H[0]              // ..................*.........................................................
        // gap                                   // ............................................................................
        mls v20.8H, v5.8H, v7.H[0]               // ..........*.................................................................
        // gap                                   // ............................................................................
        sqrdmulh v6.8H, v25.8H, v0.H[1]          // ...................*........................................................
        // gap                                   // ............................................................................
        mls v13.8H, v9.8H, v7.H[0]               // ...............*............................................................
        // gap                                   // ............................................................................
        mul v9.8H, v26.8H, v0.H[0]               // .......................*....................................................
        // gap                                   // ............................................................................
        sub v5.8H, v4.8H, v20.8H                 // ...........*................................................................
        // gap                                   // ............................................................................
        mls v10.8H, v6.8H, v7.H[0]               // ....................*.......................................................
        // gap                                   // ............................................................................
        add v20.8H, v4.8H, v20.8H                // ............*...............................................................
        // gap                                   // ............................................................................
        sub v6.8H, v12.8H, v13.8H                // ................*...........................................................
        // gap                                   // ............................................................................
        add v13.8H, v12.8H, v13.8H               // .................*..........................................................
        // gap                                   // ............................................................................
        sub v26.8H, v30.8H, v10.8H               // .....................*......................................................
        // gap                                   // ............................................................................
        add v10.8H, v30.8H, v10.8H               // ......................*.....................................................
        // gap                                   // ............................................................................
        mls v9.8H, v24.8H, v7.H[0]               // .........................*..................................................
        // gap                                   // ............................................................................
        mul v30.8H, v26.8H, v0.H[4]              // ......................................*.....................................
        // gap                                   // ............................................................................
        sqrdmulh v26.8H, v26.8H, v0.H[5]         // .......................................*....................................
        // gap                                   // ............................................................................
        mul v4.8H, v10.8H, v0.H[2]               // ............................*...............................................
        // gap                                   // ............................................................................
        sub v12.8H, v18.8H, v9.8H                // ..........................*.................................................
        // gap                                   // ............................................................................
        add v9.8H, v18.8H, v9.8H                 // ...........................*................................................
        // gap                                   // ............................................................................
        mls v30.8H, v26.8H, v7.H[0]              // ........................................*...................................
        // gap                                   // ............................................................................
        sqrdmulh v10.8H, v10.8H, v0.H[3]         // .............................*..............................................
        // gap                                   // ............................................................................
        mul v26.8H, v12.8H, v0.H[4]              // ...........................................*................................
        // gap                                   // ............................................................................
        sqrdmulh v12.8H, v12.8H, v0.H[5]         // ............................................*...............................
        // gap                                   // ............................................................................
        sub v18.8H, v5.8H, v30.8H                // .........................................*..................................
        // gap                                   // ............................................................................
        add v5.8H, v5.8H, v30.8H                 // ..........................................*.................................
        // gap                                   // ............................................................................
        mls v4.8H, v10.8H, v7.H[0]               // ..............................*.............................................
        // gap                                   // ............................................................................
        mul v10.8H, v9.8H, v0.H[2]               // .................................*..........................................
        // gap                                   // ............................................................................
        mls v26.8H, v12.8H, v7.H[0]              // .............................................*..............................
        // gap                                   // ............................................................................
        sqrdmulh v9.8H, v9.8H, v0.H[3]           // ..................................*.........................................
        // gap                                   // ............................................................................
        sub v30.8H, v20.8H, v4.8H                // ...............................*............................................
        // gap                                   // ............................................................................
        add v20.8H, v20.8H, v4.8H                // ................................*...........................................
        // gap                                   // ............................................................................
        sub v4.8H, v6.8H, v26.8H                 // ..............................................*.............................
        // gap                                   // ............................................................................
        add v6.8H, v6.8H, v26.8H                 // ...............................................*............................
        // gap                                   // ............................................................................
        mls v10.8H, v9.8H, v7.H[0]               // ...................................*........................................
        // gap                                   // ............................................................................
        mul v9.8H, v4.8H, v1.H[4]                // ...............................................................*............
        // gap                                   // ............................................................................
        mul v26.8H, v6.8H, v1.H[2]               // ..........................................................*.................
        // gap                                   // ............................................................................
        sqrdmulh v6.8H, v6.8H, v1.H[3]           // ...........................................................*................
        // gap                                   // ............................................................................
        sub v12.8H, v13.8H, v10.8H               // ....................................*.......................................
        // gap                                   // ............................................................................
        add v13.8H, v13.8H, v10.8H               // .....................................*......................................
        // gap                                   // ............................................................................
        sqrdmulh v10.8H, v4.8H, v1.H[5]          // ................................................................*...........
        // gap                                   // ............................................................................
        mul v4.8H, v12.8H, v1.H[0]               // .....................................................*......................
        // gap                                   // ............................................................................
        mul v25.8H, v13.8H, v0.H[6]              // ................................................*...........................
        // gap                                   // ............................................................................
        sqrdmulh v13.8H, v13.8H, v0.H[7]         // .................................................*..........................
        // gap                                   // ............................................................................
        sqrdmulh v12.8H, v12.8H, v1.H[1]         // ......................................................*.....................
        // gap                                   // ............................................................................
        mls v26.8H, v6.8H, v7.H[0]               // ............................................................*...............
        // gap                                   // ............................................................................
        mls v9.8H, v10.8H, v7.H[0]               // .................................................................*..........
        // gap                                   // ............................................................................
        mls v25.8H, v13.8H, v7.H[0]              // ..................................................*.........................
        // gap                                   // ............................................................................
        mls v4.8H, v12.8H, v7.H[0]               // .......................................................*....................
        // gap                                   // ............................................................................
        sub v13.8H, v5.8H, v26.8H                // .............................................................*..............
        // gap                                   // ............................................................................
        sub v10.8H, v18.8H, v9.8H                // ..................................................................*.........
        // gap                                   // ............................................................................
        add v9.8H, v18.8H, v9.8H                 // ...................................................................*........
        // gap                                   // ............................................................................
        add v6.8H, v5.8H, v26.8H                 // ..............................................................*.............
        // gap                                   // ............................................................................
        sub v5.8H, v20.8H, v25.8H                // ...................................................*........................
        // gap                                   // ............................................................................
        add v20.8H, v20.8H, v25.8H               // ....................................................*.......................
        // gap                                   // ............................................................................
        sub v26.8H, v30.8H, v4.8H                // ........................................................*...................
        // gap                                   // ............................................................................
        add v30.8H, v30.8H, v4.8H                // .........................................................*..................
        // gap                                   // ............................................................................
        str_vi v20, x0, 16                       // ....................................................................*.......
        // gap                                   // ............................................................................
        ldr_vo v4, x0, 0                         // e...........................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        str_vo v5, x0, 48                        // .....................................................................*......
        // gap                                   // ............................................................................
        ldr_vo v12, x0, 64                       // .e..........................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        str_vo v30, x0, 112                      // ......................................................................*.....
        // gap                                   // ............................................................................
        ldr_vo v30, x0, 128                      // ..e.........................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        str_vo v26, x0, 176                      // .......................................................................*....
        // gap                                   // ............................................................................
        ldr_vo v18, x0, 192                      // ...e........................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        str_vo v6, x0, 240                       // ........................................................................*...
        // gap                                   // ............................................................................
        ldr_vo v20, x0, 256                      // ....e.......................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        str_vo v13, x0, 304                      // .........................................................................*..
        // gap                                   // ............................................................................
        ldr_vo v6, x0, 320                       // .....e......................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        str_vo v9, x0, 368                       // ..........................................................................*.
        // gap                                   // ............................................................................
        sqrdmulh v5.8H, v20.8H, v0.H[1]          // .........e..................................................................
        // gap                                   // ............................................................................
        str_vo v10, x0, 432                      // ...........................................................................*
        // gap                                   // ............................................................................
        ldr_vo v26, x0, 448                      // .......e....................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        ldr_vo v25, x0, 384                      // ......e.....................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        // gap                                   // ............................................................................
        sqrdmulh v24.8H, v26.8H, v0.H[1]         // ........................e...................................................
        // gap                                   // ............................................................................
        
        // original source code
        // ldr_vo v8, x0, 0                      // e......................................................................................... || e.......................................................................................................
        // ldr_vo v9, x0, 64                     // ..e....................................................................................... || ...e....................................................................................................
        // ldr_vo v10, x0, 128                   // ....e..................................................................................... || ......e.................................................................................................
        // ldr_vo v11, x0, 192                   // ......e................................................................................... || .........e..............................................................................................
        // ldr_vo v12, x0, 256                   // ........e................................................................................. || ............e...........................................................................................
        // ldr_vo v13, x0, 320                   // ..........e............................................................................... || ...............e........................................................................................
        // ldr_vo v14, x0, 384                   // ...............e.......................................................................... || ......................e.................................................................................
        // ldr_vo v15, x0, 448                   // ..............e........................................................................... || ....................e...................................................................................
        // mul v24.8H, v12.8H, v0.H[0]           // .................*........................................................................ || .........................*..............................................................................
        // sqrdmulh v12.8H, v12.8H, v0.H[1]      // ............e............................................................................. || ..................e.....................................................................................
        // mls v24.8H, v12.8H, v7.H[0]           // .....................*.................................................................... || .............................*..........................................................................
        // sub v12.8H, v8.8H, v24.8H             // .........................*................................................................ || .................................*......................................................................
        // add v8.8H, v8.8H, v24.8H              // ...........................*.............................................................. || ...................................*....................................................................
        // mul v24.8H, v13.8H, v0.H[0]           // ..................*....................................................................... || ..........................*.............................................................................
        // sqrdmulh v13.8H, v13.8H, v0.H[1]      // ...................*...................................................................... || ...........................*............................................................................
        // mls v24.8H, v13.8H, v7.H[0]           // .......................*.................................................................. || ...............................*........................................................................
        // sub v13.8H, v9.8H, v24.8H             // ............................*............................................................. || ....................................*...................................................................
        // add v9.8H, v9.8H, v24.8H              // .............................*............................................................ || .....................................*..................................................................
        // mul v24.8H, v14.8H, v0.H[0]           // ....................*..................................................................... || ............................*...........................................................................
        // sqrdmulh v14.8H, v14.8H, v0.H[1]      // ......................*................................................................... || ..............................*.........................................................................
        // mls v24.8H, v14.8H, v7.H[0]           // ..........................*............................................................... || ..................................*.....................................................................
        // sub v14.8H, v10.8H, v24.8H            // ..............................*........................................................... || ......................................*.................................................................
        // add v10.8H, v10.8H, v24.8H            // ...............................*.......................................................... || .......................................*................................................................
        // mul v24.8H, v15.8H, v0.H[0]           // ........................*................................................................. || ................................*.......................................................................
        // sqrdmulh v15.8H, v15.8H, v0.H[1]      // ................e......................................................................... || ........................e...............................................................................
        // mls v24.8H, v15.8H, v7.H[0]           // ................................*......................................................... || ........................................*...............................................................
        // sub v15.8H, v11.8H, v24.8H            // ....................................*..................................................... || ............................................*...........................................................
        // add v11.8H, v11.8H, v24.8H            // .....................................*.................................................... || .............................................*..........................................................
        // mul v24.8H, v10.8H, v0.H[2]           // ...................................*...................................................... || ...........................................*............................................................
        // sqrdmulh v10.8H, v10.8H, v0.H[3]      // .......................................*.................................................. || ...............................................*........................................................
        // mls v24.8H, v10.8H, v7.H[0]           // ............................................*............................................. || ....................................................*...................................................
        // sub v10.8H, v8.8H, v24.8H             // ................................................*......................................... || ........................................................*...............................................
        // add v8.8H, v8.8H, v24.8H              // .................................................*........................................ || .........................................................*..............................................
        // mul v24.8H, v11.8H, v0.H[2]           // .............................................*............................................ || .....................................................*..................................................
        // sqrdmulh v11.8H, v11.8H, v0.H[3]      // ...............................................*.......................................... || .......................................................*................................................
        // mls v24.8H, v11.8H, v7.H[0]           // ....................................................*..................................... || ............................................................*...........................................
        // sub v11.8H, v9.8H, v24.8H             // ........................................................*................................. || ................................................................*.......................................
        // add v9.8H, v9.8H, v24.8H              // .........................................................*................................ || .................................................................*......................................
        // mul v24.8H, v14.8H, v0.H[4]           // .................................*........................................................ || .........................................*..............................................................
        // sqrdmulh v14.8H, v14.8H, v0.H[5]      // ..................................*....................................................... || ..........................................*.............................................................
        // mls v24.8H, v14.8H, v7.H[0]           // ......................................*................................................... || ..............................................*.........................................................
        // sub v14.8H, v12.8H, v24.8H            // ..........................................*............................................... || ..................................................*.....................................................
        // add v12.8H, v12.8H, v24.8H            // ...........................................*.............................................. || ...................................................*....................................................
        // mul v24.8H, v15.8H, v0.H[4]           // ........................................*................................................. || ................................................*.......................................................
        // sqrdmulh v15.8H, v15.8H, v0.H[5]      // .........................................*................................................ || .................................................*......................................................
        // mls v24.8H, v15.8H, v7.H[0]           // ..............................................*........................................... || ......................................................*.................................................
        // sub v15.8H, v13.8H, v24.8H            // ..................................................*....................................... || ..........................................................*.............................................
        // add v13.8H, v13.8H, v24.8H            // ...................................................*...................................... || ...........................................................*............................................
        // mul v24.8H, v9.8H, v0.H[6]            // ............................................................*............................. || ....................................................................*...................................
        // sqrdmulh v9.8H, v9.8H, v0.H[7]        // .............................................................*............................ || .....................................................................*..................................
        // mls v24.8H, v9.8H, v7.H[0]            // .................................................................*........................ || .........................................................................*..............................
        // sub v9.8H, v8.8H, v24.8H              // .......................................................................*.................. || ...............................................................................*........................
        // add v8.8H, v8.8H, v24.8H              // ........................................................................*................. || ................................................................................*.......................
        // mul v24.8H, v11.8H, v1.H[0]           // ...........................................................*.............................. || ...................................................................*....................................
        // sqrdmulh v11.8H, v11.8H, v1.H[1]      // ..............................................................*........................... || ......................................................................*.................................
        // mls v24.8H, v11.8H, v7.H[0]           // ..................................................................*....................... || ..........................................................................*.............................
        // sub v11.8H, v10.8H, v24.8H            // .........................................................................*................ || .................................................................................*......................
        // add v10.8H, v10.8H, v24.8H            // ..........................................................................*............... || ..................................................................................*.....................
        // mul v24.8H, v13.8H, v1.H[2]           // ......................................................*................................... || ..............................................................*.........................................
        // sqrdmulh v13.8H, v13.8H, v1.H[3]      // .......................................................*.................................. || ...............................................................*........................................
        // mls v24.8H, v13.8H, v7.H[0]           // ...............................................................*.......................... || .......................................................................*................................
        // sub v13.8H, v12.8H, v24.8H            // ...................................................................*...................... || ...........................................................................*............................
        // add v12.8H, v12.8H, v24.8H            // ......................................................................*................... || ..............................................................................*.........................
        // mul v24.8H, v15.8H, v1.H[4]           // .....................................................*.................................... || .............................................................*..........................................
        // sqrdmulh v15.8H, v15.8H, v1.H[5]      // ..........................................................*............................... || ..................................................................*.....................................
        // mls v24.8H, v15.8H, v7.H[0]           // ................................................................*......................... || ........................................................................*...............................
        // sub v15.8H, v14.8H, v24.8H            // ....................................................................*..................... || ............................................................................*...........................
        // add v14.8H, v14.8H, v24.8H            // .....................................................................*.................... || .............................................................................*..........................
        // str_vi v8, x0, 16                     // ...........................................................................*.............. || ...................................................................................*....................
        // str_vo v9, x0, 48                     // .............................................................................*............ || ......................................................................................*.................
        // str_vo v10, x0, 112                   // ...............................................................................*.......... || .........................................................................................*..............
        // str_vo v11, x0, 176                   // .................................................................................*........ || ............................................................................................*...........
        // str_vo v12, x0, 240                   // ...................................................................................*...... || ...............................................................................................*........
        // str_vo v13, x0, 304                   // .....................................................................................*.... || ..................................................................................................*.....
        // str_vo v14, x0, 368                   // .......................................................................................*.. || .....................................................................................................*..
        // str_vo v15, x0, 432                   // .........................................................................................* || .......................................................................................................*
        
        subs count, count, #1
        cbnz count, layer123_start
        mul v29.8H, v26.8H, v0.H[0]              // .......*..........................................................
        // gap                                   // ..................................................................
        mul v14.8H, v20.8H, v0.H[0]              // *.................................................................
        // gap                                   // ..................................................................
        mul v3.8H, v6.8H, v0.H[0]                // .*................................................................
        // gap                                   // ..................................................................
        sqrdmulh v8.8H, v6.8H, v0.H[1]           // ..*...............................................................
        // gap                                   // ..................................................................
        mls v29.8H, v24.8H, v7.H[0]              // ...............*..................................................
        // gap                                   // ..................................................................
        mul v20.8H, v25.8H, v0.H[0]              // ...*..............................................................
        // gap                                   // ..................................................................
        sqrdmulh v22.8H, v25.8H, v0.H[1]         // .....*............................................................
        // gap                                   // ..................................................................
        mls v3.8H, v8.8H, v7.H[0]                // ......*...........................................................
        // gap                                   // ..................................................................
        add v26.8H, v18.8H, v29.8H               // ....................*.............................................
        // gap                                   // ..................................................................
        sub v8.8H, v18.8H, v29.8H                // ...................*..............................................
        // gap                                   // ..................................................................
        mls v20.8H, v22.8H, v7.H[0]              // .........*........................................................
        // gap                                   // ..................................................................
        mul v19.8H, v26.8H, v0.H[2]              // ............................*.....................................
        // gap                                   // ..................................................................
        mls v14.8H, v5.8H, v7.H[0]               // ....*.............................................................
        // gap                                   // ..................................................................
        sub v10.8H, v12.8H, v3.8H                // ...........*......................................................
        // gap                                   // ..................................................................
        add v23.8H, v12.8H, v3.8H                // ............*.....................................................
        // gap                                   // ..................................................................
        sub v5.8H, v30.8H, v20.8H                // .............*....................................................
        // gap                                   // ..................................................................
        add v20.8H, v30.8H, v20.8H               // ..............*...................................................
        // gap                                   // ..................................................................
        sub v17.8H, v4.8H, v14.8H                // ........*.........................................................
        // gap                                   // ..................................................................
        mul v24.8H, v8.8H, v0.H[4]               // .......................*..........................................
        // gap                                   // ..................................................................
        mul v11.8H, v20.8H, v0.H[2]              // ..................*...............................................
        // gap                                   // ..................................................................
        sqrdmulh v27.8H, v20.8H, v0.H[3]         // ......................*...........................................
        // gap                                   // ..................................................................
        add v20.8H, v4.8H, v14.8H                // ..........*.......................................................
        // gap                                   // ..................................................................
        sqrdmulh v15.8H, v5.8H, v0.H[5]          // .................*................................................
        // gap                                   // ..................................................................
        sqrdmulh v13.8H, v8.8H, v0.H[5]          // ........................*.........................................
        // gap                                   // ..................................................................
        mls v11.8H, v27.8H, v7.H[0]              // ...........................*......................................
        // gap                                   // ..................................................................
        mul v22.8H, v5.8H, v0.H[4]               // ................*.................................................
        // gap                                   // ..................................................................
        sqrdmulh v16.8H, v26.8H, v0.H[3]         // ..............................*...................................
        // gap                                   // ..................................................................
        mls v24.8H, v13.8H, v7.H[0]              // .............................*....................................
        // gap                                   // ..................................................................
        sub v8.8H, v20.8H, v11.8H                // ...............................*..................................
        // gap                                   // ..................................................................
        mls v22.8H, v15.8H, v7.H[0]              // .....................*............................................
        // gap                                   // ..................................................................
        mls v19.8H, v16.8H, v7.H[0]              // ...................................*..............................
        // gap                                   // ..................................................................
        add v11.8H, v20.8H, v11.8H               // ................................*.................................
        // gap                                   // ..................................................................
        sub v25.8H, v10.8H, v24.8H               // .................................*................................
        // gap                                   // ..................................................................
        sub v9.8H, v17.8H, v22.8H                // .........................*........................................
        // gap                                   // ..................................................................
        add v14.8H, v23.8H, v19.8H               // ........................................*.........................
        // gap                                   // ..................................................................
        sub v19.8H, v23.8H, v19.8H               // .......................................*..........................
        // gap                                   // ..................................................................
        add v16.8H, v17.8H, v22.8H               // ..........................*.......................................
        // gap                                   // ..................................................................
        add v20.8H, v10.8H, v24.8H               // ..................................*...............................
        // gap                                   // ..................................................................
        mul v6.8H, v25.8H, v1.H[4]               // ....................................*.............................
        // gap                                   // ..................................................................
        sqrdmulh v25.8H, v25.8H, v1.H[5]         // .........................................*........................
        // gap                                   // ..................................................................
        mul v3.8H, v14.8H, v0.H[6]               // ...........................................*......................
        // gap                                   // ..................................................................
        sqrdmulh v31.8H, v14.8H, v0.H[7]         // ............................................*.....................
        // gap                                   // ..................................................................
        mul v2.8H, v20.8H, v1.H[2]               // .....................................*............................
        // gap                                   // ..................................................................
        sqrdmulh v17.8H, v19.8H, v1.H[1]         // .............................................*....................
        // gap                                   // ..................................................................
        mul v19.8H, v19.8H, v1.H[0]              // ..........................................*.......................
        // gap                                   // ..................................................................
        mls v3.8H, v31.8H, v7.H[0]               // ................................................*.................
        // gap                                   // ..................................................................
        sqrdmulh v18.8H, v20.8H, v1.H[3]         // ......................................*...........................
        // gap                                   // ..................................................................
        mls v6.8H, v25.8H, v7.H[0]               // ...............................................*..................
        // gap                                   // ..................................................................
        mls v19.8H, v17.8H, v7.H[0]              // .................................................*................
        // gap                                   // ..................................................................
        add v20.8H, v11.8H, v3.8H                // .......................................................*..........
        // gap                                   // ..................................................................
        mls v2.8H, v18.8H, v7.H[0]               // ..............................................*...................
        // gap                                   // ..................................................................
        sub v5.8H, v11.8H, v3.8H                 // ......................................................*...........
        // gap                                   // ..................................................................
        str_vi v20, x0, 16                       // ..........................................................*.......
        // gap                                   // ..................................................................
        add v23.8H, v8.8H, v19.8H                // .........................................................*........
        // gap                                   // ..................................................................
        str_vo v5, x0, 48                        // ...........................................................*......
        // gap                                   // ..................................................................
        sub v19.8H, v8.8H, v19.8H                // ........................................................*.........
        // gap                                   // ..................................................................
        str_vo v23, x0, 112                      // ............................................................*.....
        // gap                                   // ..................................................................
        add v14.8H, v16.8H, v2.8H                // .....................................................*............
        // gap                                   // ..................................................................
        str_vo v19, x0, 176                      // .............................................................*....
        // gap                                   // ..................................................................
        sub v23.8H, v16.8H, v2.8H                // ..................................................*...............
        // gap                                   // ..................................................................
        str_vo v14, x0, 240                      // ..............................................................*...
        // gap                                   // ..................................................................
        add v19.8H, v9.8H, v6.8H                 // ....................................................*.............
        // gap                                   // ..................................................................
        str_vo v23, x0, 304                      // ...............................................................*..
        // gap                                   // ..................................................................
        sub v20.8H, v9.8H, v6.8H                 // ...................................................*..............
        // gap                                   // ..................................................................
        str_vo v19, x0, 368                      // ................................................................*.
        // gap                                   // ..................................................................
        // gap                                   // ..................................................................
        // gap                                   // ..................................................................
        str_vo v20, x0, 432                      // .................................................................*
        // gap                                   // ..................................................................
        
        // original source code
        // mul v20.8H, v20.8H, v0.H[0]           // .*................................................................ || .*.................................................................
        // mul v13.8H, v6.8H, v0.H[0]            // ..*............................................................... || ..*................................................................
        // sqrdmulh v9.8H, v6.8H, v0.H[1]        // ...*.............................................................. || ...*...............................................................
        // mul v10.8H, v25.8H, v0.H[0]           // .....*............................................................ || .....*.............................................................
        // mls v20.8H, v5.8H, v7.H[0]            // ............*..................................................... || ............*......................................................
        // sqrdmulh v6.8H, v25.8H, v0.H[1]       // ......*........................................................... || ......*............................................................
        // mls v13.8H, v9.8H, v7.H[0]            // .......*.......................................................... || .......*...........................................................
        // mul v9.8H, v26.8H, v0.H[0]            // *................................................................. || *..................................................................
        // sub v5.8H, v4.8H, v20.8H              // .................*................................................ || .................*.................................................
        // mls v10.8H, v6.8H, v7.H[0]            // ..........*....................................................... || ..........*........................................................
        // add v20.8H, v4.8H, v20.8H             // .....................*............................................ || .....................*.............................................
        // sub v6.8H, v12.8H, v13.8H             // .............*.................................................... || .............*.....................................................
        // add v13.8H, v12.8H, v13.8H            // ..............*................................................... || ..............*....................................................
        // sub v26.8H, v30.8H, v10.8H            // ...............*.................................................. || ...............*...................................................
        // add v10.8H, v30.8H, v10.8H            // ................*................................................. || ................*..................................................
        // mls v9.8H, v24.8H, v7.H[0]            // ....*............................................................. || ....*..............................................................
        // mul v30.8H, v26.8H, v0.H[4]           // .........................*........................................ || .........................*.........................................
        // sqrdmulh v26.8H, v26.8H, v0.H[5]      // ......................*........................................... || ......................*............................................
        // mul v4.8H, v10.8H, v0.H[2]            // ...................*.............................................. || ...................*...............................................
        // sub v12.8H, v18.8H, v9.8H             // .........*........................................................ || .........*.........................................................
        // add v9.8H, v18.8H, v9.8H              // ........*......................................................... || ........*..........................................................
        // mls v30.8H, v26.8H, v7.H[0]           // .............................*.................................... || .............................*.....................................
        // sqrdmulh v10.8H, v10.8H, v0.H[3]      // ....................*............................................. || ....................*..............................................
        // mul v26.8H, v12.8H, v0.H[4]           // ..................*............................................... || ..................*................................................
        // sqrdmulh v12.8H, v12.8H, v0.H[5]      // .......................*.......................................... || .......................*...........................................
        // sub v18.8H, v5.8H, v30.8H             // .................................*................................ || .................................*.................................
        // add v5.8H, v5.8H, v30.8H              // ....................................*............................. || ....................................*..............................
        // mls v4.8H, v10.8H, v7.H[0]            // ........................*......................................... || ........................*..........................................
        // mul v10.8H, v9.8H, v0.H[2]            // ...........*...................................................... || ...........*.......................................................
        // mls v26.8H, v12.8H, v7.H[0]           // ...........................*...................................... || ...........................*.......................................
        // sqrdmulh v9.8H, v9.8H, v0.H[3]        // ..........................*....................................... || ..........................*........................................
        // sub v30.8H, v20.8H, v4.8H             // ............................*..................................... || ............................*......................................
        // add v20.8H, v20.8H, v4.8H             // ...............................*.................................. || ...............................*...................................
        // sub v4.8H, v6.8H, v26.8H              // ................................*................................. || ................................*..................................
        // add v6.8H, v6.8H, v26.8H              // .....................................*............................ || .....................................*.............................
        // mls v10.8H, v9.8H, v7.H[0]            // ..............................*................................... || ..............................*....................................
        // mul v9.8H, v4.8H, v1.H[4]             // ......................................*........................... || ......................................*............................
        // mul v26.8H, v6.8H, v1.H[2]            // ..........................................*....................... || ..........................................*........................
        // sqrdmulh v6.8H, v6.8H, v1.H[3]        // ..............................................*................... || ..............................................*....................
        // sub v12.8H, v13.8H, v10.8H            // ...................................*.............................. || ...................................*...............................
        // add v13.8H, v13.8H, v10.8H            // ..................................*............................... || ..................................*................................
        // sqrdmulh v10.8H, v4.8H, v1.H[5]       // .......................................*.......................... || .......................................*...........................
        // mul v4.8H, v12.8H, v1.H[0]            // ............................................*..................... || ............................................*......................
        // mul v25.8H, v13.8H, v0.H[6]           // ........................................*......................... || ........................................*..........................
        // sqrdmulh v13.8H, v13.8H, v0.H[7]      // .........................................*........................ || .........................................*.........................
        // sqrdmulh v12.8H, v12.8H, v1.H[1]      // ...........................................*...................... || ...........................................*.......................
        // mls v26.8H, v6.8H, v7.H[0]            // ..................................................*............... || ..................................................*................
        // mls v9.8H, v10.8H, v7.H[0]            // ...............................................*.................. || ...............................................*...................
        // mls v25.8H, v13.8H, v7.H[0]           // .............................................*.................... || .............................................*.....................
        // mls v4.8H, v12.8H, v7.H[0]            // ................................................*................. || ................................................*..................
        // sub v13.8H, v5.8H, v26.8H             // ...........................................................*...... || ...........................................................*.......
        // sub v10.8H, v18.8H, v9.8H             // ...............................................................*.. || ...............................................................*...
        // add v9.8H, v18.8H, v9.8H              // .............................................................*.... || .............................................................*.....
        // add v6.8H, v5.8H, v26.8H              // .........................................................*........ || .........................................................*.........
        // sub v5.8H, v20.8H, v25.8H             // ...................................................*.............. || ...................................................*...............
        // add v20.8H, v20.8H, v25.8H            // .................................................*................ || .................................................*.................
        // sub v26.8H, v30.8H, v4.8H             // .......................................................*.......... || .......................................................*...........
        // add v30.8H, v30.8H, v4.8H             // .....................................................*............ || .....................................................*.............
        // str_vi v20, x0, 16                    // ....................................................*............. || ....................................................*..............
        // str_vo v5, x0, 48                     // ......................................................*........... || ......................................................*............
        // str_vo v30, x0, 112                   // ........................................................*......... || ........................................................*..........
        // str_vo v26, x0, 176                   // ..........................................................*....... || ..........................................................*........
        // str_vo v6, x0, 240                    // ............................................................*..... || ............................................................*......
        // str_vo v13, x0, 304                   // ..............................................................*... || ..............................................................*....
        // str_vo v9, x0, 368                    // ................................................................*. || ................................................................*..
        // str_vo v10, x0, 432                   // .................................................................* || ..................................................................*
        

        restore inp, STACK0
        mov count, #8

        .p2align 2
        // gap                                   // ...........................................................................
        ldr_vi v3, x3, 16                        // ...*.......................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        ldr_vo v13, x1, 48                       // ..*........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        ldr_vo v17, x1, 32                       // ....*......................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        sqrdmulh v18.8H, v13.8H, v3.H[1]         // ......*....................................................................
        // gap                                   // ...........................................................................
        mul v9.8H, v13.8H, v3.H[0]               // .....*.....................................................................
        // gap                                   // ...........................................................................
        ldr_vo v20, x1, 16                       // .*.........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        sqrdmulh v15.8H, v17.8H, v3.H[1]         // ........*..................................................................
        // gap                                   // ...........................................................................
        mls v9.8H, v18.8H, v7.H[0]               // ..........*................................................................
        // gap                                   // ...........................................................................
        mul v23.8H, v17.8H, v3.H[0]              // .......*...................................................................
        // gap                                   // ...........................................................................
        ldr_vo v0, x1, 0                         // *..........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        sub v1.8H, v20.8H, v9.8H                 // ................*..........................................................
        // gap                                   // ...........................................................................
        mls v23.8H, v15.8H, v7.H[0]              // ...........*...............................................................
        // gap                                   // ...........................................................................
        add v8.8H, v20.8H, v9.8H                 // .............*.............................................................
        // gap                                   // ...........................................................................
        sqrdmulh v17.8H, v1.8H, v3.H[5]          // ....................*......................................................
        // gap                                   // ...........................................................................
        mul v13.8H, v1.8H, v3.H[4]               // ...................*.......................................................
        // gap                                   // ...........................................................................
        sub v19.8H, v0.8H, v23.8H                // ..............*............................................................
        // gap                                   // ...........................................................................
        sqrdmulh v16.8H, v8.8H, v3.H[3]          // ..................*........................................................
        // gap                                   // ...........................................................................
        mul v10.8H, v8.8H, v3.H[2]               // .................*.........................................................
        // gap                                   // ...........................................................................
        mls v13.8H, v17.8H, v7.H[0]              // .......................*...................................................
        // gap                                   // ...........................................................................
        ldr_vo v20, x4, 16                       // ............*..............................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        mls v10.8H, v16.8H, v7.H[0]              // ......................*....................................................
        // gap                                   // ...........................................................................
        add v17.8H, v0.8H, v23.8H                // ...............*...........................................................
        // gap                                   // ...........................................................................
        add v31.8H, v19.8H, v13.8H               // ............................*..............................................
        // gap                                   // ...........................................................................
        sub v3.8H, v19.8H, v13.8H                // ...........................*...............................................
        // gap                                   // ...........................................................................
        add v11.8H, v17.8H, v10.8H               // ..........................*................................................
        // gap                                   // ...........................................................................
        sub v21.8H, v17.8H, v10.8H               // .........................*.................................................
        // gap                                   // ...........................................................................
        trn2 v29.4S, v31.4S, v3.4S               // ...............................*...........................................
        // gap                                   // ...........................................................................
        trn1 v26.4S, v31.4S, v3.4S               // ..................................*........................................
        // gap                                   // ...........................................................................
        trn2 v9.4S, v11.4S, v21.4S               // ..............................*............................................
        // gap                                   // ...........................................................................
        ldr_vi v12, x4, 96                       // .........*.................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        trn2 v1.2D, v9.2D, v29.2D                // .................................*.........................................
        // gap                                   // ...........................................................................
        trn1 v22.4S, v11.4S, v21.4S              // .............................*.............................................
        // gap                                   // ...........................................................................
        mul v24.8H, v1.8H, v12.8H                // ...................................*.......................................
        // gap                                   // ...........................................................................
        sqrdmulh v17.8H, v1.8H, v20.8H           // ....................................*......................................
        // gap                                   // ...........................................................................
        trn2 v21.2D, v22.2D, v26.2D              // .....................................*.....................................
        // gap                                   // ...........................................................................
        trn1 v4.2D, v9.2D, v29.2D                // ......................................*....................................
        // gap                                   // ...........................................................................
        sqrdmulh v16.8H, v21.8H, v20.8H          // .......................................*...................................
        // gap                                   // ...........................................................................
        mls v24.8H, v17.8H, v7.H[0]              // ........................................*..................................
        // gap                                   // ...........................................................................
        mul v23.8H, v21.8H, v12.8H               // .........................................*.................................
        // gap                                   // ...........................................................................
        ldr_vo v20, x4, -64                      // .....................*.....................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        add v5.8H, v4.8H, v24.8H                 // .............................................*.............................
        // gap                                   // ...........................................................................
        mls v23.8H, v16.8H, v7.H[0]              // ............................................*..............................
        // gap                                   // ...........................................................................
        sub v10.8H, v4.8H, v24.8H                // ...........................................*...............................
        // gap                                   // ...........................................................................
        mul v9.8H, v5.8H, v20.8H                 // ................................................*..........................
        // gap                                   // ...........................................................................
        ldr_vo v20, x4, -48                      // ........................*..................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        ldr_vo v21, x4, -32                      // ................................*..........................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        sqrdmulh v17.8H, v5.8H, v20.8H           // .................................................*.........................
        // gap                                   // ...........................................................................
        trn1 v15.2D, v22.2D, v26.2D              // ..................................................*........................
        // gap                                   // ...........................................................................
        ldr_vo v20, x4, -16                      // ..........................................*................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        // gap                                   // ...........................................................................
        mls v9.8H, v17.8H, v7.H[0]               // .....................................................*.....................
        // gap                                   // ...........................................................................
        add v26.8H, v15.8H, v23.8H               // ......................................................*....................
        // gap                                   // ...........................................................................
        mul v6.8H, v10.8H, v21.8H                // ..............................................*............................
        // gap                                   // ...........................................................................
        sqrdmulh v30.8H, v10.8H, v20.8H          // ...............................................*...........................
        // gap                                   // ...........................................................................
        sub v13.8H, v26.8H, v9.8H                // .........................................................*.................
        // gap                                   // ...........................................................................
        add v20.8H, v26.8H, v9.8H                // ..........................................................*................
        // gap                                   // ...........................................................................
        sub v10.8H, v15.8H, v23.8H               // ....................................................*......................
        // gap                                   // ...........................................................................
        mls v6.8H, v30.8H, v7.H[0]               // ...................................................*.......................
        // gap                                   // ...........................................................................
        trn1 v9.4S, v20.4S, v13.4S               // .............................................................*.............
        // gap                                   // ...........................................................................
        trn2 v20.4S, v20.4S, v13.4S              // ..............................................................*............
        // gap                                   // ...........................................................................
        sqdmulh v17.8H, v9.8H, v7.H[1]           // ...............................................................*...........
        // gap                                   // ...........................................................................
        sub v5.8H, v10.8H, v6.8H                 // .......................................................*...................
        // gap                                   // ...........................................................................
        add v6.8H, v10.8H, v6.8H                 // ........................................................*..................
        // gap                                   // ...........................................................................
        sqdmulh v26.8H, v20.8H, v7.H[1]          // ................................................................*..........
        // gap                                   // ...........................................................................
        srshr v29.8H, v17.8H, #11                // ...................................................................*.......
        // gap                                   // ...........................................................................
        trn1 v10.4S, v6.4S, v5.4S                // ...........................................................*...............
        // gap                                   // ...........................................................................
        trn2 v13.4S, v6.4S, v5.4S                // ............................................................*..............
        // gap                                   // ...........................................................................
        sqdmulh v0.8H, v10.8H, v7.H[1]           // .................................................................*.........
        // gap                                   // ...........................................................................
        sqdmulh v5.8H, v13.8H, v7.H[1]           // ..................................................................*........
        // gap                                   // ...........................................................................
        mls v9.8H, v29.8H, v7.H[0]               // ......................................................................*....
        // gap                                   // ...........................................................................
        srshr v3.8H, v26.8H, #11                 // ....................................................................*......
        // gap                                   // ...........................................................................
        srshr v6.8H, v0.8H, #11                  // .....................................................................*.....
        // gap                                   // ...........................................................................
        srshr v16.8H, v5.8H, #11                 // .......................................................................*...
        // gap                                   // ...........................................................................
        mls v20.8H, v3.8H, v7.H[0]               // ........................................................................*..
        // gap                                   // ...........................................................................
        mls v10.8H, v6.8H, v7.H[0]               // .........................................................................*.
        // gap                                   // ...........................................................................
        mls v13.8H, v16.8H, v7.H[0]              // ..........................................................................*
        // gap                                   // ...........................................................................
        
        // original source code
        // ldr_vo v20, x1, 0                      // .........*................................................................. || .............*........................................................................
        // ldr_vo v13, x1, 16                     // .....*..................................................................... || ........*.............................................................................
        // ldr_vo v9, x1, 48                      // .*......................................................................... || ..*...................................................................................
        // ldr_vi v10, x3, 16                     // *.......................................................................... || *.....................................................................................
        // ldr_vo v6, x1, 32                      // ..*........................................................................ || ....*.................................................................................
        // mul v5.8H, v9.8H, v10.H[0]             // ....*...................................................................... || .......*..............................................................................
        // sqrdmulh v9.8H, v9.8H, v10.H[1]        // ...*....................................................................... || ......*...............................................................................
        // mul v0.8H, v6.8H, v10.H[0]             // ........*.................................................................. || ............*.........................................................................
        // sqrdmulh v6.8H, v6.8H, v10.H[1]        // ......*.................................................................... || ..........*...........................................................................
        // ldr_vi v26, x4, 96                     // .............................*............................................. || ...................................*..................................................
        // mls v5.8H, v9.8H, v7.H[0]              // .......*................................................................... || ...........*..........................................................................
        // mls v0.8H, v6.8H, v7.H[0]              // ...........*............................................................... || ................*.....................................................................
        // ldr_vo v9, x4, -80                     // ...................*....................................................... || ........................*.............................................................
        // add v6.8H, v13.8H, v5.8H               // ............*.............................................................. || .................*....................................................................
        // sub v30.8H, v20.8H, v0.8H              // ...............*........................................................... || ....................*.................................................................
        // add v20.8H, v20.8H, v0.8H              // .....................*..................................................... || ...........................*..........................................................
        // sub v13.8H, v13.8H, v5.8H              // ..........*................................................................ || ...............*......................................................................
        // mul v5.8H, v6.8H, v10.H[2]             // .................*......................................................... || ......................*...............................................................
        // sqrdmulh v6.8H, v6.8H, v10.H[3]        // ................*.......................................................... || .....................*................................................................
        // mul v0.8H, v13.8H, v10.H[4]            // ..............*............................................................ || ...................*..................................................................
        // sqrdmulh v13.8H, v13.8H, v10.H[5]      // .............*............................................................. || ..................*...................................................................
        // ldr_vo v10, x4, -64                    // .......................................*................................... || ..............................................*.......................................
        // mls v5.8H, v6.8H, v7.H[0]              // ....................*...................................................... || ..........................*...........................................................
        // mls v0.8H, v13.8H, v7.H[0]             // ..................*........................................................ || .......................*..............................................................
        // ldr_vo v13, x4, -48                    // ............................................*.............................. || ....................................................*.................................
        // sub v6.8H, v20.8H, v5.8H               // .........................*................................................. || ...............................*......................................................
        // add v20.8H, v20.8H, v5.8H              // ........................*.................................................. || ..............................*.......................................................
        // sub v5.8H, v30.8H, v0.8H               // .......................*................................................... || .............................*........................................................
        // add v0.8H, v30.8H, v0.8H               // ......................*.................................................... || ............................*.........................................................
        // trn1 v30.4S, v20.4S, v6.4S             // ...............................*........................................... || ......................................*...............................................
        // trn2 v20.4S, v20.4S, v6.4S             // ............................*.............................................. || ..................................*...................................................
        // trn2 v6.4S, v0.4S, v5.4S               // ..........................*................................................ || ................................*.....................................................
        // ldr_vo v4, x4, -32                     // .............................................*............................. || ......................................................*...............................
        // trn2 v12.2D, v20.2D, v6.2D             // ..............................*............................................ || .....................................*................................................
        // trn1 v5.4S, v0.4S, v5.4S               // ...........................*............................................... || .................................*....................................................
        // mul v0.8H, v12.8H, v26.8H              // ................................*.......................................... || .......................................*..............................................
        // sqrdmulh v12.8H, v12.8H, v9.8H         // .................................*......................................... || ........................................*.............................................
        // trn2 v18.2D, v30.2D, v5.2D             // ..................................*........................................ || .........................................*............................................
        // trn1 v20.2D, v20.2D, v6.2D             // ...................................*....................................... || ..........................................*...........................................
        // sqrdmulh v9.8H, v18.8H, v9.8H          // ....................................*...................................... || ...........................................*..........................................
        // mls v0.8H, v12.8H, v7.H[0]             // .....................................*..................................... || ............................................*.........................................
        // mul v6.8H, v18.8H, v26.8H              // ......................................*.................................... || .............................................*........................................
        // ldr_vo v26, x4, -16                    // ................................................*.......................... || ..........................................................*...........................
        // sub v12.8H, v20.8H, v0.8H              // ..........................................*................................ || ..................................................*...................................
        // mls v6.8H, v9.8H, v7.H[0]              // .........................................*................................. || .................................................*....................................
        // add v20.8H, v20.8H, v0.8H              // ........................................*.................................. || ................................................*.....................................
        // mul v9.8H, v12.8H, v4.8H               // ...................................................*....................... || ..............................................................*.......................
        // sqrdmulh v0.8H, v12.8H, v26.8H         // ....................................................*...................... || ...............................................................*......................
        // mul v10.8H, v20.8H, v10.8H             // ...........................................*............................... || ...................................................*..................................
        // sqrdmulh v20.8H, v20.8H, v13.8H        // ..............................................*............................ || ........................................................*.............................
        // trn1 v13.2D, v30.2D, v5.2D             // ...............................................*........................... || .........................................................*............................
        // mls v9.8H, v0.8H, v7.H[0]              // ........................................................*.................. || ...................................................................*..................
        // sub v5.8H, v13.8H, v6.8H               // .......................................................*................... || ..................................................................*...................
        // mls v10.8H, v20.8H, v7.H[0]            // .................................................*......................... || ............................................................*.........................
        // add v20.8H, v13.8H, v6.8H              // ..................................................*........................ || .............................................................*........................
        // sub v13.8H, v5.8H, v9.8H               // ............................................................*.............. || .......................................................................*..............
        // add v9.8H, v5.8H, v9.8H                // .............................................................*............. || ........................................................................*.............
        // sub v6.8H, v20.8H, v10.8H              // .....................................................*..................... || ................................................................*.....................
        // add v20.8H, v20.8H, v10.8H             // ......................................................*.................... || .................................................................*....................
        // trn1 v10.4S, v9.4S, v13.4S             // ................................................................*.......... || ...........................................................................*..........
        // trn2 v13.4S, v9.4S, v13.4S             // .................................................................*......... || ............................................................................*.........
        // trn1 v9.4S, v20.4S, v6.4S              // .........................................................*................. || ....................................................................*.................
        // trn2 v20.4S, v20.4S, v6.4S             // ..........................................................*................ || .....................................................................*................
        // sqdmulh v6.8H, v9.8H, v7.H[1]          // ...........................................................*............... || ......................................................................*...............
        // sqdmulh v5.8H, v20.8H, v7.H[1]         // ..............................................................*............ || .........................................................................*............
        // sqdmulh v0.8H, v10.8H, v7.H[1]         // ..................................................................*........ || .............................................................................*........
        // sqdmulh v26.8H, v13.8H, v7.H[1]        // ...................................................................*....... || ..............................................................................*.......
        // srshr v6.8H, v6.8H, #11                // ...............................................................*........... || ..........................................................................*...........
        // srshr v5.8H, v5.8H, #11                // .....................................................................*..... || ................................................................................*.....
        // srshr v0.8H, v0.8H, #11                // ......................................................................*.... || .................................................................................*....
        // mls v9.8H, v6.8H, v7.H[0]              // ....................................................................*...... || ...............................................................................*......
        // srshr v6.8H, v26.8H, #11               // .......................................................................*... || ..................................................................................*...
        // mls v20.8H, v5.8H, v7.H[0]             // ........................................................................*.. || ...................................................................................*..
        // mls v10.8H, v0.8H, v7.H[0]             // .........................................................................*. || ....................................................................................*.
        // mls v13.8H, v6.8H, v7.H[0]             // ..........................................................................* || .....................................................................................*
        
        sub count, count, #1
.p2align 2
layer4567_start:
        vext x10, v9, 0                           // ...........................................................................*...............
        vext x11, v9, 1                           // ............................................................................*..............
        vext x12, v20, 0                          // .............................................................................*.............
        vext x13, v20, 1                          // ..............................................................................*............
        vext x14, v10, 0                          // ...............................................................................*...........
        vext x15, v10, 1                          // ................................................................................*..........
        vext x16, v13, 0                          // .................................................................................*.........
        vext x17, v13, 1                          // ..................................................................................*........
        ldr_vo v20, x1, 64                        // e..........................................................................................
        str x10, [x1] , #64                       // ...................................................................................*.......
        str x14, [x1, #-56]                       // ....................................................................................*......
        // gap                                    // ...........................................................................................
        ldr_vo v13, x1, 16                        // .e.........................................................................................
        str x12, [x1, #-48]                       // .....................................................................................*.....
        str x16, [x1, #-40]                       // ......................................................................................*....
        // gap                                    // ...........................................................................................
        ldr_vo v9, x1, 48                         // ...e.......................................................................................
        str x11, [x1, #-32]                       // .......................................................................................*...
        str x15, [x1, #-24]                       // ........................................................................................*..
        // gap                                    // ...........................................................................................
        ldr_vi v10, x3, 16                        // ....e......................................................................................
        str x13, [x1, #-16]                       // .........................................................................................*.
        str x17, [x1, #-8]                        // ..........................................................................................*
        // gap                                    // ...........................................................................................
        ldr_vo v6, x1, 32                         // ..e........................................................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        mul v5.8H, v9.8H, v10.H[0]                // ..........e................................................................................
        // gap                                    // ...........................................................................................
        sqrdmulh v9.8H, v9.8H, v10.H[1]           // ...........e...............................................................................
        // gap                                    // ...........................................................................................
        mul v0.8H, v6.8H, v10.H[0]                // .....e.....................................................................................
        // gap                                    // ...........................................................................................
        sqrdmulh v6.8H, v6.8H, v10.H[1]           // ......e....................................................................................
        // gap                                    // ...........................................................................................
        ldr_vi v26, x4, 96                        // .................................e.........................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        mls v5.8H, v9.8H, v7.H[0]                 // ............e..............................................................................
        // gap                                    // ...........................................................................................
        mls v0.8H, v6.8H, v7.H[0]                 // .......e...................................................................................
        // gap                                    // ...........................................................................................
        ldr_vo v9, x4, -80                        // ..................................e........................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        add v6.8H, v13.8H, v5.8H                  // ..............e............................................................................
        // gap                                    // ...........................................................................................
        sub v30.8H, v20.8H, v0.8H                 // ........e..................................................................................
        // gap                                    // ...........................................................................................
        add v20.8H, v20.8H, v0.8H                 // .........e.................................................................................
        // gap                                    // ...........................................................................................
        sub v13.8H, v13.8H, v5.8H                 // .............e.............................................................................
        // gap                                    // ...........................................................................................
        mul v5.8H, v6.8H, v10.H[2]                // ...............e...........................................................................
        // gap                                    // ...........................................................................................
        sqrdmulh v6.8H, v6.8H, v10.H[3]           // ................e..........................................................................
        // gap                                    // ...........................................................................................
        mul v0.8H, v13.8H, v10.H[4]               // ....................e......................................................................
        // gap                                    // ...........................................................................................
        sqrdmulh v13.8H, v13.8H, v10.H[5]         // .....................e.....................................................................
        // gap                                    // ...........................................................................................
        ldr_vo v10, x4, -64                       // ...................................e.......................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        mls v5.8H, v6.8H, v7.H[0]                 // .................e.........................................................................
        // gap                                    // ...........................................................................................
        mls v0.8H, v13.8H, v7.H[0]                // ......................e....................................................................
        // gap                                    // ...........................................................................................
        ldr_vo v13, x4, -48                       // ....................................e......................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        sub v6.8H, v20.8H, v5.8H                  // ..................e........................................................................
        // gap                                    // ...........................................................................................
        add v20.8H, v20.8H, v5.8H                 // ...................e.......................................................................
        // gap                                    // ...........................................................................................
        sub v5.8H, v30.8H, v0.8H                  // .......................e...................................................................
        // gap                                    // ...........................................................................................
        add v0.8H, v30.8H, v0.8H                  // ........................e..................................................................
        // gap                                    // ...........................................................................................
        trn1 v30.4S, v20.4S, v6.4S                // .........................e.................................................................
        // gap                                    // ...........................................................................................
        trn2 v20.4S, v20.4S, v6.4S                // ..........................e................................................................
        // gap                                    // ...........................................................................................
        trn2 v6.4S, v0.4S, v5.4S                  // ............................e..............................................................
        // gap                                    // ...........................................................................................
        ldr_vo v4, x4, -32                        // .....................................e.....................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        trn2 v12.2D, v20.2D, v6.2D                // ..............................e............................................................
        // gap                                    // ...........................................................................................
        trn1 v5.4S, v0.4S, v5.4S                  // ...........................e...............................................................
        // gap                                    // ...........................................................................................
        mul v0.8H, v12.8H, v26.8H                 // ............................................e..............................................
        // gap                                    // ...........................................................................................
        sqrdmulh v12.8H, v12.8H, v9.8H            // .............................................e.............................................
        // gap                                    // ...........................................................................................
        trn2 v18.2D, v30.2D, v5.2D                // .............................e.............................................................
        // gap                                    // ...........................................................................................
        trn1 v20.2D, v20.2D, v6.2D                // ................................e..........................................................
        // gap                                    // ...........................................................................................
        sqrdmulh v9.8H, v18.8H, v9.8H             // ........................................e..................................................
        // gap                                    // ...........................................................................................
        mls v0.8H, v12.8H, v7.H[0]                // ..............................................e............................................
        // gap                                    // ...........................................................................................
        mul v6.8H, v18.8H, v26.8H                 // .......................................e...................................................
        // gap                                    // ...........................................................................................
        ldr_vo v26, x4, -16                       // ......................................e....................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        // gap                                    // ...........................................................................................
        sub v12.8H, v20.8H, v0.8H                 // ...............................................e...........................................
        // gap                                    // ...........................................................................................
        mls v6.8H, v9.8H, v7.H[0]                 // .........................................e.................................................
        // gap                                    // ...........................................................................................
        add v20.8H, v20.8H, v0.8H                 // ................................................e..........................................
        // gap                                    // ...........................................................................................
        mul v9.8H, v12.8H, v4.8H                  // ......................................................e....................................
        // gap                                    // ...........................................................................................
        sqrdmulh v0.8H, v12.8H, v26.8H            // .......................................................e...................................
        // gap                                    // ...........................................................................................
        mul v10.8H, v20.8H, v10.8H                // .................................................e.........................................
        // gap                                    // ...........................................................................................
        sqrdmulh v20.8H, v20.8H, v13.8H           // ..................................................e........................................
        // gap                                    // ...........................................................................................
        trn1 v13.2D, v30.2D, v5.2D                // ...............................e...........................................................
        // gap                                    // ...........................................................................................
        mls v9.8H, v0.8H, v7.H[0]                 // ........................................................e..................................
        // gap                                    // ...........................................................................................
        sub v5.8H, v13.8H, v6.8H                  // ..........................................e................................................
        // gap                                    // ...........................................................................................
        mls v10.8H, v20.8H, v7.H[0]               // ...................................................e.......................................
        // gap                                    // ...........................................................................................
        add v20.8H, v13.8H, v6.8H                 // ...........................................e...............................................
        // gap                                    // ...........................................................................................
        sub v13.8H, v5.8H, v9.8H                  // .........................................................e.................................
        // gap                                    // ...........................................................................................
        add v9.8H, v5.8H, v9.8H                   // ..........................................................e................................
        // gap                                    // ...........................................................................................
        sub v6.8H, v20.8H, v10.8H                 // ....................................................e......................................
        // gap                                    // ...........................................................................................
        add v20.8H, v20.8H, v10.8H                // .....................................................e.....................................
        // gap                                    // ...........................................................................................
        trn1 v10.4S, v9.4S, v13.4S                // .............................................................e.............................
        // gap                                    // ...........................................................................................
        trn2 v13.4S, v9.4S, v13.4S                // ..............................................................e............................
        // gap                                    // ...........................................................................................
        trn1 v9.4S, v20.4S, v6.4S                 // ...........................................................e...............................
        // gap                                    // ...........................................................................................
        trn2 v20.4S, v20.4S, v6.4S                // ............................................................e..............................
        // gap                                    // ...........................................................................................
        sqdmulh v6.8H, v9.8H, v7.H[1]             // ...............................................................e...........................
        // gap                                    // ...........................................................................................
        sqdmulh v5.8H, v20.8H, v7.H[1]            // ..................................................................e........................
        // gap                                    // ...........................................................................................
        sqdmulh v0.8H, v10.8H, v7.H[1]            // .....................................................................e.....................
        // gap                                    // ...........................................................................................
        sqdmulh v26.8H, v13.8H, v7.H[1]           // ........................................................................e..................
        // gap                                    // ...........................................................................................
        srshr v6.8H, v6.8H, #11                   // ................................................................e..........................
        // gap                                    // ...........................................................................................
        srshr v5.8H, v5.8H, #11                   // ...................................................................e.......................
        // gap                                    // ...........................................................................................
        srshr v0.8H, v0.8H, #11                   // ......................................................................e....................
        // gap                                    // ...........................................................................................
        mls v9.8H, v6.8H, v7.H[0]                 // .................................................................e.........................
        // gap                                    // ...........................................................................................
        srshr v6.8H, v26.8H, #11                  // .........................................................................e.................
        // gap                                    // ...........................................................................................
        mls v20.8H, v5.8H, v7.H[0]                // ....................................................................e......................
        // gap                                    // ...........................................................................................
        mls v10.8H, v0.8H, v7.H[0]                // .......................................................................e...................
        // gap                                    // ...........................................................................................
        mls v13.8H, v6.8H, v7.H[0]                // ..........................................................................e................
        // gap                                    // ...........................................................................................
        
        // original source code
        // ldr_vo v8, x1, 0                      // e...................................................................................................... || e.................................................................................................
        // ldr_vo v9, x1, 16                     // ...e................................................................................................... || ..e...............................................................................................
        // ldr_vo v10, x1, 32                    // ............e.......................................................................................... || ........e.........................................................................................
        // ldr_vo v11, x1, 48                    // ......e................................................................................................ || ....e.............................................................................................
        // ldr_vi v0, x3, 16                     // .........e............................................................................................. || ......e...........................................................................................
        // mul v24.8H, v10.8H, v0.H[0]           // ...............e....................................................................................... || ............e.....................................................................................
        // sqrdmulh v10.8H, v10.8H, v0.H[1]      // ................e...................................................................................... || .............e....................................................................................
        // mls v24.8H, v10.8H, v7.H[0]           // ...................e................................................................................... || .................e................................................................................
        // sub v10.8H, v8.8H, v24.8H             // ......................e................................................................................ || .....................e............................................................................
        // add v8.8H, v8.8H, v24.8H              // .......................e............................................................................... || ......................e...........................................................................
        // mul v24.8H, v11.8H, v0.H[0]           // .............e......................................................................................... || ..........e.......................................................................................
        // sqrdmulh v11.8H, v11.8H, v0.H[1]      // ..............e........................................................................................ || ...........e......................................................................................
        // mls v24.8H, v11.8H, v7.H[0]           // ..................e.................................................................................... || ................e.................................................................................
        // sub v11.8H, v9.8H, v24.8H             // ........................e.............................................................................. || .......................e..........................................................................
        // add v9.8H, v9.8H, v24.8H              // .....................e................................................................................. || ....................e.............................................................................
        // mul v24.8H, v9.8H, v0.H[2]            // .........................e............................................................................. || ........................e.........................................................................
        // sqrdmulh v9.8H, v9.8H, v0.H[3]        // ..........................e............................................................................ || .........................e........................................................................
        // mls v24.8H, v9.8H, v7.H[0]            // ..............................e........................................................................ || ..............................e...................................................................
        // sub v9.8H, v8.8H, v24.8H              // .................................e..................................................................... || ..................................e...............................................................
        // add v8.8H, v8.8H, v24.8H              // ..................................e.................................................................... || ...................................e..............................................................
        // mul v24.8H, v11.8H, v0.H[4]           // ...........................e........................................................................... || ..........................e.......................................................................
        // sqrdmulh v11.8H, v11.8H, v0.H[5]      // ............................e.......................................................................... || ...........................e......................................................................
        // mls v24.8H, v11.8H, v7.H[0]           // ...............................e....................................................................... || ...............................e..................................................................
        // sub v11.8H, v10.8H, v24.8H            // ...................................e................................................................... || ....................................e.............................................................
        // add v10.8H, v10.8H, v24.8H            // ....................................e.................................................................. || .....................................e............................................................
        // trn1 v25.4S, v8.4S, v9.4S             // .....................................e................................................................. || ......................................e...........................................................
        // trn2 v26.4S, v8.4S, v9.4S             // ......................................e................................................................ || .......................................e..........................................................
        // trn1 v27.4S, v10.4S, v11.4S           // ..........................................e............................................................ || ............................................e.....................................................
        // trn2 v28.4S, v10.4S, v11.4S           // .......................................e............................................................... || ........................................e.........................................................
        // trn2 v10.2D, v25.2D, v27.2D           // .............................................e......................................................... || ...............................................e..................................................
        // trn2 v11.2D, v26.2D, v28.2D           // .........................................e............................................................. || ...........................................e......................................................
        // trn1 v8.2D, v25.2D, v27.2D            // ..........................................................e............................................ || .............................................................e....................................
        // trn1 v9.2D, v26.2D, v28.2D            // ..............................................e........................................................ || ................................................e.................................................
        // ldr_vi v0, x4, 96                     // .................e..................................................................................... || ..............e...................................................................................
        // ldr_vo v4, x4, -80                    // ....................e.................................................................................. || ..................e...............................................................................
        // ldr_vo v1, x4, -64                    // .............................e......................................................................... || ............................e.....................................................................
        // ldr_vo v5, x4, -48                    // ................................e...................................................................... || ................................e.................................................................
        // ldr_vo v2, x4, -32                    // ........................................e.............................................................. || .........................................e........................................................
        // ldr_vo v6, x4, -16                    // ..................................................e.................................................... || ....................................................e.............................................
        // mul v24.8H, v10.8H, v0.8H             // .................................................e..................................................... || ...................................................e..............................................
        // sqrdmulh v10.8H, v10.8H, v4.8H        // ...............................................e....................................................... || .................................................e................................................
        // mls v24.8H, v10.8H, v7.H[0]           // ....................................................e.................................................. || .......................................................e..........................................
        // sub v10.8H, v8.8H, v24.8H             // ............................................................e.......................................... || ...............................................................e..................................
        // add v8.8H, v8.8H, v24.8H              // ..............................................................e........................................ || .................................................................e................................
        // mul v24.8H, v11.8H, v0.8H             // ...........................................e........................................................... || .............................................e....................................................
        // sqrdmulh v11.8H, v11.8H, v4.8H        // ............................................e.......................................................... || ..............................................e...................................................
        // mls v24.8H, v11.8H, v7.H[0]           // ................................................e...................................................... || ..................................................e...............................................
        // sub v11.8H, v9.8H, v24.8H             // ...................................................e................................................... || ......................................................e...........................................
        // add v9.8H, v9.8H, v24.8H              // .....................................................e................................................. || ........................................................e.........................................
        // mul v24.8H, v9.8H, v1.8H              // ........................................................e.............................................. || ...........................................................e......................................
        // sqrdmulh v9.8H, v9.8H, v5.8H          // .........................................................e............................................. || ............................................................e.....................................
        // mls v24.8H, v9.8H, v7.H[0]            // .............................................................e......................................... || ................................................................e.................................
        // sub v9.8H, v8.8H, v24.8H              // .................................................................e..................................... || ....................................................................e.............................
        // add v8.8H, v8.8H, v24.8H              // ..................................................................e.................................... || .....................................................................e............................
        // mul v24.8H, v11.8H, v2.8H             // ......................................................e................................................ || .........................................................e........................................
        // sqrdmulh v11.8H, v11.8H, v6.8H        // .......................................................e............................................... || ..........................................................e.......................................
        // mls v24.8H, v11.8H, v7.H[0]           // ...........................................................e........................................... || ..............................................................e...................................
        // sub v11.8H, v10.8H, v24.8H            // ...............................................................e....................................... || ..................................................................e...............................
        // add v10.8H, v10.8H, v24.8H            // ................................................................e...................................... || ...................................................................e..............................
        // trn1 v25.4S, v8.4S, v9.4S             // .....................................................................e................................. || ........................................................................e.........................
        // trn2 v26.4S, v8.4S, v9.4S             // ......................................................................e................................ || .........................................................................e........................
        // trn1 v27.4S, v10.4S, v11.4S           // ...................................................................e................................... || ......................................................................e...........................
        // trn2 v28.4S, v10.4S, v11.4S           // ....................................................................e.................................. || .......................................................................e..........................
        // sqdmulh v24.8H, v25.8H, v7.H[1]       // .......................................................................e............................... || ..........................................................................e.......................
        // srshr v24.8H, v24.8H, #11             // ...........................................................................e........................... || ..............................................................................e...................
        // mls v25.8H, v24.8H, v7.H[0]           // ..............................................................................e........................ || .................................................................................e................
        // sqdmulh v24.8H, v26.8H, v7.H[1]       // ........................................................................e.............................. || ...........................................................................e......................
        // srshr v24.8H, v24.8H, #11             // ............................................................................e.......................... || ...............................................................................e..................
        // mls v26.8H, v24.8H, v7.H[0]           // ................................................................................e...................... || ...................................................................................e..............
        // sqdmulh v24.8H, v27.8H, v7.H[1]       // .........................................................................e............................. || ............................................................................e.....................
        // srshr v24.8H, v24.8H, #11             // .............................................................................e......................... || ................................................................................e.................
        // mls v27.8H, v24.8H, v7.H[0]           // .................................................................................e..................... || ....................................................................................e.............
        // sqdmulh v24.8H, v28.8H, v7.H[1]       // ..........................................................................e............................ || .............................................................................e....................
        // srshr v24.8H, v24.8H, #11             // ...............................................................................e....................... || ..................................................................................e...............
        // mls v28.8H, v24.8H, v7.H[0]           // ..................................................................................e.................... || .....................................................................................e............
        // vext x10, v25, 0                      // ...................................................................................*................... || ......................................................................................*...........
        // vext x11, v25, 1                      // ....................................................................................*.................. || ......................................................................................*...........
        // vext x12, v26, 0                      // .....................................................................................*................. || .......................................................................................*..........
        // vext x13, v26, 1                      // ......................................................................................*................ || .......................................................................................*..........
        // vext x14, v27, 0                      // .......................................................................................*............... || ........................................................................................*.........
        // vext x15, v27, 1                      // ........................................................................................*.............. || ........................................................................................*.........
        // vext x16, v28, 0                      // .........................................................................................*............. || .........................................................................................*........
        // vext x17, v28, 1                      // ..........................................................................................*............ || .........................................................................................*........
        // str x10, [x1] , #64                   // ............................................................................................*.......... || ..........................................................................................*.......
        // str x14, [x1, #-56]                   // .............................................................................................*......... || ...........................................................................................*......
        // str x12, [x1, #-48]                   // ...............................................................................................*....... || ............................................................................................*.....
        // str x16, [x1, #-40]                   // ................................................................................................*...... || .............................................................................................*....
        // str x11, [x1, #-32]                   // ..................................................................................................*.... || ..............................................................................................*...
        // str x15, [x1, #-24]                   // ...................................................................................................*... || ...............................................................................................*..
        // str x13, [x1, #-16]                   // .....................................................................................................*. || ................................................................................................*.
        // str x17, [x1, #-8]                    // ......................................................................................................* || .................................................................................................*
        
        subs count, count, #1
        cbnz count, layer4567_start
        vext x10, v9, 0              // *...............
        // gap                       // ................
        vext x11, v9, 1              // .*..............
        // gap                       // ................
        vext x12, v20, 0             // ..*.............
        str x10, [x1] , #64          // ........*.......
        vext x13, v20, 1             // ...*............
        str x11, [x1, #-32]          // ............*...
        vext x14, v10, 0             // ....*...........
        str x12, [x1, #-48]          // ..........*.....
        vext x15, v10, 1             // .....*..........
        str x13, [x1, #-16]          // ..............*.
        vext x16, v13, 0             // ......*.........
        str x14, [x1, #-56]          // .........*......
        vext x17, v13, 1             // .......*........
        str x15, [x1, #-24]          // .............*..
        str x16, [x1, #-40]          // ...........*....
        // gap                       // ................
        str x17, [x1, #-8]           // ...............*
        // gap                       // ................
        
        // original source code
        // vext x10, v9, 0           // *............... || *.........
        // vext x11, v9, 1           // .*.............. || .*........
        // vext x12, v20, 0          // ..*............. || ..*.......
        // vext x13, v20, 1          // ....*........... || ...*......
        // vext x14, v10, 0          // ......*......... || ....*.....
        // vext x15, v10, 1          // ........*....... || .....*....
        // vext x16, v13, 0          // ..........*..... || ......*...
        // vext x17, v13, 1          // ............*... || .......*..
        // str x10, [x1] , #64       // ...*............ || ..*.......
        // str x14, [x1, #-56]       // ...........*.... || ......*...
        // str x12, [x1, #-48]       // .......*........ || ....*.....
        // str x16, [x1, #-40]       // ..............*. || ........*.
        // str x11, [x1, #-32]       // .....*.......... || ...*......
        // str x15, [x1, #-24]       // .............*.. || .......*..
        // str x13, [x1, #-16]       // .........*...... || .....*....
        // str x17, [x1, #-8]        // ...............* || .........*
        

       pop_stack
       ret