/// Copyright (c) 2024 Jipeng Zhang (jp-zhang@outlook.com) (Original Code)
/// Copyright (c) 2026 Amin Abdulrahman (amin@abdulrahman.de) (Modifications)
/// Copyright (c) 2026 Justus Bergermann (mail@justus-bergermann.de) (Modifications)
///
/// SPDX-License-Identifier: MIT
///
/// Permission is hereby granted, free of charge, to any person obtaining a copy
/// of this software and associated documentation files (the "Software"), to deal
/// in the Software without restriction, including without limitation the rights
/// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
/// copies of the Software, and to permit persons to whom the Software is
/// furnished to do so, subject to the following conditions:
///
/// The above copyright notice and this permission notice shall be included in all
/// copies or substantial portions of the Software.
///
/// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
/// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
/// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
/// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
/// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
/// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
/// SOFTWARE.

# Plantard based NTT implementation with l=16

.macro load_coeffs poly, len, wordLen
  lh s0,  \len*\wordLen*0(\poly)
  lh s1,  \len*\wordLen*1(\poly)
  lh s2,  \len*\wordLen*2(\poly)
  lh s3,  \len*\wordLen*3(\poly)
  lh s4,  \len*\wordLen*4(\poly)
  lh s5,  \len*\wordLen*5(\poly)
  lh s6,  \len*\wordLen*6(\poly)
  lh s7,  \len*\wordLen*7(\poly)
  lh s8,  \len*\wordLen*8(\poly)
  lh s9,  \len*\wordLen*9(\poly)
  lh s10, \len*\wordLen*10(\poly)
  lh s11, \len*\wordLen*11(\poly)
  lh a2,  \len*\wordLen*12(\poly)
  lh a3,  \len*\wordLen*13(\poly)
  lh a4,  \len*\wordLen*14(\poly)
  lh a5,  \len*\wordLen*15(\poly)
.endm

.macro store_coeffs poly, len, wordLen
  sh s0,  \len*\wordLen*0(\poly)
  sh s1,  \len*\wordLen*1(\poly)
  sh s2,  \len*\wordLen*2(\poly)
  sh s3,  \len*\wordLen*3(\poly)
  sh s4,  \len*\wordLen*4(\poly)
  sh s5,  \len*\wordLen*5(\poly)
  sh s6,  \len*\wordLen*6(\poly)
  sh s7,  \len*\wordLen*7(\poly)
  sh s8,  \len*\wordLen*8(\poly)
  sh s9,  \len*\wordLen*9(\poly)
  sh s10, \len*\wordLen*10(\poly)
  sh s11, \len*\wordLen*11(\poly)
  sh a2,  \len*\wordLen*12(\poly)
  sh a3,  \len*\wordLen*13(\poly)
  sh a4,  \len*\wordLen*14(\poly)
  sh a5,  \len*\wordLen*15(\poly)
.endm

.macro save_regs
  sd s0,  0*8(sp)
  sd s1,  1*8(sp)
  sd s2,  2*8(sp)
  sd s3,  3*8(sp)
  sd s4,  4*8(sp)
  sd s5,  5*8(sp)
  sd s6,  6*8(sp)
  sd s7,  7*8(sp)
  sd s8,  8*8(sp)
  sd s9,  9*8(sp)
  sd s10, 10*8(sp)
  sd s11, 11*8(sp)
  sd gp,  12*8(sp)
  sd tp,  13*8(sp)
  sd ra,  14*8(sp)
.endm

.macro restore_regs
  ld s0,  0*8(sp)
  ld s1,  1*8(sp)
  ld s2,  2*8(sp)
  ld s3,  3*8(sp)
  ld s4,  4*8(sp)
  ld s5,  5*8(sp)
  ld s6,  6*8(sp)
  ld s7,  7*8(sp)
  ld s8,  8*8(sp)
  ld s9,  9*8(sp)
  ld s10, 10*8(sp)
  ld s11, 11*8(sp)
  ld gp,  12*8(sp)
  ld tp,  13*8(sp)
  ld ra,  14*8(sp)
.endm

// a <- a*b*(-2^{-32}) mod+- q
// q48: q<<48; bqinv: b*qinv
.macro plant_mul_const_inplace q48, zeta, a
  mulw \a, \a, \zeta
  srai \a, \a, 16
  addi \a, \a, 8
  mulh \a, \a, \q48
.endm

.macro plant_mul_const_inplace_x2 q48, zeta, a_0, a_1
  mulw \a_0, \a_0, \zeta
  mulw \a_1, \a_1, \zeta
  srai \a_0, \a_0, 16
  srai \a_1, \a_1, 16
  addi \a_0, \a_0, 8
  addi \a_1, \a_1, 8
  mulh \a_0, \a_0, \q48
  mulh \a_1, \a_1, \q48
.endm

.macro plant_mul_const_inplace_x4 q48,   zeta_0, zeta_1, zeta_2, zeta_3,    a_0, a_1, a_2, a_3
  mulw \a_0, \a_0, \zeta_0
  mulw \a_1, \a_1, \zeta_1
  mulw \a_2, \a_2, \zeta_2
  mulw \a_3, \a_3, \zeta_3
  srai \a_0, \a_0, 16
  srai \a_1, \a_1, 16
  srai \a_2, \a_2, 16
  srai \a_3, \a_3, 16
  addi \a_0, \a_0, 8
  addi \a_1, \a_1, 8
  addi \a_2, \a_2, 8
  addi \a_3, \a_3, 8
  mulh \a_0, \a_0, \q48
  mulh \a_1, \a_1, \q48
  mulh \a_2, \a_2, \q48
  mulh \a_3, \a_3, \q48
.endm

// r <- a*b*(-2^{-32}) mod+- q
// q48: q<<48; zeta: b*qinv
.macro plant_mul_const q48, zeta, a, r
  mulw \r, \a, \zeta
  srai \r, \r, 16
  addi \r, \r, 8
  mulh \r, \r, \q48
.endm

.macro plant_mul_const_x2 q48, zeta_0, zeta_1, a_0, a_1, r_0, r_1
  mulw \r_0, \a_0, \zeta_0
  mulw \r_1, \a_1, \zeta_1
  srai \r_0, \r_0, 16
  srai \r_1, \r_1, 16
  addi \r_0, \r_0, 8
  addi \r_1, \r_1, 8
  mulh \r_0, \r_0, \q48
  mulh \r_1, \r_1, \q48
.endm

.macro plant_mul_const_x4    q48, zeta_0, zeta_1, zeta_2, zeta_3,      a_0, a_1, a_2, a_3,  r_0, r_1, r_2, r_3
  mulw \r_0, \a_0, \zeta_0
  mulw \r_1, \a_1, \zeta_1
  mulw \r_2, \a_2, \zeta_2
  mulw \r_3, \a_3, \zeta_3
  srai \r_0, \r_0, 16
  srai \r_1, \r_1, 16
  srai \r_2, \r_2, 16
  srai \r_3, \r_3, 16
  addi \r_0, \r_0, 8
  addi \r_1, \r_1, 8
  addi \r_2, \r_2, 8
  addi \r_3, \r_3, 8
  mulh \r_0, \r_0, \q48
  mulh \r_1, \r_1, \q48
  mulh \r_2, \r_2, \q48
  mulh \r_3, \r_3, \q48
.endm

// each layer increases coefficients by 0.5q; In ct_bfu, zeta and tmp can be reused because each zeta is only used once. The gs_bfu cannot.
# .macro ct_bfu a_0, a_1, zeta, q48, tmp
#   plant_mul_const \q48, \zeta, \a_1, \tmp
#   sub \a_1, \a_0, \tmp
#   add \a_0, \a_0, \tmp
# .endm
.macro ct_bfu a_0, a_1, zeta, q48, tmp
  mulw \tmp, \a_1, \zeta
  srai \tmp, \tmp, 16
  addi \tmp, \tmp, 8
  mulh \tmp, \tmp, \q48
  sub \a_1, \a_0, \tmp
  add \a_0, \a_0, \tmp
.endm

.macro ct_bfu_x2  a_0_0, a_0_1, a_1_0, a_1_1,  zeta_0, zeta_1,  q48,  t_0, t_1
  mulw  \t_0, \a_0_1, \zeta_0
  mulw  \t_1, \a_1_1, \zeta_1
  srai \t_0, \t_0, 16
  srai \t_1, \t_1, 16
  addi \t_0, \t_0, 8
  addi \t_1, \t_1, 8
  mulh \t_0, \t_0, \q48
  mulh \t_1, \t_1, \q48
  sub  \a_0_1, \a_0_0, \t_0
  sub  \a_1_1, \a_1_0, \t_1
  add  \a_0_0, \a_0_0, \t_0
  add  \a_1_0, \a_1_0, \t_1
.endm

.macro ct_bfu_x8  a_0_0, a_0_1, a_1_0, a_1_1,  a_2_0, a_2_1, a_3_0, a_3_1,  a_4_0, a_4_1, a_5_0, a_5_1,  a_6_0, a_6_1, a_7_0, a_7_1,  zeta_0, zeta_1,  zeta_2, zeta_3,  zeta_4, zeta_5,  zeta_6, zeta_7,  q48,  t_0, t_1, t_2, t_3
  mulw \t_0, \a_0_1, \zeta_0
  mulw \t_1, \a_1_1, \zeta_1
  mulw \t_2, \a_2_1, \zeta_2
  mulw \t_3, \a_3_1, \zeta_3
  srai \t_0, \t_0, 16
  srai \t_1, \t_1, 16
  addi \t_0, \t_0, 8
  addi \t_1, \t_1, 8
  mulh \t_0, \t_0, \q48
  mulh \t_1, \t_1, \q48
  srai \t_2, \t_2, 16
  srai \t_3, \t_3, 16
  addi \t_2, \t_2, 8
  addi \t_3, \t_3, 8
  mulh \t_2, \t_2, \q48
  mulh \t_3, \t_3, \q48
  sub  \a_0_1, \a_0_0, \t_0
  sub  \a_1_1, \a_1_0, \t_1
  add  \a_0_0, \a_0_0, \t_0
  add  \a_1_0, \a_1_0, \t_1
  mulw \t_0, \a_4_1, \zeta_4
  mulw \t_1, \a_5_1, \zeta_5
  sub  \a_2_1, \a_2_0, \t_2
  sub  \a_3_1, \a_3_0, \t_3
  add  \a_2_0, \a_2_0, \t_2
  add  \a_3_0, \a_3_0, \t_3
  mulw \t_2, \a_6_1, \zeta_6
  mulw \t_3, \a_7_1, \zeta_7
  srai \t_0, \t_0, 16
  srai \t_1, \t_1, 16
  addi \t_0, \t_0, 8
  addi \t_1, \t_1, 8
  mulh \t_0, \t_0, \q48
  mulh \t_1, \t_1, \q48
  srai \t_2, \t_2, 16
  srai \t_3, \t_3, 16
  addi \t_2, \t_2, 8
  addi \t_3, \t_3, 8
  mulh \t_2, \t_2, \q48
  mulh \t_3, \t_3, \q48
  sub  \a_4_1, \a_4_0, \t_0
  sub  \a_5_1, \a_5_0, \t_1
  add  \a_4_0, \a_4_0, \t_0
  add  \a_5_0, \a_5_0, \t_1
  sub  \a_6_1, \a_6_0, \t_2
  sub  \a_7_1, \a_7_0, \t_3
  add  \a_6_0, \a_6_0, \t_2
  add  \a_7_0, \a_7_0, \t_3
.endm

.macro ct_bfu_x8_loadzetas  a_0_0, a_0_1, a_1_0, a_1_1,  a_2_0, a_2_1, a_3_0, a_3_1,  a_4_0, a_4_1, a_5_0, a_5_1,  a_6_0, a_6_1, a_7_0, a_7_1,  zeta_0, zeta_1,  zeta_2, zeta_3,  zeta_4, zeta_5,  zeta_6, zeta_7,  q48,  t_0, t_1, t_2, t_3
  lw   \t_0, \zeta_0(a1)
  lw   \t_1, \zeta_1(a1)
  lw   \t_2, \zeta_2(a1)
  lw   \t_3, \zeta_3(a1)
  mulw \t_0, \a_0_1, \t_0
  mulw \t_1, \a_1_1, \t_1
  mulw \t_2, \a_2_1, \t_2
  mulw \t_3, \a_3_1, \t_3
  srai \t_0, \t_0, 16
  srai \t_1, \t_1, 16
  addi \t_0, \t_0, 8
  addi \t_1, \t_1, 8
  mulh \t_0, \t_0, \q48
  mulh \t_1, \t_1, \q48
  srai \t_2, \t_2, 16
  srai \t_3, \t_3, 16
  addi \t_2, \t_2, 8
  addi \t_3, \t_3, 8
  mulh \t_2, \t_2, \q48
  mulh \t_3, \t_3, \q48
  sub  \a_0_1, \a_0_0, \t_0
  sub  \a_1_1, \a_1_0, \t_1
  add  \a_0_0, \a_0_0, \t_0
  lw   \t_0, \zeta_4(a1)
  add  \a_1_0, \a_1_0, \t_1
  lw   \t_1, \zeta_5(a1)
  mulw \t_0, \a_4_1, \t_0
  mulw \t_1, \a_5_1, \t_1
  sub  \a_2_1, \a_2_0, \t_2
  sub  \a_3_1, \a_3_0, \t_3
  add  \a_2_0, \a_2_0, \t_2
  lw   \t_2, \zeta_6(a1)
  add  \a_3_0, \a_3_0, \t_3
  lw   \t_3, \zeta_7(a1)
  mulw \t_2, \a_6_1, \t_2
  mulw \t_3, \a_7_1, \t_3
  srai \t_0, \t_0, 16
  srai \t_1, \t_1, 16
  addi \t_0, \t_0, 8
  addi \t_1, \t_1, 8
  mulh \t_0, \t_0, \q48
  mulh \t_1, \t_1, \q48
  srai \t_2, \t_2, 16
  srai \t_3, \t_3, 16
  addi \t_2, \t_2, 8
  addi \t_3, \t_3, 8
  mulh \t_2, \t_2, \q48
  mulh \t_3, \t_3, \q48
  sub  \a_4_1, \a_4_0, \t_0
  sub  \a_5_1, \a_5_0, \t_1
  add  \a_4_0, \a_4_0, \t_0
  add  \a_5_0, \a_5_0, \t_1
  sub  \a_6_1, \a_6_0, \t_2
  sub  \a_7_1, \a_7_0, \t_3
  add  \a_6_0, \a_6_0, \t_2
  add  \a_7_0, \a_7_0, \t_3
.endm

.macro gs_bfu a_0, a_1, zeta, q48, tmp
  sub \tmp, \a_0, \a_1
  add \a_0, \a_0, \a_1
  mulw \a_1, \tmp, \zeta
  srai \a_1, \a_1, 16
  addi \a_1, \a_1, 8
  mulh \a_1, \a_1, \q48
.endm

.macro gs_bfu_x2 a_0_0, a_0_1, a_1_0, a_1_1,  zeta_0, zeta_1, q48, t_0, t_1
  sub \t_0, \a_0_0, \a_0_1
  sub \t_1, \a_1_0, \a_1_1
  add \a_0_0, \a_0_0, \a_0_1
  add \a_1_0, \a_1_0, \a_1_1
  mulw \a_0_1, \t_0, \zeta_0
  mulw \a_1_1, \t_1, \zeta_1
  srai \a_0_1, \a_0_1, 16
  srai \a_1_1, \a_1_1, 16
  addi \a_0_1, \a_0_1, 8
  addi \a_1_1, \a_1_1, 8
  mulh \a_0_1, \a_0_1, \q48
  mulh \a_1_1, \a_1_1, \q48
.endm

.macro gs_bfu_x8  a_0_0, a_0_1, a_1_0, a_1_1,  a_2_0, a_2_1, a_3_0, a_3_1,  a_4_0, a_4_1, a_5_0, a_5_1,  a_6_0, a_6_1, a_7_0, a_7_1,  zeta_0, zeta_1,  zeta_2, zeta_3,  zeta_4, zeta_5,  zeta_6, zeta_7,  q48, t_0, t_1, t_2, t_3
  sub \t_0, \a_0_0, \a_0_1
  sub \t_1, \a_1_0, \a_1_1
  add \a_0_0, \a_0_0, \a_0_1
  add \a_1_0, \a_1_0, \a_1_1
  mulw \a_0_1, \t_0, \zeta_0
  mulw \a_1_1, \t_1, \zeta_1
  sub \t_2, \a_2_0, \a_2_1
  sub \t_3, \a_3_0, \a_3_1
  add \a_2_0, \a_2_0, \a_2_1
  add \a_3_0, \a_3_0, \a_3_1
  mulw \a_2_1, \t_2, \zeta_2
  mulw \a_3_1, \t_3, \zeta_3
  srai \a_0_1, \a_0_1, 16
  srai \a_1_1, \a_1_1, 16
  addi \a_0_1, \a_0_1, 8
  addi \a_1_1, \a_1_1, 8
  mulh \a_0_1, \a_0_1, \q48
  mulh \a_1_1, \a_1_1, \q48
  srai \a_2_1, \a_2_1, 16
  srai \a_3_1, \a_3_1, 16
  addi \a_2_1, \a_2_1, 8
  addi \a_3_1, \a_3_1, 8
  mulh \a_2_1, \a_2_1, \q48
  mulh \a_3_1, \a_3_1, \q48
  sub \t_0, \a_4_0, \a_4_1
  sub \t_1, \a_5_0, \a_5_1
  add \a_4_0, \a_4_0, \a_4_1
  add \a_5_0, \a_5_0, \a_5_1
  mulw \a_4_1, \t_0, \zeta_4
  mulw \a_5_1, \t_1, \zeta_5
  sub \t_2, \a_6_0, \a_6_1
  sub \t_3, \a_7_0, \a_7_1
  add \a_6_0, \a_6_0, \a_6_1
  add \a_7_0, \a_7_0, \a_7_1
  mulw \a_6_1, \t_2, \zeta_6
  mulw \a_7_1, \t_3, \zeta_7
  srai \a_4_1, \a_4_1, 16
  srai \a_5_1, \a_5_1, 16
  addi \a_4_1, \a_4_1, 8
  addi \a_5_1, \a_5_1, 8
  mulh \a_4_1, \a_4_1, \q48
  mulh \a_5_1, \a_5_1, \q48
  srai \a_6_1, \a_6_1, 16
  srai \a_7_1, \a_7_1, 16
  addi \a_6_1, \a_6_1, 8
  addi \a_7_1, \a_7_1, 8
  mulh \a_6_1, \a_6_1, \q48
  mulh \a_7_1, \a_7_1, \q48
.endm

.macro gs_bfu_x8_load_4zetas  a_0_0, a_0_1, a_1_0, a_1_1,  a_2_0, a_2_1, a_3_0, a_3_1,  a_4_0, a_4_1, a_5_0, a_5_1,  a_6_0, a_6_1, a_7_0, a_7_1,  zeta_0, zeta_1,  zeta_2, zeta_3,  q48, t_0, t_1, t_2, t_3
  lw  \t_2, \zeta_0(a1)
  sub \t_0, \a_0_0, \a_0_1
  sub \t_1, \a_1_0, \a_1_1
  add \a_0_0, \a_0_0, \a_0_1
  add \a_1_0, \a_1_0, \a_1_1
  mulw \a_0_1, \t_0, \t_2
  mulw \a_1_1, \t_1, \t_2
  sub \t_0, \a_2_0, \a_2_1
  sub \t_3, \a_3_0, \a_3_1
  lw  \t_2, \zeta_1(a1)
  add \a_2_0, \a_2_0, \a_2_1
  add \a_3_0, \a_3_0, \a_3_1
  mulw \a_2_1, \t_0, \t_2
  mulw \a_3_1, \t_3, \t_2
  srai \a_0_1, \a_0_1, 16
  srai \a_1_1, \a_1_1, 16
  addi \a_0_1, \a_0_1, 8
  addi \a_1_1, \a_1_1, 8
  mulh \a_0_1, \a_0_1, \q48
  mulh \a_1_1, \a_1_1, \q48
  srai \a_2_1, \a_2_1, 16
  srai \a_3_1, \a_3_1, 16
  addi \a_2_1, \a_2_1, 8
  addi \a_3_1, \a_3_1, 8
  mulh \a_2_1, \a_2_1, \q48
  mulh \a_3_1, \a_3_1, \q48
  sub \t_0, \a_4_0, \a_4_1
  sub \t_1, \a_5_0, \a_5_1
  lw  \t_2, \zeta_2(a1)
  add \a_4_0, \a_4_0, \a_4_1
  add \a_5_0, \a_5_0, \a_5_1
  mulw \a_4_1, \t_0, \t_2
  mulw \a_5_1, \t_1, \t_2
  sub \t_0, \a_6_0, \a_6_1
  sub \t_3, \a_7_0, \a_7_1
  lw  \t_2, \zeta_3(a1)
  add \a_6_0, \a_6_0, \a_6_1
  add \a_7_0, \a_7_0, \a_7_1
  mulw \a_6_1, \t_0, \t_2
  mulw \a_7_1, \t_3, \t_2
  srai \a_4_1, \a_4_1, 16
  srai \a_5_1, \a_5_1, 16
  addi \a_4_1, \a_4_1, 8
  addi \a_5_1, \a_5_1, 8
  mulh \a_4_1, \a_4_1, \q48
  mulh \a_5_1, \a_5_1, \q48
  srai \a_6_1, \a_6_1, 16
  srai \a_7_1, \a_7_1, 16
  addi \a_6_1, \a_6_1, 8
  addi \a_7_1, \a_7_1, 8
  mulh \a_6_1, \a_6_1, \q48
  mulh \a_7_1, \a_7_1, \q48
.endm

.macro gs_bfu_x8_load_2zetas  a_0_0, a_0_1, a_1_0, a_1_1,  a_2_0, a_2_1, a_3_0, a_3_1,  a_4_0, a_4_1, a_5_0, a_5_1,  a_6_0, a_6_1, a_7_0, a_7_1,  zeta_0, zeta_1,  q48, t_0, t_1, t_2, t_3
  lw  \t_2, \zeta_0(a1)
  sub \t_0, \a_0_0, \a_0_1
  sub \t_1, \a_1_0, \a_1_1
  add \a_0_0, \a_0_0, \a_0_1
  add \a_1_0, \a_1_0, \a_1_1
  mulw \a_0_1, \t_0, \t_2
  mulw \a_1_1, \t_1, \t_2
  sub \t_0, \a_2_0, \a_2_1
  sub \t_3, \a_3_0, \a_3_1
  add \a_2_0, \a_2_0, \a_2_1
  add \a_3_0, \a_3_0, \a_3_1
  mulw \a_2_1, \t_0, \t_2
  mulw \a_3_1, \t_3, \t_2
  srai \a_0_1, \a_0_1, 16
  srai \a_1_1, \a_1_1, 16
  addi \a_0_1, \a_0_1, 8
  addi \a_1_1, \a_1_1, 8
  mulh \a_0_1, \a_0_1, \q48
  mulh \a_1_1, \a_1_1, \q48
  srai \a_2_1, \a_2_1, 16
  srai \a_3_1, \a_3_1, 16
  addi \a_2_1, \a_2_1, 8
  addi \a_3_1, \a_3_1, 8
  mulh \a_2_1, \a_2_1, \q48
  mulh \a_3_1, \a_3_1, \q48
  lw  \t_2, \zeta_1(a1)
  sub \t_0, \a_4_0, \a_4_1
  sub \t_1, \a_5_0, \a_5_1
  add \a_4_0, \a_4_0, \a_4_1
  add \a_5_0, \a_5_0, \a_5_1
  mulw \a_4_1, \t_0, \t_2
  mulw \a_5_1, \t_1, \t_2
  sub \t_0, \a_6_0, \a_6_1
  sub \t_3, \a_7_0, \a_7_1
  add \a_6_0, \a_6_0, \a_6_1
  add \a_7_0, \a_7_0, \a_7_1
  mulw \a_6_1, \t_0, \t_2
  mulw \a_7_1, \t_3, \t_2
  srai \a_4_1, \a_4_1, 16
  srai \a_5_1, \a_5_1, 16
  addi \a_4_1, \a_4_1, 8
  addi \a_5_1, \a_5_1, 8
  mulh \a_4_1, \a_4_1, \q48
  mulh \a_5_1, \a_5_1, \q48
  srai \a_6_1, \a_6_1, 16
  srai \a_7_1, \a_7_1, 16
  addi \a_6_1, \a_6_1, 8
  addi \a_7_1, \a_7_1, 8
  mulh \a_6_1, \a_6_1, \q48
  mulh \a_7_1, \a_7_1, \q48
.endm

.macro plant_mul_const_inplace_x8  q48, zeta,  a_0, a_1, a_2, a_3,  a_4, a_5, a_6, a_7
  mulw \a_0, \a_0, \zeta
  mulw \a_1, \a_1, \zeta
  mulw \a_2, \a_2, \zeta
  mulw \a_3, \a_3, \zeta
  srai \a_0, \a_0, 16
  srai \a_1, \a_1, 16
  addi \a_0, \a_0, 8
  addi \a_1, \a_1, 8
  mulh \a_0, \a_0, \q48
  mulh \a_1, \a_1, \q48
  srai \a_2, \a_2, 16
  srai \a_3, \a_3, 16
  mulw \a_4, \a_4, \zeta
  mulw \a_5, \a_5, \zeta
  addi \a_2, \a_2, 8
  addi \a_3, \a_3, 8
  mulh \a_2, \a_2, \q48
  mulh \a_3, \a_3, \q48
  srai \a_4, \a_4, 16
  srai \a_5, \a_5, 16
  mulw \a_6, \a_6, \zeta
  mulw \a_7, \a_7, \zeta
  addi \a_4, \a_4, 8
  addi \a_5, \a_5, 8
  mulh \a_4, \a_4, \q48
  mulh \a_5, \a_5, \q48
  srai \a_6, \a_6, 16
  addi \a_6, \a_6, 8
  mulh \a_6, \a_6, \q48
  srai \a_7, \a_7, 16
  addi \a_7, \a_7, 8
  mulh \a_7, \a_7, \q48
.endm

// in-place plantard reduction to a
// output \in (-0.5q, 0.5q); q48: q<<48
.macro plant_red q48, qinv, a
  mulw \a, \a, \qinv
  srai \a, \a, 16
  addi \a, \a, 8
  mulh \a, \a, \q48
.endm

.macro plant_red_x4  q48, qinv,   a_0, a_1, a_2, a_3
  mulw \a_0, \a_0, \qinv
  mulw \a_1, \a_1, \qinv
  mulw \a_2, \a_2, \qinv
  mulw \a_3, \a_3, \qinv
  srai \a_0, \a_0, 16
  srai \a_1, \a_1, 16
  srai \a_2, \a_2, 16
  srai \a_3, \a_3, 16
  addi \a_0, \a_0, 8
  addi \a_1, \a_1, 8
  addi \a_2, \a_2, 8
  addi \a_3, \a_3, 8
  mulh \a_0, \a_0, \q48
  mulh \a_1, \a_1, \q48
  mulh \a_2, \a_2, \q48
  mulh \a_3, \a_3, \q48
.endm

.equ q, 3329
.equ q48, 0xd01000000000000     // q<<48
.equ qinv, 0x6ba8f301           // q^-1 mod+- 2^32
.equ plantconst, 0x13afb8       // (-2^{32} mod q)*qinv mod 2^32
.equ plantconst2, 0x97f44fac    // (2^{64} mod q)*qinv mod 2^32

// |input| < 0.5q; |output| < 3.5q
// a0: poly, a1: 32-bit twiddle ptr; a6: q<<48;
// a7/gp/tp/ra: tmp;
// 8*15(sp): loop;
// s0-s11, a2-a5: 16 coeffs;
// 7 twiddle factors: t0-t6
.global ntt_rv64im
.align 2
ntt_rv64im:
  addi sp, sp, -8*16
  save_regs
  li a6, q48        // q<<48
  addi a0, a0, 32   // poly[16]
  addi gp, x0, 15   // loop
  sd gp, 8*15(sp)
  // load twiddle factors
  lw t0, 0*4(a1)
  lw t1, 1*4(a1)
  lw t2, 2*4(a1)
  lw t3, 3*4(a1)
  lw t4, 4*4(a1)
  lw t5, 5*4(a1)
  lw t6, 6*4(a1)
  ### LAYER 1+2+3+4
        addi x10, x10, -2           // *......................................................................................................................................................
        lh x27, 16*2*12(x10)        // .*.....................................................................................................................................................
        lh x23, 16*2*8(x10)         // ...*...................................................................................................................................................
        lh x25, 16*2*11(x10)        // ....*..................................................................................................................................................
        mulw x13, x27, x5           // ....*..................................................................................................................................................
        lh x27, 16*2*10(x10)        // .....*.................................................................................................................................................
        lh x18, 16*2*9(x10)         // ......*................................................................................................................................................
        mulw x12, x23, x5           // ......*................................................................................................................................................
        lh x9, 16*2*15(x10)         // .......*...............................................................................................................................................
        lh x17, 16*2*4(x10)         // ........*..............................................................................................................................................
        mulw x24, x25, x5           // ........*..............................................................................................................................................
        srai x15, x13, 16           // ..........*............................................................................................................................................
        mulw x3, x18, x5            // ..........*............................................................................................................................................
        addi x18, x15, 8            // ...........*...........................................................................................................................................
        srai x20, x12, 16           // ...........*...........................................................................................................................................
        srai x26, x24, 16           // ............*..........................................................................................................................................
        mulw x23, x27, x5           // ............*..........................................................................................................................................
        addi x12, x20, 8            // .............*.........................................................................................................................................
        addi x21, x26, 8            // .............*.........................................................................................................................................
        lh x8, 16*2*13(x10)         // ..............*........................................................................................................................................
        mulw x20, x9, x5            // ..............*........................................................................................................................................
        srai x3, x3, 16             // ................*......................................................................................................................................
        addi x3, x3, 8              // .................*.....................................................................................................................................
        srai x27, x20, 16           // ..................*....................................................................................................................................
        mulh x18, x18, x16          // ..................*....................................................................................................................................
        addi x15, x27, 8            // ...................*...................................................................................................................................
        srai x14, x23, 16           // ...................*...................................................................................................................................
        lh x1, 16*2*1(x10)          // ....................*..................................................................................................................................
        mulh x26, x12, x16          // ....................*..................................................................................................................................
        lh x27, 16*2*0(x10)         // .....................*.................................................................................................................................
        add x22, x17, x18           // ......................*................................................................................................................................
        mulh x3, x3, x16            // ......................*................................................................................................................................
        lh x23, 16*2*14(x10)        // ........................*..............................................................................................................................
        addi x25, x14, 8            // ........................*..............................................................................................................................
        sub x4, x17, x18            // .........................*.............................................................................................................................
        mulh x17, x25, x16          // .........................*.............................................................................................................................
        add x9, x1, x3              // ..........................*............................................................................................................................
        sub x25, x1, x3             // ..........................*............................................................................................................................
        add x20, x27, x26           // ...........................*...........................................................................................................................
        mulw x3, x8, x5             // ...........................*...........................................................................................................................
        sub x24, x27, x26           // ............................*..........................................................................................................................
        lh x14, 16*2*2(x10)         // ............................*..........................................................................................................................
        mulh x19, x15, x16          // .............................*.........................................................................................................................
        lh x15, 16*2*5(x10)         // ..............................*........................................................................................................................
        lh x27, 16*2*7(x10)         // ...............................*.......................................................................................................................
        mulh x8, x21, x16           // ...............................*.......................................................................................................................
        sub x26, x14, x17           // ................................*......................................................................................................................
        add x18, x14, x17           // .................................*.....................................................................................................................
        mulw x14, x22, x6           // .................................*.....................................................................................................................
        srai x3, x3, 16             // ..................................*....................................................................................................................
        sub x21, x27, x19           // ...................................*...................................................................................................................
        mulw x1, x23, x5            // ...................................*...................................................................................................................
        lh x23, 16*2*3(x10)         // ....................................*..................................................................................................................
        addi x3, x3, 8              // ....................................*..................................................................................................................
        lh x22, 16*2*6(x10)         // .....................................*.................................................................................................................
        mulw x12, x4, x7            // .....................................*.................................................................................................................
        srai x17, x14, 16           // ......................................*................................................................................................................
        add x19, x27, x19           // ......................................*................................................................................................................
        add x4, x23, x8             // .......................................*...............................................................................................................
        mulh x3, x3, x16            // .......................................*...............................................................................................................
        sub x27, x23, x8            // ........................................*..............................................................................................................
        srai x1, x1, 16             // .........................................*.............................................................................................................
        mulw x8, x19, x6            // .........................................*.............................................................................................................
        srai x13, x12, 16           // ..........................................*............................................................................................................
        addi x19, x1, 8             // ...........................................*...........................................................................................................
        addi x23, x13, 8            // ...........................................*...........................................................................................................
        mulw x14, x21, x7           // ............................................*..........................................................................................................
        addi x17, x17, 8            // ............................................*..........................................................................................................
        add x21, x15, x3            // .............................................*.........................................................................................................
        srai x12, x8, 16            // .............................................*.........................................................................................................
        sub x15, x15, x3            // ..............................................*........................................................................................................
        mulw x3, x21, x6            // ..............................................*........................................................................................................
        addi x13, x12, 8            // ...............................................*.......................................................................................................
        srai x8, x14, 16            // ................................................*......................................................................................................
        mulh x12, x19, x16          // ................................................*......................................................................................................
        addi x14, x8, 8             // .................................................*.....................................................................................................
        mulh x21, x17, x16          // ..................................................*....................................................................................................
        srai x3, x3, 16             // ..................................................*....................................................................................................
        addi x3, x3, 8              // ...................................................*...................................................................................................
        mulh x3, x3, x16            // ....................................................*..................................................................................................
        add x19, x22, x12           // ......................................................*................................................................................................
        sub x17, x22, x12           // ......................................................*................................................................................................
        mulh x14, x14, x16          // .......................................................*...............................................................................................
        add x8, x20, x21            // .......................................................*...............................................................................................
        sub x20, x20, x21           // ........................................................*..............................................................................................
        add x1, x9, x3              // ........................................................*..............................................................................................
        sub x21, x9, x3             // .........................................................*.............................................................................................
        mulw x3, x15, x7            // .........................................................*.............................................................................................
        mulw x19, x19, x6           // ...........................................................*...........................................................................................
        sub x22, x27, x14           // ............................................................*..........................................................................................
        add x14, x27, x14           // .............................................................*.........................................................................................
        mulh x15, x13, x16          // .............................................................*.........................................................................................
        srai x3, x3, 16             // ...............................................................*.......................................................................................
        mulw x27, x22, x31          // ...............................................................*.......................................................................................
        addi x3, x3, 8              // ................................................................*......................................................................................
        srai x12, x19, 16           // ................................................................*......................................................................................
        sub x19, x4, x15            // .................................................................*.....................................................................................
        mulh x3, x3, x16            // .................................................................*.....................................................................................
        mulw x9, x19, x29           // ...................................................................*...................................................................................
        add x19, x4, x15            // ....................................................................*..................................................................................
        srai x22, x27, 16           // ....................................................................*..................................................................................
        sub x13, x25, x3            // .....................................................................*.................................................................................
        mulh x23, x23, x16          // .....................................................................*.................................................................................
        add x25, x25, x3            // .......................................................................*...............................................................................
        srai x9, x9, 16             // .......................................................................*...............................................................................
        mulw x17, x17, x7           // ........................................................................*..............................................................................
        addi x27, x12, 8            // ........................................................................*..............................................................................
        sub x12, x24, x23           // .........................................................................*.............................................................................
        add x24, x24, x23           // .........................................................................*.............................................................................
        mulw x3, x19, x28           // ..........................................................................*............................................................................
        addi x15, x22, 8            // ..........................................................................*............................................................................
        addi x9, x9, 8              // ...........................................................................*...........................................................................
        lw x23, 7*4(x11)            // ...........................................................................*...........................................................................
        srai x17, x17, 16           // ............................................................................*..........................................................................
        mulh x22, x9, x16           // ............................................................................*..........................................................................
        addi x17, x17, 8            // .............................................................................*.........................................................................
        ld gp, 8*15(sp)
        addi gp, gp, -1
        sd gp, 8*15(sp)
ntt_rv64im_loop1:
                                    // Instructions:    233
                                    // Expected cycles: 152
                                    // Expected IPC:    1.53

                                    // ------------------------------------------------------------------ cycle (expected) ------------------------------------------------------------------->
                                    // 0                        25                       50                       75                       100                      125                      150
                                    // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|-
        mulh x9, x17, x16           // *.......................................................................................................................................................
        srai x3, x3, 16             // *.......................................................................................................................................................
        addi x3, x3, 8              // .*......................................................................................................................................................
        lw x17, 9*4(x11)            // .*......................................................................................................................................................
        sub x4, x21, x22            // ..*.....................................................................................................................................................
        mulh x3, x3, x16            // ..*.....................................................................................................................................................
        add x21, x21, x22           // ....*...................................................................................................................................................
        mulh x19, x15, x16          // ....*...................................................................................................................................................
        sub x22, x26, x9            // .....*..................................................................................................................................................
        add x9, x26, x9             // .....*..................................................................................................................................................
        sub x26, x1, x3             // ......*.................................................................................................................................................
        mulw x15, x9, x30           // ......*.................................................................................................................................................
        mulh x9, x27, x16           // ........*...............................................................................................................................................
        add x27, x13, x19           // ........*...............................................................................................................................................
        sub x19, x13, x19           // .........*..............................................................................................................................................
        lw x13, 14*4(x11)           // .........*..............................................................................................................................................
        mulw x17, x21, x17          // ..........*.............................................................................................................................................
        add x1, x1, x3              // ..........*.............................................................................................................................................
        srai x15, x15, 16           // ...........*............................................................................................................................................
        lw x21, 10*4(x11)           // ...........*............................................................................................................................................
        mulw x19, x19, x13          // ............*...........................................................................................................................................
        add x13, x18, x9            // .............*..........................................................................................................................................
        sub x18, x18, x9            // ..............*.........................................................................................................................................
        mulw x1, x1, x23            // ..............*.........................................................................................................................................
        addi x9, x15, 8             // ...............*........................................................................................................................................
        srai x15, x17, 16           // ...............*........................................................................................................................................
        srai x19, x19, 16           // ................*.......................................................................................................................................
        mulw x21, x4, x21           // ................*.......................................................................................................................................
        addi x23, x15, 8            // .................*......................................................................................................................................
        lw x17, 11*4(x11)           // .................*......................................................................................................................................
        mulw x13, x13, x28          // ..................*.....................................................................................................................................
        srai x15, x1, 16            // ...................*....................................................................................................................................
        addi x1, x15, 8             // ....................*...................................................................................................................................
        mulw x3, x14, x30           // ....................*...................................................................................................................................
        srai x21, x21, 16           // .......................*................................................................................................................................
        mulw x14, x22, x31          // ........................*...............................................................................................................................
        srai x3, x3, 16             // ........................*...............................................................................................................................
        srai x4, x13, 16            // .........................*..............................................................................................................................
        addi x3, x3, 8              // .........................*..............................................................................................................................
        addi x4, x4, 8              // ..........................*.............................................................................................................................
        mulh x3, x3, x16            // ..........................*.............................................................................................................................
        lw x22, 13*4(x11)           // ...........................*............................................................................................................................
        addi x21, x21, 8            // ...........................*............................................................................................................................
        mulh x13, x4, x16           // ............................*...........................................................................................................................
        srai x14, x14, 16           // ..............................*.........................................................................................................................
        mulh x1, x1, x16            // ..............................*.........................................................................................................................
        addi x14, x14, 8            // ...............................*........................................................................................................................
        sub x4, x25, x3             // ................................*.......................................................................................................................
        mulw x22, x27, x22          // ................................*.......................................................................................................................
        add x27, x25, x3            // .................................*......................................................................................................................
        lw x3, 8*4(x11)             // .................................*......................................................................................................................
        add x25, x8, x13            // ..................................*.....................................................................................................................
        mulw x15, x18, x29          // ..................................*.....................................................................................................................
        addi x18, x19, 8            // ...................................*....................................................................................................................
        sub x19, x25, x1            // ...................................*....................................................................................................................
        add x1, x25, x1             // ....................................*...................................................................................................................
        mulw x3, x26, x3            // ....................................*...................................................................................................................
        sub x13, x8, x13            // .......................................*................................................................................................................
        mulh x21, x21, x16          // ........................................*...............................................................................................................
        srai x3, x3, 16             // ........................................*...............................................................................................................
        sh x19, 16*2*1(x10)         // .........................................*..............................................................................................................
        addi x3, x3, 8              // .........................................*..............................................................................................................
        mulh x3, x3, x16            // ..........................................*.............................................................................................................
        srai x8, x15, 16            // ..........................................*.............................................................................................................
        addi x8, x8, 8              // ...........................................*............................................................................................................
        mulh x26, x8, x16           // ............................................*...........................................................................................................
        srai x8, x22, 16            // ............................................*...........................................................................................................
        sh x1, 16*2*0(x10)          // .............................................*..........................................................................................................
        addi x15, x8, 8             // .............................................*..........................................................................................................
        mulw x8, x27, x17           // ..............................................*.........................................................................................................
        mulh x1, x9, x16            // ................................................*.......................................................................................................
        sub x19, x13, x3            // ................................................*.......................................................................................................
        add x9, x13, x3             // .................................................*......................................................................................................
        sub x13, x20, x26           // .................................................*......................................................................................................
        add x22, x20, x26           // ..................................................*.....................................................................................................
        mulh x26, x15, x16          // ..................................................*.....................................................................................................
        srai x8, x8, 16             // ...................................................*....................................................................................................
        sub x25, x13, x21           // ...................................................*....................................................................................................
        add x17, x13, x21           // ....................................................*...................................................................................................
        mulh x23, x23, x16          // ....................................................*...................................................................................................
        add x27, x24, x1            // .....................................................*..................................................................................................
        sub x20, x24, x1            // .....................................................*..................................................................................................
        addi x8, x8, 8              // ......................................................*.................................................................................................
        sh x9, 16*2*2(x10)          // ......................................................*.................................................................................................
        lw x3, 12*4(x11)            // .......................................................*................................................................................................
        mulh x1, x14, x16           // .......................................................*................................................................................................
        sh x17, 16*2*6(x10)         // ........................................................*...............................................................................................
        add x24, x22, x23           // ........................................................*...............................................................................................
        sh x19, 16*2*3(x10)         // .........................................................*..............................................................................................
        sub x9, x22, x23            // .........................................................*..............................................................................................
        sh x25, 16*2*7(x10)         // ..........................................................*.............................................................................................
        mulw x3, x4, x3             // ..........................................................*.............................................................................................
        add x19, x12, x1            // .............................................................*..........................................................................................
        mulh x8, x8, x16            // ..............................................................*.........................................................................................
        srai x3, x3, 16             // ..............................................................*.........................................................................................
        sh x9, 16*2*5(x10)          // ...............................................................*........................................................................................
        sub x25, x19, x26           // ...............................................................*........................................................................................
        mulh x23, x18, x16          // ................................................................*.......................................................................................
        add x9, x19, x26            // ................................................................*.......................................................................................
        sh x24, 16*2*4(x10)         // .................................................................*......................................................................................
        sub x24, x12, x1            // .................................................................*......................................................................................
        sub x15, x27, x8            // ..................................................................*.....................................................................................
        add x13, x27, x8            // ..................................................................*.....................................................................................
        addi x3, x3, 8              // ...................................................................*....................................................................................
        sh x9, 16*2*12(x10)         // ...................................................................*....................................................................................
        sh x13, 16*2*8(x10)         // ....................................................................*...................................................................................
        mulh x3, x3, x16            // ....................................................................*...................................................................................
        sh x15, 16*2*9(x10)         // .....................................................................*..................................................................................
        add x8, x24, x23            // .....................................................................*..................................................................................
        sh x25, 16*2*13(x10)        // ......................................................................*.................................................................................
        sub x27, x24, x23           // ......................................................................*.................................................................................
        sh x8, 16*2*14(x10)         // .......................................................................*................................................................................
        sub x25, x20, x3            // ........................................................................*...............................................................................
        sh x27, 16*2*15(x10)        // ........................................................................*...............................................................................
        add x8, x20, x3             // .........................................................................*..............................................................................
        sh x25, 16*2*11(x10)        // .........................................................................*..............................................................................
        sh x8, 16*2*10(x10)         // ..........................................................................*.............................................................................
        addi x10, x10, -2           // ..........................................................................*.............................................................................
        lh x18, 16*2*12(x10)        // ...........................................................................*............................................................................
        lh x20, 16*2*9(x10)         // .............................................................................*..........................................................................
        lh x8, 16*2*10(x10)         // ..............................................................................*.........................................................................
        mulw x17, x18, x5           // ..............................................................................*.........................................................................
        lh x13, 16*2*8(x10)         // ...............................................................................*........................................................................
        lh x24, 16*2*11(x10)        // ................................................................................*.......................................................................
        mulw x3, x20, x5            // ................................................................................*.......................................................................
        lh x27, 16*2*15(x10)        // .................................................................................*......................................................................
        lh x18, 16*2*4(x10)         // ..................................................................................*.....................................................................
        mulw x8, x8, x5             // ..................................................................................*.....................................................................
        mulw x21, x13, x5           // .....................................................................................*..................................................................
        srai x20, x8, 16            // ......................................................................................*.................................................................
        srai x3, x3, 16             // ......................................................................................*.................................................................
        srai x25, x17, 16           // .......................................................................................*................................................................
        mulw x13, x24, x5           // .......................................................................................*................................................................
        addi x15, x20, 8            // ........................................................................................*...............................................................
        addi x3, x3, 8              // ........................................................................................*...............................................................
        addi x24, x25, 8            // .........................................................................................*..............................................................
        mulw x20, x27, x5           // .........................................................................................*..............................................................
        srai x12, x21, 16           // ..........................................................................................*.............................................................
        addi x26, x12, 8            // ...........................................................................................*............................................................
        lh x22, 16*2*1(x10)         // ............................................................................................*...........................................................
        mulh x12, x26, x16          // ............................................................................................*...........................................................
        srai x19, x13, 16           // .............................................................................................*..........................................................
        srai x23, x20, 16           // .............................................................................................*..........................................................
        lh x13, 16*2*0(x10)         // ..............................................................................................*.........................................................
        mulh x3, x3, x16            // ..............................................................................................*.........................................................
        addi x1, x19, 8             // ...............................................................................................*........................................................
        addi x4, x23, 8             // ...............................................................................................*........................................................
        lh x14, 16*2*13(x10)        // ................................................................................................*.......................................................
        mulh x26, x24, x16          // ................................................................................................*.......................................................
        sub x24, x13, x12           // ...................................................................................................*....................................................
        add x20, x13, x12           // ...................................................................................................*....................................................
        mulh x8, x1, x16            // ....................................................................................................*...................................................
        sub x13, x18, x26           // ....................................................................................................*...................................................
        add x19, x18, x26           // .....................................................................................................*..................................................
        sub x25, x22, x3            // .....................................................................................................*..................................................
        add x9, x22, x3             // ......................................................................................................*.................................................
        mulw x3, x14, x5            // ......................................................................................................*.................................................
        lh x17, 16*2*3(x10)         // ........................................................................................................*...............................................
        mulh x26, x4, x16           // ........................................................................................................*...............................................
        lh x21, 16*2*14(x10)        // .........................................................................................................*..............................................
        lh x1, 16*2*5(x10)          // ..........................................................................................................*.............................................
        mulh x22, x15, x16          // ..........................................................................................................*.............................................
        sub x12, x17, x8            // ...........................................................................................................*............................................
        mulw x23, x21, x5           // ............................................................................................................*...........................................
        lh x15, 16*2*2(x10)         // ............................................................................................................*...........................................
        add x4, x17, x8             // .............................................................................................................*..........................................
        srai x3, x3, 16             // .............................................................................................................*..........................................
        lh x17, 16*2*7(x10)         // ..............................................................................................................*.........................................
        mulw x27, x19, x6           // ..............................................................................................................*.........................................
        lh x21, 16*2*6(x10)         // ...............................................................................................................*........................................
        addi x3, x3, 8              // ...............................................................................................................*........................................
        add x18, x15, x22           // ................................................................................................................*.......................................
        mulh x3, x3, x16            // ................................................................................................................*.......................................
        add x14, x17, x26           // ..................................................................................................................*.....................................
        sub x19, x17, x26           // ..................................................................................................................*.....................................
        srai x23, x23, 16           // ...................................................................................................................*....................................
        mulw x13, x13, x7           // ...................................................................................................................*....................................
        sub x26, x1, x3             // ....................................................................................................................*...................................
        add x17, x1, x3             // .....................................................................................................................*..................................
        mulw x3, x26, x7            // .....................................................................................................................*..................................
        sub x26, x15, x22           // ......................................................................................................................*.................................
        srai x8, x27, 16            // ......................................................................................................................*.................................
        addi x22, x23, 8            // .......................................................................................................................*................................
        mulw x27, x19, x7           // .......................................................................................................................*................................
        addi x23, x8, 8             // .........................................................................................................................*..............................
        mulw x19, x14, x6           // .........................................................................................................................*..............................
        srai x3, x3, 16             // ............................................................................................................................*...........................
        mulh x1, x22, x16           // ............................................................................................................................*...........................
        srai x22, x19, 16           // .............................................................................................................................*..........................
        addi x3, x3, 8              // .............................................................................................................................*..........................
        mulh x3, x3, x16            // ..............................................................................................................................*.........................
        srai x14, x13, 16           // ..............................................................................................................................*.........................
        addi x14, x14, 8            // ...............................................................................................................................*........................
        addi x13, x22, 8            // ................................................................................................................................*.......................
        mulh x19, x23, x16          // ................................................................................................................................*.......................
        add x23, x21, x1            // .................................................................................................................................*......................
        sub x8, x21, x1             // .................................................................................................................................*......................
        srai x22, x27, 16           // ..................................................................................................................................*.....................
        mulh x15, x13, x16          // ..................................................................................................................................*.....................
        addi x22, x22, 8            // ...................................................................................................................................*....................
        sub x13, x25, x3            // ...................................................................................................................................*....................
        add x25, x25, x3            // ....................................................................................................................................*...................
        mulw x3, x17, x6            // ....................................................................................................................................*...................
        mulh x22, x22, x16          // ......................................................................................................................................*.................
        sub x27, x4, x15            // .......................................................................................................................................*................
        mulh x21, x14, x16          // ........................................................................................................................................*...............
        srai x3, x3, 16             // ........................................................................................................................................*...............
        addi x3, x3, 8              // .........................................................................................................................................*..............
        add x14, x12, x22           // ..........................................................................................................................................*.............
        mulh x3, x3, x16            // ..........................................................................................................................................*.............
        mulw x17, x8, x7            // ............................................................................................................................................*...........
        sub x8, x12, x22            // .............................................................................................................................................*..........
        sub x12, x24, x21           // .............................................................................................................................................*..........
        mulw x22, x27, x29          // ..............................................................................................................................................*.........
        add x24, x24, x21           // ..............................................................................................................................................*.........
        add x1, x9, x3              // ...............................................................................................................................................*........
        sub x21, x9, x3             // ...............................................................................................................................................*........
        srai x17, x17, 16           // ................................................................................................................................................*.......
        mulw x9, x23, x6            // ................................................................................................................................................*.......
        lw x23, 7*4(x11)            // .................................................................................................................................................*......
        add x27, x4, x15            // .................................................................................................................................................*......
        mulw x4, x8, x31            // ..................................................................................................................................................*.....
        add x8, x20, x19            // ..................................................................................................................................................*.....
        addi x17, x17, 8            // ...................................................................................................................................................*....
        srai x22, x22, 16           // ...................................................................................................................................................*....
        srai x9, x9, 16             // ....................................................................................................................................................*...
        mulw x3, x27, x28           // ....................................................................................................................................................*...
        addi x15, x22, 8            // .....................................................................................................................................................*..
        addi x27, x9, 8             // .....................................................................................................................................................*..
        srai x9, x4, 16             // ......................................................................................................................................................*.
        sub x20, x20, x19           // ......................................................................................................................................................*.
        mulh x22, x15, x16          // .......................................................................................................................................................*
        addi x15, x9, 8             // .......................................................................................................................................................*

                                     // ------------------------------------------------------------------ cycle (expected) ------------------------------------------------------------------->
                                     // 0                        25                       50                       75                       100                      125                      150
                                     // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|-
        // srai x3, x3, 16           // *.......................................................................................................................................................
        // mulh x17, x17, x16        // *.......................................................................................................................................................
        // add x4, x21, x22          // ....*...................................................................................................................................................
        // mulh x19, x27, x16        // ........*...............................................................................................................................................
        // addi x3, x3, 8            // .*......................................................................................................................................................
        // lw x27, 9*4(x11)          // .*......................................................................................................................................................
        // sub x9, x26, x17          // .....*..................................................................................................................................................
        // mulh x3, x3, x16          // ..*.....................................................................................................................................................
        // add x26, x26, x17         // .....*..................................................................................................................................................
        // sub x17, x18, x19         // ..............*.........................................................................................................................................
        // mulw x26, x26, x30        // ......*.................................................................................................................................................
        // add x18, x18, x19         // .............*..........................................................................................................................................
        // mulw x17, x17, x29        // ..................................*.....................................................................................................................
        // sub x21, x21, x22         // ..*.....................................................................................................................................................
        // add x22, x1, x3           // ..........*.............................................................................................................................................
        // sub x19, x1, x3           // ......*.................................................................................................................................................
        // mulw x3, x14, x30         // ....................*...................................................................................................................................
        // srai x1, x26, 16          // ...........*............................................................................................................................................
        // mulw x26, x9, x31         // ........................*...............................................................................................................................
        // srai x9, x17, 16          // ..........................................*.............................................................................................................
        // addi x14, x9, 8           // ...........................................*............................................................................................................
        // addi x9, x1, 8            // ...............*........................................................................................................................................
        // srai x3, x3, 16           // ........................*...............................................................................................................................
        // mulh x15, x15, x16        // ....*...................................................................................................................................................
        // mulw x1, x4, x27          // ..........*.............................................................................................................................................
        // add x27, x13, x15         // ........*...............................................................................................................................................
        // srai x17, x26, 16         // ..............................*.........................................................................................................................
        // lw x4, 10*4(x11)          // ...........*............................................................................................................................................
        // mulw x22, x22, x23        // ..............*.........................................................................................................................................
        // sub x13, x13, x15         // .........*..............................................................................................................................................
        // addi x17, x17, 8          // ...............................*........................................................................................................................
        // addi x3, x3, 8            // .........................*..............................................................................................................................
        // srai x23, x1, 16          // ...............*........................................................................................................................................
        // mulw x18, x18, x28        // ..................*.....................................................................................................................................
        // srai x22, x22, 16         // ...................*....................................................................................................................................
        // mulh x3, x3, x16          // ..........................*.............................................................................................................................
        // srai x26, x18, 16         // .........................*..............................................................................................................................
        // addi x18, x22, 8          // ....................*...................................................................................................................................
        // addi x15, x26, 8          // ..........................*.............................................................................................................................
        // mulh x17, x17, x16        // .......................................................*................................................................................................
        // lw x26, 13*4(x11)         // ...........................*............................................................................................................................
        // lw x1, 14*4(x11)          // .........*..............................................................................................................................................
        // mulw x22, x21, x4         // ................*.......................................................................................................................................
        // sub x4, x25, x3           // ................................*.......................................................................................................................
        // add x25, x25, x3          // .................................*......................................................................................................................
        // lw x3, 8*4(x11)           // .................................*......................................................................................................................
        // mulh x21, x14, x16        // ............................................*...........................................................................................................
        // mulh x15, x15, x16        // ............................*...........................................................................................................................
        // sub x14, x12, x17         // .................................................................*......................................................................................
        // add x12, x12, x17         // .............................................................*..........................................................................................
        // addi x23, x23, 8          // .................*......................................................................................................................................
        // mulw x1, x13, x1          // ............*...........................................................................................................................................
        // srai x17, x22, 16         // .......................*................................................................................................................................
        // add x13, x20, x21         // ..................................................*.....................................................................................................
        // sub x22, x20, x21         // .................................................*......................................................................................................
        // mulw x3, x19, x3          // ....................................*...................................................................................................................
        // add x20, x8, x15          // ..................................*.....................................................................................................................
        // sub x8, x8, x15           // .......................................*................................................................................................................
        // lw x15, 11*4(x11)         // .................*......................................................................................................................................
        // addi x19, x17, 8          // ...........................*............................................................................................................................
        // mulw x15, x25, x15        // ..............................................*.........................................................................................................
        // srai x25, x1, 16          // ................*.......................................................................................................................................
        // srai x3, x3, 16           // ........................................*...............................................................................................................
        // mulh x17, x18, x16        // ..............................*.........................................................................................................................
        // addi x1, x25, 8           // ...................................*....................................................................................................................
        // addi x3, x3, 8            // .........................................*..............................................................................................................
        // mulh x21, x19, x16        // ........................................*...............................................................................................................
        // srai x25, x15, 16         // ...................................................*....................................................................................................
        // addi x19, x25, 8          // ......................................................*.................................................................................................
        // sub x15, x20, x17         // ...................................*....................................................................................................................
        // mulw x27, x27, x26        // ................................*.......................................................................................................................
        // sub x26, x22, x21         // ...................................................*....................................................................................................
        // sh x26, 16*2*7(x10)       // ..........................................................*.............................................................................................
        // add x25, x20, x17         // ....................................*...................................................................................................................
        // sh x25, 16*2*0(x10)       // .............................................*..........................................................................................................
        // mulh x3, x3, x16          // ..........................................*.............................................................................................................
        // sh x15, 16*2*1(x10)       // .........................................*..............................................................................................................
        // add x18, x22, x21         // ....................................................*...................................................................................................
        // mulh x26, x1, x16         // ................................................................*.......................................................................................
        // srai x27, x27, 16         // ............................................*...........................................................................................................
        // sh x18, 16*2*6(x10)       // ........................................................*...............................................................................................
        // addi x17, x27, 8          // .............................................*..........................................................................................................
        // mulh x22, x19, x16        // ..............................................................*.........................................................................................
        // add x18, x8, x3           // .................................................*......................................................................................................
        // sub x8, x8, x3            // ................................................*.......................................................................................................
        // sh x18, 16*2*2(x10)       // ......................................................*.................................................................................................
        // mulh x21, x9, x16         // ................................................*.......................................................................................................
        // lw x3, 12*4(x11)          // .......................................................*................................................................................................
        // add x20, x14, x26         // .....................................................................*..................................................................................
        // sh x8, 16*2*3(x10)        // .........................................................*..............................................................................................
        // sub x15, x14, x26         // ......................................................................*.................................................................................
        // sh x20, 16*2*14(x10)      // .......................................................................*................................................................................
        // sh x15, 16*2*15(x10)      // ........................................................................*...............................................................................
        // mulw x3, x4, x3           // ..........................................................*.............................................................................................
        // sub x19, x24, x21         // .....................................................*..................................................................................................
        // add x15, x24, x21         // .....................................................*..................................................................................................
        // add x9, x15, x22          // ..................................................................*.....................................................................................
        // mulh x14, x23, x16        // ....................................................*...................................................................................................
        // sh x9, 16*2*8(x10)        // ....................................................................*...................................................................................
        // sub x4, x15, x22          // ..................................................................*.....................................................................................
        // srai x3, x3, 16           // ..............................................................*.........................................................................................
        // mulh x27, x17, x16        // ..................................................*.....................................................................................................
        // sh x4, 16*2*9(x10)        // .....................................................................*..................................................................................
        // addi x3, x3, 8            // ...................................................................*....................................................................................
        // mulh x3, x3, x16          // ....................................................................*...................................................................................
        // sub x15, x13, x14         // .........................................................*..............................................................................................
        // add x25, x13, x14         // ........................................................*...............................................................................................
        // sh x15, 16*2*5(x10)       // ...............................................................*........................................................................................
        // add x15, x12, x27         // ................................................................*.......................................................................................
        // sh x25, 16*2*4(x10)       // .................................................................*......................................................................................
        // sub x24, x12, x27         // ...............................................................*........................................................................................
        // sh x15, 16*2*12(x10)      // ...................................................................*....................................................................................
        // sh x24, 16*2*13(x10)      // ......................................................................*.................................................................................
        // add x13, x19, x3          // .........................................................................*..............................................................................
        // sh x13, 16*2*10(x10)      // ..........................................................................*.............................................................................
        // sub x27, x19, x3          // ........................................................................*...............................................................................
        // sh x27, 16*2*11(x10)      // .........................................................................*..............................................................................
        // addi x10, x10, -2         // ..........................................................................*.............................................................................
        // lh x27, 16*2*12(x10)      // ...........................................................................*............................................................................
        // lh x23, 16*2*8(x10)       // ...............................................................................*........................................................................
        // lh x25, 16*2*11(x10)      // ................................................................................*.......................................................................
        // mulw x13, x27, x5         // ..............................................................................*.........................................................................
        // lh x27, 16*2*10(x10)      // ..............................................................................*.........................................................................
        // lh x18, 16*2*9(x10)       // .............................................................................*..........................................................................
        // mulw x12, x23, x5         // .....................................................................................*..................................................................
        // lh x9, 16*2*15(x10)       // .................................................................................*......................................................................
        // lh x17, 16*2*4(x10)       // ..................................................................................*.....................................................................
        // mulw x24, x25, x5         // .......................................................................................*................................................................
        // srai x15, x13, 16         // .......................................................................................*................................................................
        // mulw x3, x18, x5          // ................................................................................*.......................................................................
        // addi x18, x15, 8          // .........................................................................................*..............................................................
        // srai x20, x12, 16         // ..........................................................................................*.............................................................
        // srai x26, x24, 16         // .............................................................................................*..........................................................
        // mulw x23, x27, x5         // ..................................................................................*.....................................................................
        // addi x12, x20, 8          // ...........................................................................................*............................................................
        // addi x21, x26, 8          // ...............................................................................................*........................................................
        // lh x8, 16*2*13(x10)       // ................................................................................................*.......................................................
        // mulw x20, x9, x5          // .........................................................................................*..............................................................
        // srai x3, x3, 16           // ......................................................................................*.................................................................
        // addi x3, x3, 8            // ........................................................................................*...............................................................
        // srai x27, x20, 16         // .............................................................................................*..........................................................
        // mulh x18, x18, x16        // ................................................................................................*.......................................................
        // addi x15, x27, 8          // ...............................................................................................*........................................................
        // srai x14, x23, 16         // ......................................................................................*.................................................................
        // lh x1, 16*2*1(x10)        // ............................................................................................*...........................................................
        // mulh x26, x12, x16        // ............................................................................................*...........................................................
        // lh x27, 16*2*0(x10)       // ..............................................................................................*.........................................................
        // add x22, x17, x18         // .....................................................................................................*..................................................
        // mulh x3, x3, x16          // ..............................................................................................*.........................................................
        // lh x23, 16*2*14(x10)      // .........................................................................................................*..............................................
        // addi x25, x14, 8          // ........................................................................................*...............................................................
        // sub x4, x17, x18          // ....................................................................................................*...................................................
        // mulh x17, x25, x16        // ..........................................................................................................*.............................................
        // add x9, x1, x3            // ......................................................................................................*.................................................
        // sub x25, x1, x3           // .....................................................................................................*..................................................
        // add x20, x27, x26         // ...................................................................................................*....................................................
        // mulw x3, x8, x5           // ......................................................................................................*.................................................
        // sub x24, x27, x26         // ...................................................................................................*....................................................
        // lh x14, 16*2*2(x10)       // ............................................................................................................*...........................................
        // mulh x19, x15, x16        // ........................................................................................................*...............................................
        // lh x15, 16*2*5(x10)       // ..........................................................................................................*.............................................
        // lh x27, 16*2*7(x10)       // ..............................................................................................................*.........................................
        // mulh x8, x21, x16         // ....................................................................................................*...................................................
        // sub x26, x14, x17         // ......................................................................................................................*.................................
        // add x18, x14, x17         // ................................................................................................................*.......................................
        // mulw x14, x22, x6         // ..............................................................................................................*.........................................
        // srai x3, x3, 16           // .............................................................................................................*..........................................
        // sub x21, x27, x19         // ..................................................................................................................*.....................................
        // mulw x1, x23, x5          // ............................................................................................................*...........................................
        // lh x23, 16*2*3(x10)       // ........................................................................................................*...............................................
        // addi x3, x3, 8            // ...............................................................................................................*........................................
        // lh x22, 16*2*6(x10)       // ...............................................................................................................*........................................
        // mulw x12, x4, x7          // ...................................................................................................................*....................................
        // srai x17, x14, 16         // ......................................................................................................................*.................................
        // add x19, x27, x19         // ..................................................................................................................*.....................................
        // add x4, x23, x8           // .............................................................................................................*..........................................
        // mulh x3, x3, x16          // ................................................................................................................*.......................................
        // sub x27, x23, x8          // ...........................................................................................................*............................................
        // srai x1, x1, 16           // ...................................................................................................................*....................................
        // mulw x8, x19, x6          // .........................................................................................................................*..............................
        // srai x13, x12, 16         // ..............................................................................................................................*.........................
        // addi x19, x1, 8           // .......................................................................................................................*................................
        // addi x23, x13, 8          // ...............................................................................................................................*........................
        // mulw x14, x21, x7         // .......................................................................................................................*................................
        // addi x17, x17, 8          // .........................................................................................................................*..............................
        // add x21, x15, x3          // .....................................................................................................................*..................................
        // srai x12, x8, 16          // .............................................................................................................................*..........................
        // sub x15, x15, x3          // ....................................................................................................................*...................................
        // mulw x3, x21, x6          // ....................................................................................................................................*...................
        // addi x13, x12, 8          // ................................................................................................................................*.......................
        // srai x8, x14, 16          // ..................................................................................................................................*.....................
        // mulh x12, x19, x16        // ............................................................................................................................*...........................
        // addi x14, x8, 8           // ...................................................................................................................................*....................
        // mulh x21, x17, x16        // ................................................................................................................................*.......................
        // srai x3, x3, 16           // ........................................................................................................................................*...............
        // addi x3, x3, 8            // .........................................................................................................................................*..............
        // mulh x3, x3, x16          // ..........................................................................................................................................*.............
        // add x19, x22, x12         // .................................................................................................................................*......................
        // sub x17, x22, x12         // .................................................................................................................................*......................
        // mulh x14, x14, x16        // ......................................................................................................................................*.................
        // add x8, x20, x21          // ..................................................................................................................................................*.....
        // sub x20, x20, x21         // ......................................................................................................................................................*.
        // add x1, x9, x3            // ...............................................................................................................................................*........
        // sub x21, x9, x3           // ...............................................................................................................................................*........
        // mulw x3, x15, x7          // .....................................................................................................................*..................................
        // mulw x19, x19, x6         // ................................................................................................................................................*.......
        // sub x22, x27, x14         // .............................................................................................................................................*..........
        // add x14, x27, x14         // ..........................................................................................................................................*.............
        // mulh x15, x13, x16        // ..................................................................................................................................*.....................
        // srai x3, x3, 16           // ............................................................................................................................*...........................
        // mulw x27, x22, x31        // ..................................................................................................................................................*.....
        // addi x3, x3, 8            // .............................................................................................................................*..........................
        // srai x12, x19, 16         // ....................................................................................................................................................*...
        // sub x19, x4, x15          // .......................................................................................................................................*................
        // mulh x3, x3, x16          // ..............................................................................................................................*.........................
        // mulw x9, x19, x29         // ..............................................................................................................................................*.........
        // add x19, x4, x15          // .................................................................................................................................................*......
        // srai x22, x27, 16         // ......................................................................................................................................................*.
        // sub x13, x25, x3          // ...................................................................................................................................*....................
        // mulh x23, x23, x16        // ........................................................................................................................................*...............
        // add x25, x25, x3          // ....................................................................................................................................*...................
        // srai x9, x9, 16           // ...................................................................................................................................................*....
        // mulw x17, x17, x7         // ............................................................................................................................................*...........
        // addi x27, x12, 8          // .....................................................................................................................................................*..
        // sub x12, x24, x23         // .............................................................................................................................................*..........
        // add x24, x24, x23         // ..............................................................................................................................................*.........
        // mulw x3, x19, x28         // ....................................................................................................................................................*...
        // addi x15, x22, 8          // .......................................................................................................................................................*
        // addi x9, x9, 8            // .....................................................................................................................................................*..
        // lw x23, 7*4(x11)          // .................................................................................................................................................*......
        // srai x17, x17, 16         // ................................................................................................................................................*.......
        // mulh x22, x9, x16         // .......................................................................................................................................................*
        // addi x17, x17, 8          // ...................................................................................................................................................*....

        ld gp, 8*15(sp)
        addi gp, gp, -1
        sd gp, 8*15(sp)
        bge gp, zero, ntt_rv64im_loop1
        srai x3, x3, 16             // ..............................................................................*........................................................................
        mulh x17, x17, x16          // ..............................................................................*........................................................................
        add x4, x21, x22            // ................................................................................*......................................................................
        mulh x19, x27, x16          // ................................................................................*......................................................................
        addi x3, x3, 8              // .................................................................................*.....................................................................
        lw x27, 9*4(x11)            // .................................................................................*.....................................................................
        sub x9, x26, x17            // ..................................................................................*....................................................................
        mulh x3, x3, x16            // ..................................................................................*....................................................................
        add x26, x26, x17           // ...................................................................................*...................................................................
        sub x17, x18, x19           // ....................................................................................*..................................................................
        mulw x26, x26, x30          // ....................................................................................*..................................................................
        add x18, x18, x19           // ......................................................................................*................................................................
        mulw x17, x17, x29          // ......................................................................................*................................................................
        sub x21, x21, x22           // .......................................................................................*...............................................................
        add x22, x1, x3             // .......................................................................................*...............................................................
        sub x19, x1, x3             // ........................................................................................*..............................................................
        mulw x3, x14, x30           // ........................................................................................*..............................................................
        srai x1, x26, 16            // .........................................................................................*.............................................................
        mulw x26, x9, x31           // ..........................................................................................*............................................................
        srai x9, x17, 16            // ..........................................................................................*............................................................
        addi x14, x9, 8             // ...........................................................................................*...........................................................
        addi x9, x1, 8              // ...........................................................................................*...........................................................
        srai x3, x3, 16             // ............................................................................................*..........................................................
        mulh x15, x15, x16          // ............................................................................................*..........................................................
        mulw x1, x4, x27            // ................................................................................................*......................................................
        add x27, x13, x15           // ................................................................................................*......................................................
        srai x17, x26, 16           // .................................................................................................*.....................................................
        lw x4, 10*4(x11)            // .................................................................................................*.....................................................
        mulw x22, x22, x23          // ..................................................................................................*....................................................
        sub x13, x13, x15           // ..................................................................................................*....................................................
        addi x17, x17, 8            // ...................................................................................................*...................................................
        addi x3, x3, 8              // ...................................................................................................*...................................................
        srai x23, x1, 16            // ....................................................................................................*..................................................
        mulw x18, x18, x28          // ....................................................................................................*..................................................
        srai x22, x22, 16           // .......................................................................................................*...............................................
        mulh x3, x3, x16            // .......................................................................................................*...............................................
        srai x26, x18, 16           // ........................................................................................................*..............................................
        addi x18, x22, 8            // ........................................................................................................*..............................................
        addi x15, x26, 8            // .........................................................................................................*.............................................
        mulh x17, x17, x16          // .........................................................................................................*.............................................
        lw x26, 13*4(x11)           // ..........................................................................................................*............................................
        lw x1, 14*4(x11)            // ...........................................................................................................*...........................................
        mulw x22, x21, x4           // ...........................................................................................................*...........................................
        sub x4, x25, x3             // ............................................................................................................*..........................................
        add x25, x25, x3            // ............................................................................................................*..........................................
        lw x3, 8*4(x11)             // .............................................................................................................*.........................................
        mulh x21, x14, x16          // .............................................................................................................*.........................................
        mulh x15, x15, x16          // ...............................................................................................................*.......................................
        sub x14, x12, x17           // ...............................................................................................................*.......................................
        add x12, x12, x17           // ................................................................................................................*......................................
        addi x23, x23, 8            // ................................................................................................................*......................................
        mulw x1, x13, x1            // .................................................................................................................*.....................................
        srai x17, x22, 16           // .................................................................................................................*.....................................
        add x13, x20, x21           // ..................................................................................................................*....................................
        sub x22, x20, x21           // ..................................................................................................................*....................................
        mulw x3, x19, x3            // ...................................................................................................................*...................................
        add x20, x8, x15            // ...................................................................................................................*...................................
        sub x8, x8, x15             // ....................................................................................................................*..................................
        lw x15, 11*4(x11)           // ....................................................................................................................*..................................
        addi x19, x17, 8            // .......................................................................................................................*...............................
        mulw x15, x25, x15          // .......................................................................................................................*...............................
        srai x25, x1, 16            // ........................................................................................................................*..............................
        srai x3, x3, 16             // .........................................................................................................................*.............................
        mulh x17, x18, x16          // .........................................................................................................................*.............................
        addi x1, x25, 8             // ..........................................................................................................................*............................
        addi x3, x3, 8              // ...........................................................................................................................*...........................
        mulh x21, x19, x16          // ...........................................................................................................................*...........................
        srai x25, x15, 16           // .............................................................................................................................*.........................
        addi x19, x25, 8            // ..............................................................................................................................*........................
        sub x15, x20, x17           // ..............................................................................................................................*........................
        mulw x27, x27, x26          // ...............................................................................................................................*.......................
        sub x26, x22, x21           // ...............................................................................................................................*.......................
        sh x26, 16*2*7(x10)         // ................................................................................................................................*......................
        add x25, x20, x17           // ................................................................................................................................*......................
        sh x25, 16*2*0(x10)         // .................................................................................................................................*.....................
        mulh x3, x3, x16            // .................................................................................................................................*.....................
        sh x15, 16*2*1(x10)         // ..................................................................................................................................*....................
        add x18, x22, x21           // ..................................................................................................................................*....................
        mulh x26, x1, x16           // ...................................................................................................................................*...................
        srai x27, x27, 16           // ...................................................................................................................................*...................
        sh x18, 16*2*6(x10)         // ....................................................................................................................................*..................
        addi x17, x27, 8            // ....................................................................................................................................*..................
        mulh x22, x19, x16          // .....................................................................................................................................*.................
        add x18, x8, x3             // .....................................................................................................................................*.................
        sub x8, x8, x3              // ......................................................................................................................................*................
        sh x18, 16*2*2(x10)         // ......................................................................................................................................*................
        mulh x21, x9, x16           // .......................................................................................................................................*...............
        lw x3, 12*4(x11)            // .......................................................................................................................................*...............
        add x20, x14, x26           // ........................................................................................................................................*..............
        sh x8, 16*2*3(x10)          // ........................................................................................................................................*..............
        sub x15, x14, x26           // .........................................................................................................................................*.............
        sh x20, 16*2*14(x10)        // .........................................................................................................................................*.............
        sh x15, 16*2*15(x10)        // ..........................................................................................................................................*............
        mulw x3, x4, x3             // ..........................................................................................................................................*............
        sub x19, x24, x21           // ...........................................................................................................................................*...........
        add x15, x24, x21           // ...........................................................................................................................................*...........
        add x9, x15, x22            // ............................................................................................................................................*..........
        mulh x14, x23, x16          // ............................................................................................................................................*..........
        sh x9, 16*2*8(x10)          // .............................................................................................................................................*.........
        sub x4, x15, x22            // .............................................................................................................................................*.........
        srai x3, x3, 16             // ..............................................................................................................................................*........
        mulh x27, x17, x16          // ..............................................................................................................................................*........
        sh x4, 16*2*9(x10)          // ...............................................................................................................................................*.......
        addi x3, x3, 8              // ...............................................................................................................................................*.......
        mulh x3, x3, x16            // ................................................................................................................................................*......
        sub x15, x13, x14           // ................................................................................................................................................*......
        add x25, x13, x14           // .................................................................................................................................................*.....
        sh x15, 16*2*5(x10)         // .................................................................................................................................................*.....
        add x15, x12, x27           // ..................................................................................................................................................*....
        sh x25, 16*2*4(x10)         // ..................................................................................................................................................*....
        sub x24, x12, x27           // ...................................................................................................................................................*...
        sh x15, 16*2*12(x10)        // ...................................................................................................................................................*...
        sh x24, 16*2*13(x10)        // ....................................................................................................................................................*..
        add x13, x19, x3            // ....................................................................................................................................................*..
        sh x13, 16*2*10(x10)        // .....................................................................................................................................................*.
        sub x27, x19, x3            // .....................................................................................................................................................*.
        sh x27, 16*2*11(x10)        // ......................................................................................................................................................*
  addi a1, a1, 15*4
  ### LAYER 5-6-7
  addi gp, x0, 16
  sd gp, 8*15(sp)
        lw x5, 0*4(x11)            // *..........................................................................................................................
        lh x23, 1*2*8(x10)         // .*.........................................................................................................................
        lh x15, 1*2*0(x10)         // ..*........................................................................................................................
        lh x30, 1*2*9(x10)         // ...*.......................................................................................................................
        lh x28, 1*2*11(x10)        // ....*......................................................................................................................
        mulw x20, x23, x5          // ....*......................................................................................................................
        lh x31, 1*2*10(x10)        // .....*.....................................................................................................................
        mulw x3, x30, x5           // ......*....................................................................................................................
        lh x29, 1*2*12(x10)        // ......*....................................................................................................................
        srai x3, x3, 16            // ..........*................................................................................................................
        mulw x22, x31, x5          // ..........*................................................................................................................
        addi x3, x3, 8             // ...........*...............................................................................................................
        srai x19, x20, 16          // ...........*...............................................................................................................
        mulh x3, x3, x16           // ............*..............................................................................................................
        addi x4, x19, 8            // ............*..............................................................................................................
        lh x19, 1*2*13(x10)        // .............*.............................................................................................................
        mulw x26, x28, x5          // ..............*............................................................................................................
        lh x6, 1*2*15(x10)         // ..............*............................................................................................................
        mulw x29, x29, x5          // ................*..........................................................................................................
        srai x30, x22, 16          // ................*..........................................................................................................
        srai x12, x26, 16          // ..................*........................................................................................................
        lh x8, 1*2*1(x10)          // ..................*........................................................................................................
        mulh x31, x4, x16          // ...................*.......................................................................................................
        addi x26, x30, 8           // ...................*.......................................................................................................
        addi x27, x12, 8           // ....................*......................................................................................................
        lh x22, 1*2*14(x10)        // ....................*......................................................................................................
        mulw x28, x6, x5           // .....................*.....................................................................................................
        add x9, x8, x3             // .....................*.....................................................................................................
        mulh x20, x26, x16         // .......................*...................................................................................................
        sub x25, x8, x3            // .......................*...................................................................................................
        add x8, x15, x31           // ........................*..................................................................................................
        sub x24, x15, x31          // ........................*..................................................................................................
        srai x13, x29, 16          // .........................*.................................................................................................
        mulw x1, x22, x5           // .........................*.................................................................................................
        srai x26, x28, 16          // ..........................*................................................................................................
        lh x15, 1*2*2(x10)         // ..........................*................................................................................................
        mulw x3, x19, x5           // ...........................*...............................................................................................
        addi x21, x13, 8           // ...........................*...............................................................................................
        lw x4, 1*4(x11)            // ............................*..............................................................................................
        mulh x23, x21, x16         // .............................*.............................................................................................
        lh x14, 1*2*4(x10)         // .............................*.............................................................................................
        srai x19, x1, 16           // ..............................*............................................................................................
        srai x3, x3, 16            // ...............................*...........................................................................................
        addi x6, x19, 8            // ...............................*...........................................................................................
        add x18, x15, x20          // ................................*..........................................................................................
        mulh x31, x27, x16         // ................................*..........................................................................................
        addi x7, x26, 8            // .................................*.........................................................................................
        mulh x13, x6, x16          // ..................................*........................................................................................
        sub x26, x15, x20          // ..................................*........................................................................................
        add x21, x14, x23          // ...................................*.......................................................................................
        mulw x30, x21, x4          // ....................................*......................................................................................
        lh x20, 1*2*7(x10)         // ....................................*......................................................................................
        sub x15, x14, x23          // .....................................*.....................................................................................
        lh x23, 1*2*3(x10)         // .....................................*.....................................................................................
        mulh x22, x7, x16          // ......................................*....................................................................................
        lw x12, 2*4(x11)           // ......................................*....................................................................................
        lh x29, 1*2*5(x10)         // .......................................*...................................................................................
        addi x3, x3, 8             // .......................................*...................................................................................
        mulh x3, x3, x16           // ........................................*..................................................................................
        srai x28, x30, 16          // ........................................*..................................................................................
        addi x1, x28, 8            // .........................................*.................................................................................
        add x28, x20, x22          // ..........................................*................................................................................
        mulw x7, x28, x4           // ...........................................*...............................................................................
        lh x27, 1*2*6(x10)         // ...........................................*...............................................................................
        sub x30, x20, x22          // ............................................*..............................................................................
        mulw x30, x30, x12         // .............................................*.............................................................................
        add x19, x23, x31          // .............................................*.............................................................................
        sub x17, x29, x3           // ..............................................*............................................................................
        add x20, x29, x3           // ..............................................*............................................................................
        mulw x3, x20, x4           // ...............................................*...........................................................................
        add x28, x27, x13          // ...............................................*...........................................................................
        sub x13, x27, x13          // ................................................*..........................................................................
        srai x21, x7, 16           // ................................................*..........................................................................
        mulw x7, x28, x4           // .................................................*.........................................................................
        srai x4, x30, 16           // .................................................*.........................................................................
        mulw x28, x13, x12         // ...................................................*.......................................................................
        srai x20, x7, 16           // .....................................................*.....................................................................
        sub x27, x23, x31          // .....................................................*.....................................................................
        srai x3, x3, 16            // ......................................................*....................................................................
        mulh x14, x1, x16          // ......................................................*....................................................................
        addi x3, x3, 8             // .......................................................*...................................................................
        addi x1, x4, 8             // .......................................................*...................................................................
        srai x13, x28, 16          // ........................................................*..................................................................
        mulh x3, x3, x16           // ........................................................*..................................................................
        addi x29, x20, 8           // .........................................................*.................................................................
        sub x20, x8, x14           // ..........................................................*................................................................
        add x8, x8, x14            // ..........................................................*................................................................
        addi x7, x13, 8            // ...........................................................*...............................................................
        mulw x30, x15, x12         // ...........................................................*...............................................................
        lw x5, 4*4(x11)            // ............................................................*..............................................................
        addi x31, x21, 8           // ............................................................*..............................................................
        mulh x15, x7, x16          // .............................................................*.............................................................
        ld gp, 8*15(sp)
        addi gp, gp, -1
        sd gp, 8*15(sp)
ntt_rv64im_loop2:
                                   // Instructions:    185
                                   // Expected cycles: 116
                                   // Expected IPC:    1.59

                                   // ------------------------------------------------ cycle (expected) ------------------------------------------------->
                                   // 0                        25                       50                       75                       100
                                   // |------------------------|------------------------|------------------------|------------------------|---------------
        mulh x13, x29, x16         // *...................................................................................................................
        sub x21, x9, x3            // *...................................................................................................................
        add x9, x9, x3             // .*..................................................................................................................
        add x28, x26, x15          // .*..................................................................................................................
        sub x14, x26, x15          // ..*.................................................................................................................
        mulw x3, x17, x12          // ..*.................................................................................................................
        srai x15, x30, 16          // ...*................................................................................................................
        lw x29, 6*4(x11)           // ....*...............................................................................................................
        mulh x12, x31, x16         // ....*...............................................................................................................
        mulh x26, x1, x16          // ......*.............................................................................................................
        sub x31, x18, x13          // ......*.............................................................................................................
        add x6, x18, x13           // .......*............................................................................................................
        srai x3, x3, 16            // .......*............................................................................................................
        add x17, x19, x12          // ........*...........................................................................................................
        mulw x23, x14, x29         // ........*...........................................................................................................
        addi x3, x3, 8             // .........*..........................................................................................................
        lw x30, 5*4(x11)           // .........*..........................................................................................................
        mulh x3, x3, x16           // ..........*.........................................................................................................
        mulw x14, x28, x30         // ............*.......................................................................................................
        sub x13, x25, x3           // ..............*.....................................................................................................
        add x25, x25, x3           // ..............*.....................................................................................................
        sub x12, x19, x12          // ...............*....................................................................................................
        mulw x4, x31, x5           // ...............*....................................................................................................
        sub x19, x27, x26          // ................*...................................................................................................
        add x1, x27, x26           // ................*...................................................................................................
        addi x18, x15, 8           // .................*..................................................................................................
        mulw x12, x12, x5          // .................*..................................................................................................
        lw x22, 3*4(x11)           // ..................*.................................................................................................
        srai x7, x12, 16           // .....................*..............................................................................................
        mulw x15, x19, x29         // .....................*..............................................................................................
        addi x7, x7, 8             // ......................*.............................................................................................
        srai x27, x4, 16           // ......................*.............................................................................................
        mulh x26, x7, x16          // .......................*............................................................................................
        addi x27, x27, 8           // .......................*............................................................................................
        srai x7, x14, 16           // ........................*...........................................................................................
        srai x31, x23, 16          // ........................*...........................................................................................
        srai x15, x15, 16          // .........................*..........................................................................................
        mulw x12, x6, x22          // .........................*..........................................................................................
        addi x14, x7, 8            // ..........................*.........................................................................................
        addi x6, x15, 8            // ..........................*.........................................................................................
        add x19, x21, x26          // ...........................*........................................................................................
        mulw x3, x17, x22          // ...........................*........................................................................................
        addi x11, x11, 7*4         // ............................*.......................................................................................
        sh x19, 1*2*5(x10)         // ............................*.......................................................................................
        addi x28, x31, 8           // .............................*......................................................................................
        srai x5, x12, 16           // .............................*......................................................................................
        mulh x27, x27, x16         // ..............................*.....................................................................................
        srai x3, x3, 16            // ...............................*....................................................................................
        addi x3, x3, 8             // ................................*...................................................................................
        sub x21, x21, x26          // ................................*...................................................................................
        mulh x3, x3, x16           // .................................*..................................................................................
        addi x4, x5, 8             // .................................*..................................................................................
        lw x5, 0*4(x11)            // ..................................*.................................................................................
        sub x26, x20, x27          // ..................................*.................................................................................
        mulh x7, x18, x16          // ...................................*................................................................................
        add x27, x20, x27          // ....................................*...............................................................................
        mulh x19, x28, x16         // .....................................*..............................................................................
        sh x26, 1*2*6(x10)         // .....................................*..............................................................................
        sh x21, 1*2*7(x10)         // ......................................*.............................................................................
        add x12, x24, x7           // .......................................*............................................................................
        mulh x23, x4, x16          // .......................................*............................................................................
        sh x27, 1*2*4(x10)         // ........................................*...........................................................................
        sub x17, x24, x7           // ........................................*...........................................................................
        sub x21, x9, x3            // .........................................*..........................................................................
        add x29, x17, x19          // .........................................*..........................................................................
        sub x22, x17, x19          // ..........................................*.........................................................................
        mulh x6, x6, x16           // ..........................................*.........................................................................
        add x15, x8, x23           // ...........................................*........................................................................
        add x20, x9, x3            // ...........................................*........................................................................
        sh x29, 1*2*12(x10)        // ............................................*.......................................................................
        mulw x3, x1, x30           // ............................................*.......................................................................
        sh x22, 1*2*14(x10)        // .............................................*......................................................................
        sub x8, x8, x23            // .............................................*......................................................................
        sh x8, 1*2*2(x10)          // ..............................................*.....................................................................
        sh x20, 1*2*1(x10)         // ...............................................*....................................................................
        srai x3, x3, 16            // ................................................*...................................................................
        mulh x14, x14, x16         // ................................................*...................................................................
        sub x17, x13, x6           // .................................................*..................................................................
        addi x3, x3, 8             // .................................................*..................................................................
        sh x21, 1*2*3(x10)         // ..................................................*.................................................................
        sh x15, 1*2*0(x10)         // ...................................................*................................................................
        mulh x3, x3, x16           // ...................................................*................................................................
        sh x17, 1*2*15(x10)        // .....................................................*..............................................................
        sub x17, x12, x14          // ......................................................*.............................................................
        add x29, x12, x14          // ......................................................*.............................................................
        add x19, x25, x3           // .......................................................*............................................................
        sh x17, 1*2*10(x10)        // .......................................................*............................................................
        sh x19, 1*2*9(x10)         // ........................................................*...........................................................
        sub x19, x25, x3           // ........................................................*...........................................................
        add x17, x13, x6           // .........................................................*..........................................................
        sh x29, 1*2*8(x10)         // .........................................................*..........................................................
        sh x19, 1*2*11(x10)        // ..........................................................*.........................................................
        sh x17, 1*2*13(x10)        // ...........................................................*........................................................
        addi x10, x10, 32          // ...........................................................*........................................................
        lh x15, 1*2*9(x10)         // ............................................................*.......................................................
        lh x4, 1*2*11(x10)         // .............................................................*......................................................
        lh x6, 1*2*14(x10)         // ..............................................................*.....................................................
        mulw x3, x15, x5           // ...............................................................*....................................................
        lh x27, 1*2*8(x10)         // ...............................................................*....................................................
        lh x28, 1*2*15(x10)        // ................................................................*...................................................
        mulw x9, x4, x5            // .................................................................*..................................................
        lh x29, 1*2*10(x10)        // ..................................................................*.................................................
        mulw x19, x28, x5          // ...................................................................*................................................
        srai x26, x9, 16           // .....................................................................*..............................................
        srai x3, x3, 16            // .....................................................................*..............................................
        addi x4, x26, 8            // ......................................................................*.............................................
        mulw x28, x27, x5          // ......................................................................*.............................................
        addi x3, x3, 8             // .......................................................................*............................................
        lh x31, 1*2*12(x10)        // .......................................................................*............................................
        mulw x25, x6, x5           // ........................................................................*...........................................
        srai x17, x19, 16          // ..........................................................................*.........................................
        mulw x26, x31, x5          // ..........................................................................*.........................................
        addi x8, x17, 8            // ...........................................................................*........................................
        srai x19, x28, 16          // ...........................................................................*........................................
        srai x14, x25, 16          // ............................................................................*.......................................
        mulh x3, x3, x16           // ............................................................................*.......................................
        addi x28, x19, 8           // .............................................................................*......................................
        addi x13, x14, 8           // .............................................................................*......................................
        lh x20, 1*2*1(x10)         // ..............................................................................*.....................................
        mulh x31, x4, x16          // ..............................................................................*.....................................
        srai x23, x26, 16          // ................................................................................*...................................
        mulh x26, x8, x16          // ................................................................................*...................................
        add x9, x20, x3            // .................................................................................*..................................
        lh x15, 1*2*6(x10)         // .................................................................................*..................................
        lh x22, 1*2*7(x10)         // ..................................................................................*.................................
        mulh x24, x28, x16         // ..................................................................................*.................................
        sub x25, x20, x3           // ...................................................................................*................................
        lh x6, 1*2*13(x10)         // ...................................................................................*................................
        addi x20, x23, 8           // ....................................................................................*...............................
        mulw x23, x29, x5          // ....................................................................................*...............................
        mulh x1, x20, x16          // ......................................................................................*.............................
        add x21, x22, x26          // .......................................................................................*............................
        sub x30, x22, x26          // .......................................................................................*............................
        srai x8, x23, 16           // ........................................................................................*...........................
        mulw x3, x6, x5            // ........................................................................................*...........................
        lh x17, 1*2*0(x10)         // .........................................................................................*..........................
        addi x19, x8, 8            // .........................................................................................*..........................
        lw x28, 1*4(x11)           // ..........................................................................................*.........................
        mulh x23, x13, x16         // ..........................................................................................*.........................
        add x8, x17, x24           // ............................................................................................*.......................
        sub x24, x17, x24          // ............................................................................................*.......................
        srai x3, x3, 16            // .............................................................................................*......................
        mulh x17, x19, x16         // .............................................................................................*......................
        add x12, x15, x23          // ..............................................................................................*.....................
        addi x3, x3, 8             // ..............................................................................................*.....................
        lh x14, 1*2*2(x10)         // ...............................................................................................*....................
        mulh x3, x3, x16           // ...............................................................................................*....................
        sub x7, x15, x23           // ................................................................................................*...................
        lh x27, 1*2*4(x10)         // .................................................................................................*..................
        mulw x5, x21, x28          // .................................................................................................*..................
        add x18, x14, x17          // ..................................................................................................*.................
        lh x6, 1*2*5(x10)          // ..................................................................................................*.................
        mulw x22, x12, x28         // ...................................................................................................*................
        sub x26, x14, x17          // ...................................................................................................*................
        lw x12, 2*4(x11)           // ....................................................................................................*...............
        add x29, x27, x1           // ....................................................................................................*...............
        mulw x4, x29, x28          // .....................................................................................................*..............
        sub x17, x6, x3            // .....................................................................................................*..............
        add x15, x6, x3            // ......................................................................................................*.............
        sub x13, x27, x1           // ......................................................................................................*.............
        mulw x20, x30, x12         // .......................................................................................................*............
        lh x23, 1*2*3(x10)         // .......................................................................................................*............
        srai x14, x5, 16           // ........................................................................................................*...........
        srai x6, x22, 16           // ........................................................................................................*...........
        mulw x3, x15, x28          // .........................................................................................................*..........
        lw x5, 4*4(x11)            // .........................................................................................................*..........
        add x19, x23, x31          // ..........................................................................................................*.........
        sub x27, x23, x31          // ..........................................................................................................*.........
        mulw x28, x7, x12          // ...........................................................................................................*........
        srai x7, x4, 16            // ...........................................................................................................*........
        srai x30, x20, 16          // ............................................................................................................*.......
        addi x22, x7, 8            // ............................................................................................................*.......
        mulh x7, x22, x16          // .............................................................................................................*......
        srai x3, x3, 16            // .............................................................................................................*......
        addi x1, x30, 8            // ..............................................................................................................*.....
        addi x3, x3, 8             // ..............................................................................................................*.....
        mulw x30, x13, x12         // ...............................................................................................................*....
        srai x28, x28, 16          // ...............................................................................................................*....
        addi x31, x14, 8           // ................................................................................................................*...
        addi x14, x28, 8           // ................................................................................................................*...
        mulh x15, x14, x16         // .................................................................................................................*..
        sub x20, x8, x7            // ..................................................................................................................*.
        addi x29, x6, 8            // ..................................................................................................................*.
        add x8, x8, x7             // ...................................................................................................................*
        mulh x3, x3, x16           // ...................................................................................................................*

                                    // ------------------------------------------------ cycle (expected) ------------------------------------------------->
                                    // 0                        25                       50                       75                       100
                                    // |------------------------|------------------------|------------------------|------------------------|---------------
        // sub x21, x9, x3          // *...................................................................................................................
        // mulh x13, x1, x16        // ......*.............................................................................................................
        // sub x14, x26, x15        // ..*.................................................................................................................
        // add x26, x26, x15        // .*..................................................................................................................
        // add x9, x9, x3           // .*..................................................................................................................
        // mulh x29, x29, x16       // *...................................................................................................................
        // srai x22, x30, 16        // ...*................................................................................................................
        // lw x6, 3*4(x11)          // ..................*.................................................................................................
        // lw x30, 5*4(x11)         // .........*..........................................................................................................
        // mulw x3, x17, x12        // ..*.................................................................................................................
        // mulh x31, x31, x16       // ....*...............................................................................................................
        // sub x23, x18, x29        // ......*.............................................................................................................
        // add x17, x18, x29        // .......*............................................................................................................
        // sub x7, x27, x13         // ................*...................................................................................................
        // add x1, x27, x13         // ................*...................................................................................................
        // mulw x28, x26, x30       // ............*.......................................................................................................
        // lw x15, 6*4(x11)         // ....*...............................................................................................................
        // srai x3, x3, 16          // .......*............................................................................................................
        // addi x3, x3, 8           // .........*..........................................................................................................
        // addi x4, x22, 8          // .................*..................................................................................................
        // mulw x13, x7, x15        // .....................*..............................................................................................
        // add x22, x19, x31        // ........*...........................................................................................................
        // sub x19, x19, x31        // ...............*....................................................................................................
        // mulh x27, x4, x16        // ...................................*................................................................................
        // mulw x26, x19, x5        // .................*..................................................................................................
        // mulw x31, x23, x5        // ...............*....................................................................................................
        // srai x29, x28, 16        // ........................*...........................................................................................
        // srai x18, x26, 16        // .....................*..............................................................................................
        // mulh x3, x3, x16         // ..........*.........................................................................................................
        // srai x19, x31, 16        // ......................*.............................................................................................
        // addi x11, x11, 7*4       // ............................*.......................................................................................
        // addi x7, x19, 8          // .......................*............................................................................................
        // addi x4, x18, 8          // ......................*.............................................................................................
        // mulh x28, x7, x16        // ..............................*.....................................................................................
        // srai x5, x13, 16         // .........................*..........................................................................................
        // sub x13, x25, x3         // ..............*.....................................................................................................
        // add x25, x25, x3         // ..............*.....................................................................................................
        // mulw x3, x22, x6         // ...........................*........................................................................................
        // sub x12, x24, x27        // ........................................*...........................................................................
        // mulw x7, x14, x15        // ........*...........................................................................................................
        // add x24, x24, x27        // .......................................*............................................................................
        // sub x19, x20, x28        // ..................................*.................................................................................
        // add x22, x20, x28        // ....................................*...............................................................................
        // mulw x28, x17, x6        // .........................*..........................................................................................
        // addi x23, x29, 8         // ..........................*.........................................................................................
        // srai x3, x3, 16          // ...............................*....................................................................................
        // mulh x29, x4, x16        // .......................*............................................................................................
        // addi x3, x3, 8           // ................................*...................................................................................
        // sub x14, x21, x29        // ................................*...................................................................................
        // add x17, x21, x29        // ...........................*........................................................................................
        // mulh x3, x3, x16         // .................................*..................................................................................
        // srai x21, x7, 16         // ........................*...........................................................................................
        // addi x4, x5, 8           // ..........................*.........................................................................................
        // sh x22, 1*2*4(x10)       // ........................................*...........................................................................
        // mulh x26, x4, x16        // ..........................................*.........................................................................
        // srai x22, x28, 16        // .............................*......................................................................................
        // sh x19, 1*2*6(x10)       // .....................................*..............................................................................
        // addi x29, x21, 8         // .............................*......................................................................................
        // mulh x29, x29, x16       // .....................................*..............................................................................
        // add x6, x9, x3           // ...........................................*........................................................................
        // sub x28, x9, x3          // .........................................*..........................................................................
        // sh x6, 1*2*1(x10)        // ...............................................*....................................................................
        // mulh x6, x23, x16        // ................................................*...................................................................
        // sh x28, 1*2*3(x10)       // ..................................................*.................................................................
        // sh x17, 1*2*5(x10)       // ............................*.......................................................................................
        // add x5, x12, x29         // .........................................*..........................................................................
        // sub x19, x12, x29        // ..........................................*.........................................................................
        // sh x5, 1*2*12(x10)       // ............................................*.......................................................................
        // mulw x3, x1, x30         // ............................................*.......................................................................
        // sh x19, 1*2*14(x10)      // .............................................*......................................................................
        // add x30, x13, x26        // .........................................................*..........................................................
        // sub x19, x13, x26        // .................................................*..................................................................
        // sh x14, 1*2*7(x10)       // ......................................*.............................................................................
        // sh x19, 1*2*15(x10)      // .....................................................*..............................................................
        // addi x29, x22, 8         // .................................*..................................................................................
        // srai x3, x3, 16          // ................................................*...................................................................
        // mulh x19, x29, x16       // .......................................*............................................................................
        // sh x30, 1*2*13(x10)      // ...........................................................*........................................................
        // addi x3, x3, 8           // .................................................*..................................................................
        // mulh x3, x3, x16         // ...................................................*................................................................
        // add x18, x24, x6         // ......................................................*.............................................................
        // sub x26, x24, x6         // ......................................................*.............................................................
        // sh x18, 1*2*8(x10)       // .........................................................*..........................................................
        // sh x26, 1*2*10(x10)      // .......................................................*............................................................
        // sub x12, x8, x19         // .............................................*......................................................................
        // add x19, x8, x19         // ...........................................*........................................................................
        // sh x12, 1*2*2(x10)       // ..............................................*.....................................................................
        // sh x19, 1*2*0(x10)       // ...................................................*................................................................
        // add x19, x25, x3         // .......................................................*............................................................
        // sub x27, x25, x3         // ........................................................*...........................................................
        // sh x19, 1*2*9(x10)       // ........................................................*...........................................................
        // sh x27, 1*2*11(x10)      // ..........................................................*.........................................................
        // addi x10, x10, 32        // ...........................................................*........................................................
        // lw x5, 0*4(x11)          // ..................................*.................................................................................
        // lh x23, 1*2*8(x10)       // ...............................................................*....................................................
        // lh x15, 1*2*0(x10)       // .........................................................................................*..........................
        // lh x30, 1*2*9(x10)       // ............................................................*.......................................................
        // lh x28, 1*2*11(x10)      // .............................................................*......................................................
        // mulw x20, x23, x5        // ......................................................................*.............................................
        // lh x31, 1*2*10(x10)      // ..................................................................*.................................................
        // mulw x3, x30, x5         // ...............................................................*....................................................
        // lh x29, 1*2*12(x10)      // .......................................................................*............................................
        // srai x3, x3, 16          // .....................................................................*..............................................
        // mulw x22, x31, x5        // ....................................................................................*...............................
        // addi x3, x3, 8           // .......................................................................*............................................
        // srai x19, x20, 16        // ...........................................................................*........................................
        // mulh x3, x3, x16         // ............................................................................*.......................................
        // addi x4, x19, 8          // .............................................................................*......................................
        // lh x19, 1*2*13(x10)      // ...................................................................................*................................
        // mulw x26, x28, x5        // .................................................................*..................................................
        // lh x6, 1*2*15(x10)       // ................................................................*...................................................
        // mulw x29, x29, x5        // ..........................................................................*.........................................
        // srai x30, x22, 16        // ........................................................................................*...........................
        // srai x12, x26, 16        // .....................................................................*..............................................
        // lh x8, 1*2*1(x10)        // ..............................................................................*.....................................
        // mulh x31, x4, x16        // ..................................................................................*.................................
        // addi x26, x30, 8         // .........................................................................................*..........................
        // addi x27, x12, 8         // ......................................................................*.............................................
        // lh x22, 1*2*14(x10)      // ..............................................................*.....................................................
        // mulw x28, x6, x5         // ...................................................................*................................................
        // add x9, x8, x3           // .................................................................................*..................................
        // mulh x20, x26, x16       // .............................................................................................*......................
        // sub x25, x8, x3          // ...................................................................................*................................
        // add x8, x15, x31         // ............................................................................................*.......................
        // sub x24, x15, x31        // ............................................................................................*.......................
        // srai x13, x29, 16        // ................................................................................*...................................
        // mulw x1, x22, x5         // ........................................................................*...........................................
        // srai x26, x28, 16        // ..........................................................................*.........................................
        // lh x15, 1*2*2(x10)       // ...............................................................................................*....................
        // mulw x3, x19, x5         // ........................................................................................*...........................
        // addi x21, x13, 8         // ....................................................................................*...............................
        // lw x4, 1*4(x11)          // ..........................................................................................*.........................
        // mulh x23, x21, x16       // ......................................................................................*.............................
        // lh x14, 1*2*4(x10)       // .................................................................................................*..................
        // srai x19, x1, 16         // ............................................................................*.......................................
        // srai x3, x3, 16          // .............................................................................................*......................
        // addi x6, x19, 8          // .............................................................................*......................................
        // add x18, x15, x20        // ..................................................................................................*.................
        // mulh x31, x27, x16       // ..............................................................................*.....................................
        // addi x7, x26, 8          // ...........................................................................*........................................
        // mulh x13, x6, x16        // ..........................................................................................*.........................
        // sub x26, x15, x20        // ...................................................................................................*................
        // add x21, x14, x23        // ....................................................................................................*...............
        // mulw x30, x21, x4        // .....................................................................................................*..............
        // lh x20, 1*2*7(x10)       // ..................................................................................*.................................
        // sub x15, x14, x23        // ......................................................................................................*.............
        // lh x23, 1*2*3(x10)       // .......................................................................................................*............
        // mulh x22, x7, x16        // ................................................................................*...................................
        // lw x12, 2*4(x11)         // ....................................................................................................*...............
        // lh x29, 1*2*5(x10)       // ..................................................................................................*.................
        // addi x3, x3, 8           // ..............................................................................................*.....................
        // mulh x3, x3, x16         // ...............................................................................................*....................
        // srai x28, x30, 16        // ...........................................................................................................*........
        // addi x1, x28, 8          // ............................................................................................................*.......
        // add x28, x20, x22        // .......................................................................................*............................
        // mulw x7, x28, x4         // .................................................................................................*..................
        // lh x27, 1*2*6(x10)       // .................................................................................*..................................
        // sub x30, x20, x22        // .......................................................................................*............................
        // mulw x30, x30, x12       // .......................................................................................................*............
        // add x19, x23, x31        // ..........................................................................................................*.........
        // sub x17, x29, x3         // .....................................................................................................*..............
        // add x20, x29, x3         // ......................................................................................................*.............
        // mulw x3, x20, x4         // .........................................................................................................*..........
        // add x28, x27, x13        // ..............................................................................................*.....................
        // sub x13, x27, x13        // ................................................................................................*...................
        // srai x21, x7, 16         // ........................................................................................................*...........
        // mulw x7, x28, x4         // ...................................................................................................*................
        // srai x4, x30, 16         // ............................................................................................................*.......
        // mulw x28, x13, x12       // ...........................................................................................................*........
        // srai x20, x7, 16         // ........................................................................................................*...........
        // sub x27, x23, x31        // ..........................................................................................................*.........
        // srai x3, x3, 16          // .............................................................................................................*......
        // mulh x14, x1, x16        // .............................................................................................................*......
        // addi x3, x3, 8           // ..............................................................................................................*.....
        // addi x1, x4, 8           // ..............................................................................................................*.....
        // srai x13, x28, 16        // ...............................................................................................................*....
        // mulh x3, x3, x16         // ...................................................................................................................*
        // addi x29, x20, 8         // ..................................................................................................................*.
        // sub x20, x8, x14         // ..................................................................................................................*.
        // add x8, x8, x14          // ...................................................................................................................*
        // addi x7, x13, 8          // ................................................................................................................*...
        // mulw x30, x15, x12       // ...............................................................................................................*....
        // lw x5, 4*4(x11)          // .........................................................................................................*..........
        // addi x31, x21, 8         // ................................................................................................................*...
        // mulh x15, x7, x16        // .................................................................................................................*..

        ld gp, 8*15(sp)
        addi gp, gp, -1
        sd gp, 8*15(sp)
        bne gp, zero, ntt_rv64im_loop2
        sub x21, x9, x3            // .............................................................*.............................................................
        mulh x13, x1, x16          // ...............................................................*...........................................................
        sub x14, x26, x15          // .................................................................*.........................................................
        add x26, x26, x15          // .................................................................*.........................................................
        add x9, x9, x3             // ..................................................................*........................................................
        mulh x29, x29, x16         // ..................................................................*........................................................
        srai x22, x30, 16          // ...................................................................*.......................................................
        lw x6, 3*4(x11)            // ...................................................................*.......................................................
        lw x30, 5*4(x11)           // ....................................................................*......................................................
        mulw x3, x17, x12          // ....................................................................*......................................................
        mulh x31, x31, x16         // ......................................................................*....................................................
        sub x23, x18, x29          // ......................................................................*....................................................
        add x17, x18, x29          // .......................................................................*...................................................
        sub x7, x27, x13           // .......................................................................*...................................................
        add x1, x27, x13           // ........................................................................*..................................................
        mulw x28, x26, x30         // ........................................................................*..................................................
        lw x15, 6*4(x11)           // .........................................................................*.................................................
        srai x3, x3, 16            // .........................................................................*.................................................
        addi x3, x3, 8             // ..........................................................................*................................................
        addi x4, x22, 8            // ..........................................................................*................................................
        mulw x13, x7, x15          // ............................................................................*..............................................
        add x22, x19, x31          // ............................................................................*..............................................
        sub x19, x19, x31          // .............................................................................*.............................................
        mulh x27, x4, x16          // ..............................................................................*............................................
        mulw x26, x19, x5          // ................................................................................*..........................................
        mulw x31, x23, x5          // ..................................................................................*........................................
        srai x29, x28, 16          // ..................................................................................*........................................
        srai x18, x26, 16          // ....................................................................................*......................................
        mulh x3, x3, x16           // ....................................................................................*......................................
        srai x19, x31, 16          // ......................................................................................*....................................
        addi x11, x11, 7*4         // ......................................................................................*....................................
        addi x7, x19, 8            // .......................................................................................*...................................
        addi x4, x18, 8            // .......................................................................................*...................................
        mulh x28, x7, x16          // ........................................................................................*..................................
        srai x5, x13, 16           // ........................................................................................*..................................
        sub x13, x25, x3           // .........................................................................................*.................................
        add x25, x25, x3           // .........................................................................................*.................................
        mulw x3, x22, x6           // ..........................................................................................*................................
        sub x12, x24, x27          // ..........................................................................................*................................
        mulw x7, x14, x15          // ............................................................................................*..............................
        add x24, x24, x27          // ............................................................................................*..............................
        sub x19, x20, x28          // .............................................................................................*.............................
        add x22, x20, x28          // .............................................................................................*.............................
        mulw x28, x17, x6          // ..............................................................................................*............................
        addi x23, x29, 8           // ..............................................................................................*............................
        srai x3, x3, 16            // ...............................................................................................*...........................
        mulh x29, x4, x16          // ................................................................................................*..........................
        addi x3, x3, 8             // ................................................................................................*..........................
        sub x14, x21, x29          // ....................................................................................................*......................
        add x17, x21, x29          // ....................................................................................................*......................
        mulh x3, x3, x16           // .....................................................................................................*.....................
        srai x21, x7, 16           // .....................................................................................................*.....................
        addi x4, x5, 8             // ......................................................................................................*....................
        sh x22, 1*2*4(x10)         // ......................................................................................................*....................
        mulh x26, x4, x16          // .......................................................................................................*...................
        srai x22, x28, 16          // .......................................................................................................*...................
        sh x19, 1*2*6(x10)         // ........................................................................................................*..................
        addi x29, x21, 8           // ........................................................................................................*..................
        mulh x29, x29, x16         // .........................................................................................................*.................
        add x6, x9, x3             // .........................................................................................................*.................
        sub x28, x9, x3            // ..........................................................................................................*................
        sh x6, 1*2*1(x10)          // ..........................................................................................................*................
        mulh x6, x23, x16          // ...........................................................................................................*...............
        sh x28, 1*2*3(x10)         // ...........................................................................................................*...............
        sh x17, 1*2*5(x10)         // ............................................................................................................*..............
        add x5, x12, x29           // .............................................................................................................*.............
        sub x19, x12, x29          // .............................................................................................................*.............
        sh x5, 1*2*12(x10)         // ..............................................................................................................*............
        mulw x3, x1, x30           // ..............................................................................................................*............
        sh x19, 1*2*14(x10)        // ...............................................................................................................*...........
        add x30, x13, x26          // ...............................................................................................................*...........
        sub x19, x13, x26          // ................................................................................................................*..........
        sh x14, 1*2*7(x10)         // ................................................................................................................*..........
        sh x19, 1*2*15(x10)        // .................................................................................................................*.........
        addi x29, x22, 8           // .................................................................................................................*.........
        srai x3, x3, 16            // ..................................................................................................................*........
        mulh x19, x29, x16         // ..................................................................................................................*........
        sh x30, 1*2*13(x10)        // ...................................................................................................................*.......
        addi x3, x3, 8             // ...................................................................................................................*.......
        mulh x3, x3, x16           // ....................................................................................................................*......
        add x18, x24, x6           // ....................................................................................................................*......
        sub x26, x24, x6           // .....................................................................................................................*.....
        sh x18, 1*2*8(x10)         // .....................................................................................................................*.....
        sh x26, 1*2*10(x10)        // ......................................................................................................................*....
        sub x12, x8, x19           // ......................................................................................................................*....
        add x19, x8, x19           // .......................................................................................................................*...
        sh x12, 1*2*2(x10)         // .......................................................................................................................*...
        sh x19, 1*2*0(x10)         // ........................................................................................................................*..
        add x19, x25, x3           // ........................................................................................................................*..
        sub x27, x25, x3           // .........................................................................................................................*.
        sh x19, 1*2*9(x10)         // .........................................................................................................................*.
        sh x27, 1*2*11(x10)        // ..........................................................................................................................*
        addi x10, x10, 32          // ..........................................................................................................................*
  restore_regs
  addi sp, sp, 8*16
  ret